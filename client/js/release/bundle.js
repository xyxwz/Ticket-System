var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("libs/almond",function(){}),function(e,t){function Y(e){if(e&&typeof e=="object"&&e.__wrapped__)return e;if(!(this instanceof Y))return new Y(e);this.__wrapped__=e}function Z(e){return e.charCodeAt(0)}function et(e,t){var n=e.index,r=t.index;e=e.criteria,t=t.criteria;if(e!==t){if(e>t||typeof e=="undefined")return 1;if(e<t||typeof t=="undefined")return-1}return n<r?-1:1}function tt(e,t,n,r){function u(){var a=arguments,f=s?this:t;i||(e=t[o]),n.length&&(a=a.length?(a=at(a),r?a.concat(n):n.concat(a)):n);if(this instanceof u){ut.prototype=e.prototype,f=new ut,ut.prototype=null;var l=e.apply(f,a);return _t(l)?l:f}return e.apply(f,a)}var i=Mt(e),s=!n,o=t;return s&&(n=t),i||(t=e),u}function nt(e,t,n){if(e==null)return Un;var r=typeof e;if(r!="function"){if(r!="object")return function(t){return t[e]};var i=dt(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=t[i[n]]===e[i[n]]))break;return r}}return typeof t!="undefined"?n===1?function(n){return e.call(t,n)}:n===2?function(n,r){return e.call(t,n,r)}:n===4?function(n,r,i,s){return e.call(t,n,r,i,s)}:function(n,r,i){return e.call(t,n,r,i)}:e}function it(e){return"\\"+G[e]}function st(e){return gt[e]}function ot(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}function ut(){}function at(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function ft(e){return yt[e]}function lt(e){return k.call(e)==B}function vt(e){var t=!1;if(!e||typeof e!="object"||lt(e))return t;var n=e.constructor;return!Mt(n)||n instanceof n?(ct(e,function(e,n){t=n}),t===!1||N.call(e,t)):t}function mt(e){var t=[];return ht(e,function(e,n){t.push(n)}),t}function bt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)e[i]=r[i]}return e}function wt(e){return _t(e)?pt(e)?at(e):bt({},e):e}function Et(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)e[i]==null&&(e[i]=r[i])}return e}function St(e){var t=[];return ct(e,function(e,n){Mt(e)&&t.push(n)}),t.sort()}function xt(e,t){return e?N.call(e,t):!1}function Tt(e){var t=-1,n=dt(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Nt(e){return e===!0||e===!1||k.call(e)==F}function Ct(e){return e instanceof Date||k.call(e)==I}function kt(e){return e?e.nodeType===1:!1}function Lt(e){if(!e)return!0;if(pt(e)||jt(e))return!e.length;for(var t in e)if(N.call(e,t))return!1;return!0}function At(e,t,n,r){if(e===t)return e!==0||1/e==1/t;var i=typeof e,s=typeof t;if(e===e&&(!e||i!="function"&&i!="object")&&(!t||s!="function"&&s!="object"))return!1;if(e==null||t==null)return e===t;var o=k.call(e),u=k.call(t);if(o!=u)return!1;switch(o){case F:case I:return+e==+t;case R:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case z:case W:return e==t+""}var f=o==j;if(!f){if(e.__wrapped__||t.__wrapped__)return At(e.__wrapped__||e,t.__wrapped__||t,n,r);if(o!=U)return!1;var l=e.constructor,c=t.constructor;if(l!=c&&!(Mt(l)&&l instanceof l&&Mt(c)&&c instanceof c))return!1}n||(n=[]),r||(r=[]);var h=n.length;while(h--)if(n[h]==e)return r[h]==t;var p=!0,d=0;n.push(e),r.push(t);if(f){d=t.length,p=d==e.length;if(p)while(d--)if(!(p=At(e[d],t[d],n,r)))break;return p}return ct(t,function(t,i,s){if(N.call(s,i))return d++,!(p=N.call(e,i)&&At(e[i],t,n,r))&&a}),p&&ct(e,function(e,t,n){if(N.call(n,t))return!(p=--d>-1)&&a}),p}function Ot(e){return O(e)&&!M(parseFloat(e))}function Mt(e){return typeof e=="function"}function _t(e){return e?Q[typeof e]:!1}function Dt(e){return Ht(e)&&e!=+e}function Pt(e){return e===null}function Ht(e){return typeof e=="number"||k.call(e)==R}function Bt(e){return e instanceof RegExp||k.call(e)==z}function jt(e){return typeof e=="string"||k.call(e)==W}function Ft(e){return typeof e=="undefined"}function It(e){var t=x.apply(s,arguments),n={};return ct(e,function(e,r){mn(t,r,1)<0&&(n[r]=e)}),n}function qt(e){var t=-1,n=dt(e),r=n.length,i=Array(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Rt(e){var t=0,n=x.apply(s,arguments),r=n.length,i={};while(++t<r){var o=n[t];o in e&&(i[o]=e[o])}return i}function Ut(e){var t=-1,n=dt(e),r=n.length,i=Array(r);while(++t<r)i[t]=e[n[t]];return i}function zt(e,t){var n=e?e.length:0,r=!1;return typeof n=="number"?r=mn(e,t)>-1:rt(e,function(e){return(r=e===t)&&a}),r}function Wt(e,t,n){var r={};return t=nt(t,n),Kt(e,function(e,n,i){n=t(e,n,i)+"",N.call(r,n)?r[n]++:r[n]=1}),r}function Xt(e,t,n){var r=!0;t=nt(t,n);if(pt(e)){var i=-1,s=e.length;while(++i<s)if(!(r=!!t(e[i],i,e)))break}else rt(e,function(e,n,i){return!(r=!!t(e,n,i))&&a});return r}function Vt(e,t,n){var r=[];t=nt(t,n);if(pt(e)){var i=-1,s=e.length;while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}}else rt(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $t(e,t,n){var r;return t=nt(t,n),Kt(e,function(e,n,i){if(t(e,n,i))return r=e,a}),r}function Jt(e,t){return cn(e,t,!0)}function Kt(e,t,n){if(t&&typeof n=="undefined"&&pt(e)){var r=-1,i=e.length;while(++r<i)if(t(e[r],r,e)===a)break}else rt(e,t,n)}function Qt(e,t,n){var r={};return t=nt(t,n),Kt(e,function(e,n,i){n=t(e,n,i)+"",(N.call(r,n)?r[n]:r[n]=[]).push(e)}),r}function Gt(e,t){var n=at(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);return Kt(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o}function Yt(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=nt(t,n);if(pt(e))while(++r<i)s[r]=t(e[r],r,e);else rt(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function Zt(e,t,n){var r=-Infinity,i=r;if(!t&&pt(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u>i&&(i=u)}}else t=nt(t,n),rt(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function en(e,t,n){var r=Infinity,i=r;if(!t&&pt(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u<i&&(i=u)}}else t=nt(t,n),rt(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function nn(e,t,n,r){var i=arguments.length<3;t=nt(t,r,4);if(pt(e)){var s=-1,o=e.length;i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else rt(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function rn(e,t,n,r){var i=e,s=e?e.length:0,o=arguments.length<3;if(typeof s!="number"){var u=dt(e);s=u.length}return t=nt(t,r,4),Kt(e,function(e,r,a){r=u?u[--s]:--s,n=o?(o=!1,i[r]):t(n,i[r],r,a)}),n}function sn(e,t,n){return t=nt(t,n),Vt(e,function(e,n,r){return!t(e,n,r)})}function on(e){var t=-1,n=e?e.length:0,r=Array(typeof n=="number"?n:0);return Kt(e,function(e){var n=T(H()*(++t+1));r[t]=r[n],r[n]=e}),r}function un(e){var t=e?e.length:0;return typeof t=="number"?t:dt(e).length}function an(e,t,n){var r;t=nt(t,n);if(pt(e)){var i=-1,s=e.length;while(++i<s)if(r=t(e[i],i,e))break}else rt(e,function(e,n,i){return(r=t(e,n,i))&&a});return!!r}function fn(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=nt(t,n),Kt(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),i=s.length,s.sort(et);while(i--)s[i]=s[i].value;return s}function ln(e){return e&&typeof e.length=="number"?at(e):Ut(e)}function cn(e,t,n){return n&&Lt(t)?null:(n?$t:Vt)(e,t)}function hn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function pn(e){var t=-1,n=e.length,r=x.apply(s,arguments),i=[];while(++t<n){var o=e[t];mn(r,o,n)<0&&i.push(o)}return i}function dn(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=-1;t=nt(t,n);while(++s<i&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[0]}return at(e,0,P(D(0,r),i))}}function vn(e,t){var n=-1,r=e?e.length:0,i=[];while(++n<r){var s=e[n];pt(s)?C.apply(i,t?s:vn(s)):i.push(s)}return i}function mn(e,t,n){var r=-1,i=e?e.length:0;if(typeof n=="number")r=(n<0?D(0,i+n):n||0)-1;else if(n)return r=Tn(e,t),e[r]===t?r:-1;while(++r<i)if(e[r]===t)return r;return-1}function gn(e,t,n){if(!e)return[];var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=nt(t,n);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return at(e,0,P(D(0,i-r),i))}function yn(e){var t=arguments,n=t.length,r=-1,i=e?e.length:0,s=[];e:while(++r<i){var o=e[r];if(mn(s,o)<0){var u=n;while(--u)if(mn(t[u],o)<0)continue e;s.push(o)}}return s}function bn(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=nt(t,n);while(s--&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[i-1]}return at(e,D(0,i-r))}}function wn(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?D(0,r+n):P(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function En(e,t){var n=-1,r=e?e.length:0,i={};while(++n<r){var s=e[n];t?i[s]=t[n]:i[s[0]]=s[1]}return i}function Sn(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var r=-1,i=D(0,S((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s}function xn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=nt(t,n);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:D(0,t);return at(e,r)}function Tn(e,t,n,r){var i=0,s=e?e.length:i;n=n?nt(n,r,1):Un,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function Nn(){return Cn(x.apply(s,arguments))}function Cn(e,t,n,r){var i=-1,s=e?e.length:0,o=[],u=o;typeof t=="function"&&(r=n,n=t,t=!1),n&&(u=[],n=nt(n,r));while(++i<s){var a=e[i],f=n?n(a,i,e):a;if(t?!i||u[u.length-1]!==f:mn(u,f)<0)n&&u.push(f),o.push(a)}return o}function kn(e){var t=-1,n=e.length,r=[];while(++t<n){var i=e[t];mn(arguments,i,1)<0&&r.push(i)}return r}function Ln(e){var t=-1,n=e?Zt(tn(arguments,"length")):0,r=Array(n);while(++t<n)r[t]=tn(arguments,t);return r}function An(e,t){return e<1?t():function(){if(--e<1)return t.apply(this,arguments)}}function On(e,t){return $||L&&arguments.length>2?L.call.apply(L,arguments):tt(e,t,at(arguments,2))}function Mn(e){var t=x.apply(s,arguments),n=t.length>1?0:(t=St(e),-1),r=t.length;while(++n<r){var i=t[n];e[i]=On(e[i],e)}return e}function _n(){var e=arguments;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Dn(e,t,n){function u(){o=null,n||(i=e.apply(s,r))}var r,i,s,o;return function(){var a=n&&!o;return r=arguments,s=this,clearTimeout(o),o=setTimeout(u,t),a&&(i=e.apply(s,r)),i}}function Pn(e,n){var r=at(arguments,2);return setTimeout(function(){e.apply(t,r)},n)}function Hn(e){var n=at(arguments,1);return setTimeout(function(){e.apply(t,n)},1)}function Bn(e,t){var n={};return function(){var r=(t?t.apply(this,arguments):arguments[0])+"";return N.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}}function jn(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Fn(e){return tt(e,at(arguments,1))}function In(e,t){function u(){o=new Date,s=null,r=e.apply(i,n)}var n,r,i,s,o=0;return function(){var a=new Date,f=t-(a-o);return n=arguments,i=this,f<=0?(clearTimeout(s),s=null,o=a,r=e.apply(i,n)):s||(s=setTimeout(u,f)),r}}function qn(e,t){return function(){var n=[e];return C.apply(n,arguments),t.apply(this,n)}}function Rn(e){return e==null?"":(e+"").replace(b,st)}function Un(e){return e}function zn(e){Kt(St(e),function(t){var n=Y[t]=e[t];Y.prototype[t]=function(){var e=[this.__wrapped__];C.apply(e,arguments);var t=n.apply(Y,e);return this.__chain__&&(t=new Y(t),t.__chain__=!0),t}})}function Wn(){return this}function Xn(e,t){return e==null&&t==null&&(t=1),e=+e||0,t==null&&(t=e,e=0),e+T(H()*((+t||0)-e+1))}function Vn(e,t){var n=e?e[t]:null;return Mt(n)?e[t]():n}function $n(e,t,n){e||(e=""),n=Et({},n,Y.templateSettings);var r=0,i="__p += '",s=n.variable,o=RegExp((n.escape||y).source+"|"+(n.interpolate||y).source+"|"+(n.evaluate||y).source+"|$","g");e.replace(o,function(t,n,s,o,u){return i+=e.slice(r,u).replace(w,it),n&&(i+="' +\n_.escape("+n+") +\n'"),o&&(i+="';\n"+o+";\n__p += '"),s&&(i+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),r=u+t.length,t}),i+="';\n",s||(s="obj",i="with ("+s+" || {}) {\n"+i+"\n}\n"),i="function("+s+") {\n"+"var __t, __p = '', __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n"+i+"return __p\n}";try{var u=Function("_","return "+i)(Y)}catch(a){throw a.source=i,a}return t?u(t):(u.source=i,u)}function Jn(e,t,n){e=+e||0;var r=-1,i=Array(e);while(++r<e)i[r]=t.call(n,r);return i}function Kn(e){return e==null?"":(e+"").replace(l,ft)}function Qn(e){var t=++u+"";return e?e+t:t}function Gn(e){return e=new Y(e),e.__chain__=!0,e}function Yn(e,t){return t(e),e}function Zn(){return this.__chain__=!0,this}function er(){return this.__wrapped__+""}function tr(){return this.__wrapped__}var n=typeof exports=="object"&&exports,r=typeof module=="object"&&module&&module.exports==n&&module,i=typeof global=="object"&&global;i.global===i&&(e=i);var s=[],o={},u=0,a=o,f=e._,l=/&(?:amp|lt|gt|quot|#39);/g,c=/\b__p \+= '';/g,h=/\b(__p \+=) '' \+/g,p=/(__e\(.*?\)|\b__t\)) \+\n'';/g,d=/\w*$/,v=RegExp("^"+(o.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),m=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,g=/<%=([\s\S]+?)%>/g,y=/($^)/,b=/[&<>"']/g,w=/['\n\r\t\u2028\u2029\\]/g,E=0,S=Math.ceil,x=s.concat,T=Math.floor,N=o.hasOwnProperty,C=s.push,k=o.toString,L=v.test(L=at.bind)&&L,A=v.test(A=Array.isArray)&&A,O=e.isFinite,M=e.isNaN,_=v.test(_=Object.keys)&&_,D=Math.max,P=Math.min,H=Math.random,B="[object Arguments]",j="[object Array]",F="[object Boolean]",I="[object Date]",q="[object Function]",R="[object Number]",U="[object Object]",z="[object RegExp]",W="[object String]",X=!!e.attachEvent,V=L&&!/\n|true/.test(L+X),$=L&&!V,J=(J={0:1,length:1},s.splice.call(J,0,1),J[0]),K=arguments.constructor==Object,Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},G={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};Y.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:g,variable:""};var rt=function(e,t,n){var r,i=e,s=i;if(!i)return s;t=t&&typeof n=="undefined"?t:nt(t,n);var o=i.length;r=-1;if(typeof o=="number"){while(++r<o)if(t(i[r],r,e)===a)return s}else for(r in i)if(N.call(i,r)&&t(i[r],r,e)===a)return s};lt(arguments)||(lt=function(e){return e?N.call(e,"callee"):!1});var ct=function(e,t){var n,r=e,i=r;if(!r)return i;if(!Q[typeof r])return i;t||(t=Un);for(n in r)if(t(r[n],n,e)===a)return i;return i},ht=function(e,t){var n,r=e,i=r;if(!r)return i;if(!Q[typeof r])return i;t||(t=Un);for(n in r)if(N.call(r,n)&&t(r[n],n,e)===a)return i;return i},pt=A||function(e){return K&&e instanceof Array||k.call(e)==j},dt=_?function(e){return _t(e)?_(e):[]}:mt,gt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yt=Tt(gt);Mt(/x/)&&(Mt=function(e){return e instanceof Function||k.call(e)==q});var tn=Yt;V&&r&&typeof setImmediate=="function"&&(Hn=On(setImmediate,e)),Y.after=An,Y.bind=On,Y.bindAll=Mn,Y.compact=hn,Y.compose=_n,Y.countBy=Wt,Y.debounce=Dn,Y.defaults=Et,Y.defer=Hn,Y.delay=Pn,Y.difference=pn,Y.filter=Vt,Y.flatten=vn,Y.forEach=Kt,Y.functions=St,Y.groupBy=Qt,Y.initial=gn,Y.intersection=yn,Y.invert=Tt,Y.invoke=Gt,Y.keys=dt,Y.map=Yt,Y.max=Zt,Y.memoize=Bn,Y.min=en,Y.object=En,Y.omit=It,Y.once=jn,Y.pairs=qt,Y.partial=Fn,Y.pick=Rt,Y.pluck=tn,Y.range=Sn,Y.reject=sn,Y.rest=xn,Y.shuffle=on,Y.sortBy=fn,Y.tap=Yn,Y.throttle=In,Y.times=Jn,Y.toArray=ln,Y.union=Nn,Y.uniq=Cn,Y.values=Ut,Y.where=cn,Y.without=kn,Y.wrap=qn,Y.zip=Ln,Y.collect=Yt,Y.drop=xn,Y.each=Kt,Y.extend=bt,Y.methods=St,Y.select=Vt,Y.tail=xn,Y.unique=Cn,Y.clone=wt,Y.contains=zt,Y.escape=Rn,Y.every=Xt,Y.find=$t,Y.findWhere=Jt,Y.has=xt,Y.identity=Un,Y.indexOf=mn,Y.isArguments=lt,Y.isArray=pt,Y.isBoolean=Nt,Y.isDate=Ct,Y.isElement=kt,Y.isEmpty=Lt,Y.isEqual=At,Y.isFinite=Ot,Y.isFunction=Mt,Y.isNaN=Dt,Y.isNull=Pt,Y.isNumber=Ht,Y.isObject=_t,Y.isRegExp=Bt,Y.isString=jt,Y.isUndefined=Ft,Y.lastIndexOf=wn,Y.mixin=zn,Y.noConflict=Wn,Y.random=Xn,Y.reduce=nn,Y.reduceRight=rn,Y.result=Vn,Y.size=un,Y.some=an,Y.sortedIndex=Tn,Y.template=$n,Y.unescape=Kn,Y.uniqueId=Qn,Y.all=Xt,Y.any=an,Y.detect=$t,Y.foldl=nn,Y.foldr=rn,Y.include=zt,Y.inject=nn,Y.first=dn,Y.last=bn,Y.take=dn,Y.head=dn,Y.chain=Gn,Y.VERSION="1.0.1",zn(Y),Y.prototype.chain=Zn,Y.prototype.value=tr,rt(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];Y.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),J&&e.length===0&&delete e[0],this}}),rt(["concat","join","slice"],function(e){var t=s[e];Y.prototype[e]=function(){var e=this.__wrapped__,n=t.apply(e,arguments);return this.__chain__&&(n=new Y(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd&&define("underscore",[],function(){return Y})}(this),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="0.9.10",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!f.test(n))return!0;var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},c=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h=t.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!l(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r),this},off:function(e,t,r){var i,s,o,u,a,f,c,h;if(!this._events||!l(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(i=this._events[e]){o=[];if(t||r)for(c=0,h=i.length;c<h;c++)s=i[c],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&o.push(s);this._events[e]=o}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},listenTo:function(e,t,r){var i=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=n.uniqueId("l"));return i[s]=e,e.on(t,typeof t=="object"?this:r,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,typeof t=="object"?this:n,this),!t&&!n&&delete r[e._listenerId];else{typeof t=="object"&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}};h.bind=h.on,h.unbind=h.off,n.extend(t,h);var p=t.Model=function(e,t){var r,i=e||{};this.cid=n.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(i=this.parse(i,t)||{});if(r=n.result(this,"defaults"))i=n.defaults({},i,r);this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(p.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=!0);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u,a=this.attributes;return e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,i&&(!r||!r.wait)&&!this.set(i,r)?!1:(r=n.extend({validate:!0},r),this._validate(i,r)?(i&&r.wait&&(this.attributes=n.extend({},a,i)),r.parse===void 0&&(r.parse=!0),s=r.success,r.success=function(e,t,r){e.attributes=a;var o=e.parse(t,r);r.wait&&(o=n.extend(i||{},o));if(n.isObject(o)&&!e.set(o,r))return!1;s&&s(e,t,r)},o=this.isNew()?"create":r.patch?"patch":"update",o==="patch"&&(r.attrs=i),u=this.sync(o,this,r),i&&r.wait&&(this.attributes=a),u):!1)},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,n){(n.wait||e.isNew())&&i(),r&&r(e,t,n)};if(this.isNew())return e.success(this,null,e),!1;var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||_();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,t||{}),!1):!0}});var d=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))};n.extend(d.prototype,h,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,u,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&h==null&&t.sort!=0,d=n.isString(this.comparator)?this.comparator:null;for(r=0,i=e.length;r<i;r++){if(!(s=this._prepareModel(u=e[r],t))){this.trigger("invalid",this,u,t);continue}if(f=this.get(s)){t.merge&&(f.set(u===s?s.attributes:u,t),p&&!l&&f.hasChanged(d)&&(l=!0));continue}c.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,s.id!=null&&(this._byId[s.id]=s)}c.length&&(p&&(l=!0),this.length+=c.length,h!=null?a.apply(this.models,[h,0].concat(c)):o.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;for(r=0,i=c.length;r<i;r++)(s=c[r]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e])},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},update:function(e,t){t=n.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var r,i,s,o,u=[],a=[],f={};n.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(i=0,s=e.length;i<s;i++)r=e[i],o=this.get(r),t.remove&&o&&(f[o.cid]=!0),(t.add&&!o||t.merge&&o)&&u.push(r);if(t.remove)for(i=0,s=this.models.length;i<s;i++)r=this.models[i],f[r.cid]||a.push(r);return a.length&&this.remove(a,t),u.length&&this.add(u,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){var i=r.update?"update":"reset";e[i](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,t,n){n.wait&&r.add(e,n),i&&i(e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)},sortedIndex:function(e,t,r){t||(t=this.comparator);var i=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,i,r)}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var m=["groupBy","countBy","sortBy"];n.each(m,function(e){d.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var g=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,b=/(\(\?)?:\w+/g,w=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(g.prototype,h,{initialize:function(){},route:function(e,r,i){return n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),this.trigger("route",r,s),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(E,"\\$&").replace(y,"(?:$1)?").replace(b,function(e,t){return t?e:"([^/]+)"}).replace(w,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var S=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},x=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,N=/msie [\w.]+/,C=/\/$/;S.started=!1,n.extend(S.prototype,h,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(C,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(x,"")},start:function(e){if(S.started)throw new Error("Backbone.history has already been started");S.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=N.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(T,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,u=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(x,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search));if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),S.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!S.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new S;var k=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},L=/^(\S+)\s*(.*)$/,A=["model","collection","el","id","attributes","className","tagName","events"];n.extend(k.prototype,h,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(L),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,A)),this.options=e},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}});var O={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.sync=function(e,r,i){var s=O[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||_()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.success;i.success=function(e){a&&a(r,e,i),r.trigger("sync",r,e,i)};var f=i.error;i.error=function(e){f&&f(r,e,i),r.trigger("error",r,e,i)};var l=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,l,i),l},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var M=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};p.extend=d.extend=g.extend=k.extend=S.extend=M;var _=function(){throw new Error('A "url" property or function must be specified')};return t}),define("BaseView",["jquery","underscore","backbone"],function(e,t,n){var r=function(e){this.bindings=[],this.views=[],this.intervals=[],n.View.apply(this,[e])};return t.extend(r.prototype,n.View.prototype,{createView:function(e,t){var n=new e(t);return this.views.push(n),n},createInterval:function(e,t){var n=setInterval(t,e);return this.intervals.push(n),n},bindTo:function(e,t,n,r){return this.bindings.push({item:e,ev:t,callback:n}),e.on(t,n,r)},unbindAll:function(){var e,t;for(e=this.bindings.length;e>0;e-=1)t=this.bindings.pop(),t.item.off(t.ev,t.callback);this.off()},clearIntervals:function(){var e,t;for(e=this.intervals.length;e>0;e-=1)t=this.intervals.pop(),clearInterval(t)},trash:function(){return this.unbindAll(),this.clearIntervals(),this.remove(),null},dispose:function(){var e,t;for(e=this.views.length;e>0;e-=1)t=this.views.pop(),t.dispose();return this.trash()}}),r.extend=n.View.extend,r}),define("models/Comment",["underscore","backbone"],function(e,t){var n=t.Model.extend({initialize:function(){this.on("error",function(e,t){ticketer.EventEmitter.trigger("error",t)})},validate:function(e){if(typeof e.comment!="undefined"&&!e.comment.replace(/ /g,"").length)return"Comment must have content to post."}});return n}),define("collections/Comments",["underscore","backbone","models/Comment"],function(e,t,n){var r=t.Collection.extend({model:n,initialize:function(e,t){this.options=t||{},this.url="/api/tickets/"+t.ticketId+"/comments",this.comparator=function(e){var t=new Date(e.get("created_at"));return t.getTime()},ticketer.EventEmitter.on("comment:new",this.addComment,this),ticketer.EventEmitter.on("comment:update",this.updateComment,this),ticketer.EventEmitter.on("comment:remove",this.removeComment,this)},fetch:function(e){t.Collection.prototype.fetch.call(this,{success:e})},destroy:function(){return this.reset(),ticketer.EventEmitter.off(null,null,this),null},addComment:function(t){var n=e.clone(t),r=this.get(n.id);if(r)return!1;n.ticket===this.options.ticketId&&(delete n.ticket,this.add(n))},updateComment:function(t){var n=e.clone(t),r=this.get(n.id);r&&r.set(r.parse(n))},removeComment:function(e){var t=this.get(e.comment);t&&this.remove(t)}});return r}),define("models/Ticket",["underscore","backbone","collections/Comments"],function(e,t,n){var r=t.Model.extend({defaults:{status:"Open"},urlRoot:"/api/tickets",initialize:function(){var t=this,n=ticketer.currentUser;this.get("status")==="open"&&(this.on("assignedUser",function(){var r=e.include(t.get("assigned_to"),n.id);r&&t.set("participating",!0)}),this.on("unassignedUser",function(){var r=e.include(t.get("assigned_to"),n.id);r||t.set("participating",!1)})),t.get("user")&&t.get("user").id===n.id&&t.set("participating",!0),this.on("sync",function(){t.get("user").id===n.id&&t.set("participating",!0)}),this.on("error",function(e,t){ticketer.EventEmitter.trigger("error",t)}),this.on("change:status",function(e,t){t==="closed"&&typeof e.collection!="undefined"&&e.collection.remove(e.id)})},isOpen:function(){return this.get("status")==="open"},participating:function(){return this.get("participating")?this.get("participating"):!1},notification:function(){return this.get("notification")&&this.get("notification")===!0},removeNotification:function(){this.unset("notification")},validate:function(e){if(typeof e.title!="undefined"&&!e.title.replace(/ /g,"").length)return"You must enter a ticket title.";if(typeof e.description!="undefined"&&!e.description.replace(/ /g,"").length)return"You must enter a ticket description."},updateTicket:function(e,t){e.title&&this.set({title:e.title}),e.description&&this.set({description:e.description}),e.status&&this.set({status:e.status}),this.save(null,{error:t})},close:function(e){this.save({status:"closed"},{error:e})},assignUser:function(t,n){var r=e.clone(this.get("assigned_to"));r.push(t),this.set({assigned_to:e.uniq(r)},{silent:!0}),this.trigger("assignedUser",this),this.save(null,{error:n})},unassignUser:function(t,n){var r=e.clone(this.get("assigned_to")),i=e.reject(r,function(e){return e===t});this.set({assigned_to:e.uniq(i)},{silent:!0}),this.trigger("unassignedUser",this),this.save(null,{error:n})},responseTime:function(){if(this.get("closed_at")){var e,t,n,r,i=new Date(this.get("closed_at")),s=new Date(this.get("opened_at")),o=i.getTime()-s.getTime();return e=Math.floor(o/1e3/60/60/24),o-=e*1e3*60*60*24,t=Math.floor(o/1e3/60/60),o-=t*1e3*60*60,n=Math.floor(o/1e3/60),e.toString()+" days, "+t.toString()+" hours, "+n.toString()+" minutes"}return!1}});return r}),define("collections/Tickets",["underscore","backbone","models/Ticket"],function(e,t,n){var r=t.Collection.extend({model:n,url:"/api/tickets",initialize:function(e,t){t=t||{},this.comparator=t.comparator||function(e){var t=new Date(e.get("opened_at"));return-t.getTime()},ticketer.EventEmitter.on("comment:new comment:update",this.addNotification,this),ticketer.EventEmitter.on("ticket:update",this.updateTicket,this),ticketer.EventEmitter.on("ticket:remove",this.removeTicket,this)},destroy:function(){return this.reset(),ticketer.EventEmitter.off(null,null,this),null},addNotification:function(t){var n=e.clone(t),r=this.get(n.ticket);r&&n.notification&&r.set({notification:n.notification})},updateTicket:function(t){var n=e.clone(t),r=this.get(n.id);r&&r.set(r.parse(n))},removeTicket:function(e){this.remove(e)}});return r}),define("views/helpers/FillerView",["jquery","underscore","BaseView"],function(e,t,n){var r=n.extend({className:"view-filler",render:function(){return this.$el.html("<p>Select an item to view it's details.</p>"),this}});return r}),!function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",a.cssRules.length),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function v(e){if(!this.spin)return new v(e);this.opts=h(e||{},v.defaults,d)}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style",{type:"text/css"});return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};v.defaults={},h(v.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{position:n.position,width:0,zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r),c(r,{left:(n.left=="auto"?a.x-u.x+(e.offsetWidth>>1):parseInt(n.left,10)+i)+"px",top:(n.top=="auto"?a.y-u.y+(e.offsetHeight>>1):parseInt(n.top,10)+i)+"px"})),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;(function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),function(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=c(o("group"),{behavior:"url(#default#VML)"});!l(t,"transform")&&t.adj?(a.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(t,n){function s(){return c(e("group",{coordsize:i+" "+i,coordorigin:-r+" "+ -r}),{width:i,height:i})}function l(t,i,o){u(a,u(c(s(),{rotation:360/n.lines*t+"deg",left:~~i}),u(c(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:o}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,i=2*r,o=-(n.width+n.length)*2+"px",a=c(s(),{position:"absolute",top:o,left:o}),f;if(n.shadow)for(f=1;f<=n.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=n.lines;f++)l(f);return u(t,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):s=l(t,"animation")}(),typeof define=="function"&&define.amd?define("spin",[],function(){return v}):e.Spinner=v}(window,document),define("views/helpers/SpinnerView",["jquery","underscore","BaseView","spin"],function(e,t,n,r){var i=n.extend({className:"spin-wrap",initialize:function(){this.opts={lines:11,length:7,width:4,radius:10,corners:1,rotate:0,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}},render:function(){var e=(new r(this.opts)).spin();return this.$el.html(e.el),this.$el.append("<p>Loading</p>"),this}});return i});var Mustache=function(){var e={},t=function(){};return t.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(e,t,n,r){r||(this.context=t,this.buffer=[]);if(!this.includes("",e)){if(r)return e;this.send(e);return}e=this.render_pragmas(e);var i=this.render_section(e,t,n);i===!1&&(i=this.render_tags(e,t,n,r));if(r)return i;this.sendLines(i)},send:function(e){e!==""&&this.buffer.push(e)},sendLines:function(e){if(e){var t=e.split("\n");for(var n=0;n<t.length;n++)this.send(t[n])}},render_pragmas:function(e){if(!this.includes("%",e))return e;var t=this,n=this.getCachedRegex("render_pragmas",function(e,t){return new RegExp(e+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+t,"g")});return e.replace(n,function(e,n,r){if(!t.pragmas_implemented[n])throw{message:"This implementation of mustache doesn't understand the '"+n+"' pragma"};t.pragmas[n]={};if(r){var i=r.split("=");t.pragmas[n][i[0]]=i[1]}return""})},render_partial:function(e,t,n){e=this.trim(e);if(!n||n[e]===undefined)throw{message:"unknown_partial '"+e+"'"};return typeof t[e]!="object"?this.render(n[e],t,n,!0):this.render(n[e],t[e],n,!0)},render_section:function(e,t,n){if(!this.includes("#",e)&&!this.includes("^",e))return!1;var r=this,i=this.getCachedRegex("render_section",function(e,t){return new RegExp("^([\\s\\S]*?)"+e+"(\\^|\\#)\\s*(.+)\\s*"+t+"\n*([\\s\\S]*?)"+e+"\\/\\s*\\3\\s*"+t+"\\s*([\\s\\S]*)$","g")});return e.replace(i,function(e,i,s,o,u,a){var f=i?r.render_tags(i,t,n,!0):"",l=a?r.render(a,t,n,!0):"",c,h=r.find(o,t);return s==="^"?!h||r.is_array(h)&&h.length===0?c=r.render(u,t,n,!0):c="":s==="#"&&(r.is_array(h)?c=r.map(h,function(e){return r.render(u,r.create_context(e),n,!0)}).join(""):r.is_object(h)?c=r.render(u,r.create_context(h),n,!0):typeof h=="function"?c=h.call(t,u,function(e){return r.render(e,t,n,!0)}):h?c=r.render(u,t,n,!0):c=""),f+c+l})},render_tags:function(e,t,n,r){var i=this,s=function(){return i.getCachedRegex("render_tags",function(e,t){return new RegExp(e+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+t+"+","g")})},o=s(),u=function(e,r,u){switch(r){case"!":return"";case"=":return i.set_delimiters(u),o=s(),"";case">":return i.render_partial(u,t,n);case"{":return i.find(u,t);default:return i.escape(i.find(u,t))}},a=e.split("\n");for(var f=0;f<a.length;f++)a[f]=a[f].replace(o,u,this),r||this.send(a[f]);if(r)return a.join("\n")},set_delimiters:function(e){var t=e.split(" ");this.otag=this.escape_regex(t[0]),this.ctag=this.escape_regex(t[1])},escape_regex:function(e){if(!arguments.callee.sRE){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,t){function n(e){return e===!1||e===0||e}e=this.trim(e);var r;if(e.match(/([a-z_]+)\./ig)){var i=this.walk_context(e,t);n(i)&&(r=i)}else n(t[e])?r=t[e]:n(this.context[e])&&(r=this.context[e]);return typeof r=="function"?r.apply(t):r!==undefined?r:""},walk_context:function(e,t){var n=e.split("."),r=t[n[0]]!=undefined?t:this.context,i=r[n.shift()];while(i!=undefined&&n.length>0)r=i,i=i[n.shift()];return typeof i=="function"?i.apply(r):i},includes:function(e,t){return t.indexOf(this.otag+e)!=-1},escape:function(e){return e=String(e===null?"":e),e.replace(/&(?!\w+;)|["'<>\\]/g,function(e){switch(e){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return e}})},create_context:function(e){if(this.is_object(e))return e;var t=".";this.pragmas["IMPLICIT-ITERATOR"]&&(t=this.pragmas["IMPLICIT-ITERATOR"].iterator);var n={};return n[t]=e,n},is_object:function(e){return e&&typeof e=="object"},is_array:function(e){return Object.prototype.toString.call(e)==="[object Array]"},trim:function(e){return e.replace(/^\s*|\s*$/g,"")},map:function(e,t){if(typeof e.map=="function")return e.map(t);var n=[],r=e.length;for(var i=0;i<r;i++)n.push(t(e[i]));return n},getCachedRegex:function(t,n){var r=e[this.otag];r||(r=e[this.otag]={});var i=r[this.ctag];i||(i=r[this.ctag]={});var s=i[t];return s||(s=i[t]=n(this.otag,this.ctag)),s}},{name:"mustache.js",version:"0.4.0-dev",to_html:function(e,n,r,i){var s=new t;i&&(s.send=i),s.render(e,n||{},r);if(!i)return s.buffer.join("\n")}}}();define("mustache",function(){}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!templates/widgets/TagListWidget.html",[],function(){return'<h4 class="title">Tags</h4>\n<ul class="group tags"></ul>'}),define("text!templates/widgets/Tag.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="tag color-{{color}}">\n  <i class="icon-bookmark"></i><span data-action="edit">{{name}}</span>\n</li>'}),define("text!templates/widgets/TagEdit.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="editable color-{{color}}">\n  <i class="icon-bookmark"></i><input type="text" value="{{name}}"><span data-action="delete" class="close">&times;</span>\n</li>'}),define("views/widgets/TagListWidgetView",["jquery","underscore","backbone","BaseView","text!templates/widgets/TagListWidget.html","text!templates/widgets/Tag.html","text!templates/widgets/TagEdit.html"],function(e,t,n,r,i,s,o){var u=r.extend({className:"option-set tag-list-widget",events:{"click .tag[data-id]":"filterListView","dblclick [data-action='edit']":"editTag","mousedown [data-action='delete']":"deleteTag","blur .editable input":"saveTag"},initialize:function(){this.bindTo(this.collection,"add remove reset",this.renderTags,this)},render:function(){return this.$el.html(Mustache.to_html(i)),this.renderTags(),this},renderTags:function(){var e=this,t=[];this.collection.length?this.collection.each(function(n){t.push(e.renderTag(n))}):t.push('<li class="empty">You have no tags</li>'),this.$el.find(".group").html(t.join(""))},renderTag:function(e){var t=e.toJSON();return t.color=ticketer.colors[t.color].name,Mustache.to_html(s,t)},filterListView:function(t){var n=e(t.currentTarget),r=ticketer.collections.lists.get(n.data("id")),i=r.get("tickets");n.hasClass("active")?(n.removeClass("active"),ticketer.collections.openTickets.trigger("filter")):(n.siblings().removeClass("active"),n.addClass("active"),ticketer.collections.openTickets.trigger("filter",function(e){return~i.indexOf(e.id)}))},editTag:function(t){var n=e(t.currentTarget).parent(),r=this.collection.get(n.data("id")).toJSON();r.color=ticketer.colors[r.color].name,n.replaceWith(Mustache.to_html(o,r)),this.$el.find("input").focus()},saveTag:function(e){var t,n=this,r=this.$el.find(".editable"),i=r.find("input").val(),s=this.collection.get(r.data("id"));s&&(s.save({name:i}),r.replaceWith(n.renderTag(s)))},deleteTag:function(t){var n=e(t.currentTarget).parent(),r=this.collection.get(n.data("id"));r?r.destroy():console.error("Attempted to get tag: #"+id+", but failed."),t.stopPropagation(),t.stopImmediatePropagation()}});return u}),define("text!templates/toolbars/Toolbar.html",[],function(){return'<div class="option-set">\n  <h4 class="title">Tickets</h4>\n  <ul class="group">\n    <li><a href="#" data-route="tickets/mine"><i class="icon-home"></i> My Tickets<span data-role="my-count" class="count"></span></a></li>\n    <li><a href="#" data-route="tickets/open"><i class="icon-inbox"></i> Open Tickets<span data-role="open-count" class="count"></span></a></li>\n    <li><a href="#" data-route="tickets/closed"><i class="icon-ban-circle"></i> Closed Tickets</a></li>\n  </ul>\n</div>'}),define("views/toolbars/MainToolbarView",["jquery","underscore","backbone","BaseView","mustache","views/widgets/TagListWidgetView","text!templates/toolbars/Toolbar.html"],function(e,t,n,r,i,s,o){var u=r.extend({className:"sidebar",events:{"click a[data-route]":"navigateTo"},initialize:function(){var e=ticketer.collections.openTickets;this.bindTo(e,"add remove reset change",this.renderCounts,this)},render:function(){return this.$el.html(Mustache.to_html(o)),this.renderCounts(),this.renderTagWidget(),this},renderCounts:function(){var t=ticketer.collections.openTickets.filter(function(e){return e.participating()&&e.notification()}).length,n=ticketer.collections.openTickets.filter(function(e){return!e.get("assigned_to").length}).length;t===0?e('[data-role="my-count"]',this.el).hide():e('[data-role="my-count"]',this.el).text(t).show(),n===0?e('[data-role="open-count"]',this.el).hide():e('[data-role="open-count"]',this.el).text(n).show()},renderTagWidget:function(){var e=this.createView(s,{collection:ticketer.collections.lists});this.$el.append(e.render().el)},navigateTo:function(t){t.preventDefault();var n=e(t.target).data("route");this.selectTab(n),ticketer.routers.ticketer.navigate(n,!0)},selectTab:function(e){return this.$el.find(".group > .active").removeClass("active"),e&&this.$el.find('a[data-route="'+e+'"]').parent().addClass("active"),this}});return u}),define("text!templates/widgets/UserWidget.html",[],function(){return'<a class="add" data-action="display" title="Assign a user" href="#"><i class="icon-plus"></i></a>\n<input data-action="assign" type="text" placeholder="Find a user">\n<ul data-role="results-list" class="results-list"></ul>'}),define("text!templates/widgets/User.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="user">\n  <img alt="{{name}}" src="{{avatar}}"> {{name}}\n</li>'}),define("views/widgets/UserWidgetView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/UserWidget.html","text!templates/widgets/User.html"],function(e,t,n,r,i,s,o){var u=r.extend({tagName:"li",className:"widget user-widget",attributes:{"data-role":"assign-user"},events:{"click [data-action='display']":"bindEvents","blur [data-action='assign']":"unbindEvents","click [data-role='results-list'] li":"assignUser"},render:function(){return this.$el.html(Mustache.to_html(s)),this},renderUser:function(e){return Mustache.to_html(o,e)},renderFilteredResults:function(t){var n,r=e(t.currentTarget).val(),i=this.$el.find('[data-role="results-list"]'),s=i.children(".active");t.keyCode===13&&s.length?this.model.assignUser(s.data("id")):t.keyCode===40&&s.length?(n=(s.index()+1)%i.children().length,s.removeClass("active"),e(i.children().get(n)).addClass("active")):r.replace(/\s+/g,"").length?(i.html(this.filterUsers(r.toLowerCase())).fadeIn(400),i.children(":first").addClass("active")):i.empty()},filterUsers:function(e){var t=this,n=[];return this.collection.each(function(r){var i=r.get("name").toLowerCase();~i.indexOf(e)&&!~t.model.get("assigned_to").indexOf(r.id)&&n.push(t.renderUser(r.toJSON()))}),n.slice(0,4).join("")},bindEvents:function(e){this.$el.find("input").on("keyup",this.renderFilteredResults.bind(this)),this.$el.find("a").hide(),this.$el.find("input").fadeIn(200).focus(),e.preventDefault()},unbindEvents:function(e){var t=this;this.$el.find("input").off("keyup"),this.$el.find(".results-list, input").fadeOut(200,function(){t.$el.find("input").val(""),t.$el.find("a").show(200)})},assignUser:function(t){var n=e(t.currentTarget).data("id");t.preventDefault(),t.stopPropagation(),this.model.assignUser(n)},unassignUser:function(t){var n=e(t.currentTarget).parent().data("id");t.preventDefault(),t.stopPropagation(),this.model.unassignUser(n)}});return u}),define("text!templates/tickets/AssignedUser.html",[],function(){return'<li class="user" data-id="{{id}}"><img title="{{name}}" alt="{{fullname}}" src="{{avatar}}"></li>'}),define("views/tickets/TicketAssignView",["jquery","underscore","mustache","BaseView","views/widgets/UserWidgetView","text!templates/tickets/AssignedUser.html"],function(e,t,n,r,i,s){var o=r.extend({tagName:"ul",className:"assigned-users",events:{"click li.user":"unAssignUser"},initialize:function(){this.bindTo(this.model,"change:assigned_to",this.render,this)},render:function(){var e,t=this,n=this.model.get("assigned_to");return this.$el.empty(),this.widget&&this.widget.dispose(),e=ticketer.collections.users.filter(function(e){return~n.indexOf(e.id)}),e.forEach(function(e){t.$el.append(Mustache.to_html(s,e.toJSON()))}),this.renderWidget(),this},renderWidget:function(){this.widget=this.createView(i,{collection:ticketer.collections.users,model:this.model}),this.$el.append(this.widget.render().el)},unAssignUser:function(t){var n=e(t.currentTarget).data("id"),r=confirm("Remove the user from the Ticket?");r&&this.model.unassignUser(n)}});return o}),define("text!templates/widgets/TagWidget.html",[],function(){return'<a class="add tag-widget" data-action="display" title="Assign tag" href="#"><i class="icon-plus"></i></a>\n<ul class="tags"></ul>'}),define("views/widgets/TagWidgetView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/TagWidget.html","text!templates/widgets/Tag.html"],function(e,t,n,r,i,s,o){var u=r.extend({tagName:"li",className:"widget tag-widget",attributes:{"data-role":"assign-tag"},events:{"click [data-action='display']":"renderTags","click li":"assignTag"},initialize:function(){var t=this;this.$el.on("click",function(e){e.stopPropagation()}),e("html").on("click.tag-widget.data-api",function(){t.hideTags()})},dispose:function(){return e("html").off("click.tag-widget.data-api"),r.prototype.dispose.call(this)},render:function(){return this.$el.html(Mustache.to_html(s)),this},renderTags:function(e){var t=this,n=this.model.id,r=this.$el.find(".tags");return r.empty(),this.collection.each(function(e){e.hasTicket(n)||r.append(t.renderTag(e)).fadeIn(200)}),e.preventDefault(),this},renderTag:function(e){var t=e.toJSON();return t.color=ticketer.colors[t.color].name,Mustache.to_html(o,t)},assignTag:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);r&&(r.addTicket(this.model.id),this.model.trigger("tag:add",r)),this.hideTags()},hideTags:function(){this.$el.find(".tags").fadeOut(200,function(){e(this).empty()})}});return u}),define("text!templates/tickets/AssignedTag.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="tag color-{{color}}">\n  <i class="icon-bookmark"></i>\n</li>'}),define("views/tickets/TicketTagView",["jquery","underscore","backbone","BaseView","mustache","views/widgets/TagWidgetView","text!templates/tickets/AssignedTag.html"],function(e,t,n,r,i,s,o){var u=r.extend({tagName:"ul",className:"assigned-tags",events:{"click li.tag":"unassignTag"},initialize:function(){this.bindTo(this.model,"tag:add tag:remove",this.render,this)},render:function(){var e,t,n,r=this;this.$el.empty(),this.widget&&this.widget.dispose(),n=ticketer.collections.lists.filter(function(e){return e.hasTicket(r.model.id)}),this.renderWidget(),n.length===0&&this.$el.append("<li class='empty'>Add a Tag</li>");for(e=0,t=n.length;e<t;e++)this.$el.append(this.renderTag(n[e]));return this},renderTag:function(e){var t=e.toJSON();return t.color=ticketer.colors[t.color].name,Mustache.to_html(o,t)},renderWidget:function(){this.widget=this.createView(s,{collection:ticketer.collections.lists,model:this.model}),this.$el.append(this.widget.render().el)},unassignTag:function(t){var n,r=e(t.currentTarget).data("id"),i=confirm("Remove this tag from the Ticket?");i&&(n=ticketer.collections.lists.get(r),n&&(n.removeTicket(this.model.id),this.model.trigger("tag:remove",n)))}});return u}),define("views/tickets/TicketMetaView",["jquery","underscore","mustache","BaseView","views/tickets/TicketAssignView","views/tickets/TicketTagView"],function(e,t,n,r,i,s){var o=r.extend({className:"ticket-meta",render:function(){return this.renderAssignView(),this.renderTagWidget(),this},renderAssignView:function(){var e;e=this.createView(i,{model:this.model}),this.$el.append(e.render().el)},renderTagWidget:function(){var e;e=this.createView(s,{model:this.model}),this.$el.append(e.render().el)}});return o}),define("text!templates/tickets/Ticket.html",[],function(){return'<div class="ticket-content">\n  <div class="header {{statusClass}}">\n    <hgroup>\n      <h2 class="title">{{title}}</h2>\n      <h4>{{user.name}}</h4>\n    </hgroup>\n\n    <div class="attrs">\n\n      {{#fullDate}}\n        <time title="{{hoverTime}}" datetime="{{datetime}}">{{fullDate}}</time>\n      {{/fullDate}}\n\n      {{^fullDate}}\n        <time title="{{hoverTime}}" datetime="{{datetime}}">{{cleanTime}}</time>\n      {{/fullDate}}\n\n      {{#showTags}}\n        <ul class="tags"></ul>\n      {{/showTags}}\n\n    </div>\n\n    {{#isEditable}}\n      <ul class="edit-options">\n        {{#isAdmin}}\n          <li data-role="close-ticket"><a data-action="close" href="#"><i class="icon-ok"></i></a></li>\n        {{/isAdmin}}\n        <li><a data-action="edit" href="#"><i class="icon-edit"></i></a></li>\n        <li><a data-action="delete" href="#"><i class="icon-trash"></i></a></li>\n      </ul>\n    {{/isEditable}}\n  </div>\n\n  {{#description}}\n    <div class="content md">\n      {{{description}}}\n    </div>\n  {{/description}}\n</div>'}),define("text!templates/tickets/EditTicket.html",[],function(){return'<div class="ticket-form">\n	<div class="wrap">\n  	<textarea name="description">{{description}}</textarea>\n  </div>\n  <div class="actions">\n    <ul class="right">\n      <li><button data-action="save">Save</button></li>\n      <li><button data-action="cancel" class="cancel">Cancel</button></li>\n    </ul>\n  </div>\n</div>'}),define("text!templates/tickets/ClosedNotification.html",[],function(){return'<div class="notification">\n  <p>This ticket has been closed.</p>\n</div>'}),function(e){function t(e,t,n,r){var i=n.lang();return i[e].call?i[e](n,r):i[e][t]}function n(e,t){return function(n){return u(e.call(this,n),t)}}function r(e){return function(t){var n=e.call(this,t);return n+this.lang().ordinal(n)}}function i(e,t,n){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=n||!1}function s(e){var t=this._data={},n=e.years||e.y||0,r=e.months||e.M||0,i=e.weeks||e.w||0,s=e.days||e.d||0,u=e.hours||e.h||0,a=e.minutes||e.m||0,f=e.seconds||e.s||0,l=e.milliseconds||e.ms||0;this._milliseconds=l+f*1e3+a*6e4+u*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=l%1e3,f+=o(l/1e3),t.seconds=f%60,a+=o(f/60),t.minutes=a%60,u+=o(a/60),t.hours=u%24,s+=o(u/24),s+=i*7,t.days=s%30,r+=o(s/30),t.months=r%12,n+=o(r/12),t.years=n,this._lang=!1}function o(e){return e<0?Math.ceil(e):Math.floor(e)}function u(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function a(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function f(e){return Object.prototype.toString.call(e)==="[object Array]"}function l(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function c(e,t,n,r){var i,s,o=[];for(i=0;i<7;i++)o[i]=e[i]=e[i]==null?i===2?1:0:e[i];return e[7]=o[7]=t,e[8]!=null&&(o[8]=e[8]),e[3]+=n||0,e[4]+=r||0,s=new Date(0),t?(s.setUTCFullYear(e[0],e[1],e[2]),s.setUTCHours(e[3],e[4],e[5],e[6])):(s.setFullYear(e[0],e[1],e[2]),s.setHours(e[3],e[4],e[5],e[6])),s._a=o,s}function h(e,t){var n,r,i=[];!t&&D&&(t=require("./lang/"+e));for(n=0;n<P.length;n++)t[P[n]]=t[P[n]]||M.en[P[n]];for(n=0;n<12;n++)r=k([2e3,n]),i[n]=new RegExp("^"+(t.months[n]||t.months(r,""))+"|^"+(t.monthsShort[n]||t.monthsShort(r,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||i,M[e]=t,t}function p(e){var t=typeof e=="string"&&e||e&&e._lang||null;return t?M[t]||h(t):k}function d(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function v(e){var t=e.match(B),n,r;for(n=0,r=t.length;n<r;n++)tt[t[n]]?t[n]=tt[t[n]]:t[n]=d(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function m(e,t){function n(t){return e.lang().longDateFormat[t]||t}var r=5;while(r--&&j.test(t))t=t.replace(j,n);return Y[t]||(Y[t]=v(t)),Y[t](e)}function g(e){switch(e){case"DDDD":return R;case"YYYY":return U;case"S":case"SS":case"SSS":case"DDD":return q;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return z;case"Z":case"ZZ":return W;case"T":return X;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return I;default:return new RegExp(e.replace("\\",""))}}function y(e,t,n,r){var i,s;switch(e){case"M":case"MM":n[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++)if(p().monthsParse[i].test(t)){n[1]=i,s=!0;break}s||(n[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(n[2]=~~t);break;case"YY":n[0]=~~t+(~~t>70?1900:2e3);break;case"YYYY":n[0]=~~Math.abs(t);break;case"a":case"A":r.isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":n[3]=~~t;break;case"m":case"mm":n[4]=~~t;break;case"s":case"ss":n[5]=~~t;break;case"S":case"SS":case"SSS":n[6]=~~(("0."+t)*1e3);break;case"Z":case"ZZ":r.isUTC=!0,i=(t+"").match(K),i&&i[1]&&(r.tzh=~~i[1]),i&&i[2]&&(r.tzm=~~i[2]),i&&i[0]==="+"&&(r.tzh=-r.tzh,r.tzm=-r.tzm)}t==null&&(n[8]=!1)}function b(e,t){var n=[0,0,1,0,0,0,0],r={tzh:0,tzm:0},i=t.match(B),s,o;for(s=0;s<i.length;s++)o=(g(i[s]).exec(e)||[])[0],o&&(e=e.slice(e.indexOf(o)+o.length)),tt[i[s]]&&y(i[s],o,n,r);return r.isPm&&n[3]<12&&(n[3]+=12),r.isPm===!1&&n[3]===12&&(n[3]=0),c(n,r.isUTC,r.tzh,r.tzm)}function w(e,t){var n,r=e.match(F)||[],s,o=99,u,a,f;for(u=0;u<t.length;u++)a=b(e,t[u]),s=m(new i(a),t[u]).match(F)||[],f=l(r,s),f<o&&(o=f,n=a);return n}function E(e){var t="YYYY-MM-DDT",n;if(V.exec(e)){for(n=0;n<4;n++)if(J[n][1].exec(e)){t+=J[n][0];break}return W.exec(e)?b(e,t+" Z"):b(e,t)}return new Date(e)}function S(e,t,n,r,i){var s=i.relativeTime[e];return typeof s=="function"?s(t||1,!!n,e,r):s.replace(/%d/i,t||1)}function x(e,t,n){var r=A(Math.abs(e)/1e3),i=A(r/60),s=A(i/60),o=A(s/24),u=A(o/365),a=r<45&&["s",r]||i===1&&["m"]||i<45&&["mm",i]||s===1&&["h"]||s<22&&["hh",s]||o===1&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",A(o/30)]||u===1&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,S.apply({},a)}function T(e,t){k.fn[e]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}function N(e){k.duration.fn[e]=function(){return this._data[e]}}function C(e,t){k.duration.fn["as"+e]=function(){return+this/t}}var k,L="1.7.2",A=Math.round,O,M={},_="en",D=typeof module!="undefined"&&module.exports,P="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),H=/^\/?Date\((\-?\d+)/i,B=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,j=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,F=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,I=/\d\d?/,q=/\d{1,3}/,R=/\d{3}/,U=/\d{1,4}/,z=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,W=/Z|[\+\-]\d\d:?\d\d/i,X=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,$="YYYY-MM-DDTHH:mm:ssZ",J=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],K=/([\+\-]|\d\d)/gi,Q="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),G={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Y={},Z="DDD w M D d".split(" "),et="M D H h m s w".split(" "),tt={M:function(){return this.month()+1},MMM:function(e){return t("monthsShort",this.month(),this,e)},MMMM:function(e){return t("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var e=new Date(this.year(),this.month(),this.date()),t=new Date(this.year(),0,1);return~~((e-t)/864e5+1.5)},d:function(){return this.day()},dd:function(e){return t("weekdaysMin",this.day(),this,e)},ddd:function(e){return t("weekdaysShort",this.day(),this,e)},dddd:function(e){return t("weekdays",this.day(),this,e)},w:function(){var e=new Date(this.year(),this.month(),this.date()-this.day()+5),t=new Date(e.getFullYear(),0,4);return~~((e-t)/864e5/7+1.5)},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return u(~~(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(e/60),2)+":"+u(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(10*e/6),4)}};while(Z.length)O=Z.pop(),tt[O+"o"]=r(tt[O]);while(et.length)O=et.pop(),tt[O+O]=n(tt[O],2);tt.DDDD=n(tt.DDD,3),k=function(t,n){if(t===null||t==="")return null;var r,s;return k.isMoment(t)?new i(new Date(+t._d),t._isUTC,t._lang):(n?f(n)?r=w(t,n):r=b(t,n):(s=H.exec(t),r=t===e?new Date:s?new Date(+s[1]):t instanceof Date?t:f(t)?c(t):typeof t=="string"?E(t):new Date(t)),new i(r))},k.utc=function(e,t){return f(e)?new i(c(e,!0),!0):(typeof e=="string"&&!W.exec(e)&&(e+=" +0000",t&&(t+=" Z")),k(e,t).utc())},k.unix=function(e){return k(e*1e3)},k.duration=function(e,t){var n=k.isDuration(e),r=typeof e=="number",i=n?e._data:r?{}:e,o;return r&&(t?i[t]=e:i.milliseconds=e),o=new s(i),n&&(o._lang=e._lang),o},k.humanizeDuration=function(e,t,n){return k.duration(e,t===!0?null:t).humanize(t===!0?!0:n)},k.version=L,k.defaultFormat=$,k.lang=function(e,t){var n;if(!e)return _;(t||!M[e])&&h(e,t);if(M[e]){for(n=0;n<P.length;n++)k[P[n]]=M[e][P[n]];k.monthsParse=M[e].monthsParse,_=e}},k.langData=p,k.isMoment=function(e){return e instanceof i},k.isDuration=function(e){return e instanceof s},k.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"}}),k.fn=i.prototype={clone:function(){return k(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!l(this._a,(this._a[7]?k.utc(this._a):k(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return m(this,e?e:k.defaultFormat)},add:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,1),this},subtract:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,-1),this},diff:function(e,t,n){var r=this._isUTC?k(e).utc():k(e).local(),i=(this.zone()-r.zone())*6e4,s=this._d-r._d-i,o=this.year()-r.year(),u=this.month()-r.month(),a=this.date()-r.date(),f;return t==="months"?f=o*12+u+a/30:t==="years"?f=o+(u+a/30)/12:f=t==="seconds"?s/1e3:t==="minutes"?s/6e4:t==="hours"?s/36e5:t==="days"?s/864e5:t==="weeks"?s/6048e5:s,n?f:A(f)},from:function(e,t){return k.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(k(),e)},calendar:function(){var e=this.diff(k().sod(),"days",!0),t=this.lang().calendar,n=t.sameElse,r=e<-6?n:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:n;return this.format(typeof r=="function"?r.apply(this):r)},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<k([this.year()]).zone()||this.zone()<k([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return k.utc([this.year(),this.month()+1,0]).date()},lang:function(t){return t===e?p(this):(this._lang=t,this)}};for(O=0;O<Q.length;O++)T(Q[O].toLowerCase(),Q[O]);T("year","FullYear"),k.duration.fn=s.prototype={weeks:function(){return o(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=this.lang().relativeTime,r=x(t,!e,this.lang()),i=t<=0?n.past:n.future;return e&&(typeof i=="function"?r=i(r):r=i.replace(/%s/i,r)),r},lang:k.fn.lang};for(O in G)G.hasOwnProperty(O)&&(C(O,G[O]),N(O.toLowerCase()));C("Weeks",6048e5),D&&(module.exports=k),typeof ender=="undefined"&&(this.moment=k),typeof define=="function"&&define.amd&&define("moment",[],function(){return k})}.call(this),function(){function c(){var e="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+";return e}function h(e,t){return e=e.source,t=t||"",function n(r,i){return r?(e=e.replace(r,i.source||i),n):new RegExp(e,t)}}function p(){}var e={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:p,hr:/^( *[\-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [^\0]+?(?:rule|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};e.bullet=/(?:[*+-]|\d+\.)/,e.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,e.item=h(e.item,"gm")(/bull/g,e.bullet)(),e.list=h(e.list)(/bull/g,e.bullet)("rule",/\n+(?=(?: *[-*_]){3,})/)(),e.html=h(e.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?!:\/|@)\b(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,c())(),e.paragraph=function(){var t=e.paragraph.source,n=[];return function r(t){return t=e[t]?e[t].source:t,n.push(t.replace(/(^|[^\[])\^/g,"$1")),r}("hr")("heading")("lheading")("blockquote")("<"+c())("def"),new RegExp(t.replace("body",n.join("|")))}(),e.normal={fences:e.fences,paragraph:e.paragraph},e.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/},e.gfm.paragraph=h(e.paragraph)("(?!","(?!"+e.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")(),e.lexer=function(t){var n=[];return n.links={},t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),e.token(t,n,!0)},e.token=function(t,n,r){var t=t.replace(/^ +$/gm,""),i,s,o,u,a,f,l;while(t){if(o=e.newline.exec(t))t=t.substring(o[0].length),o[0].length>1&&n.push({type:"space"});if(o=e.code.exec(t)){t=t.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),n.push({type:"code",text:v.pedantic?o:o.replace(/\n+$/,"")});continue}if(o=e.fences.exec(t)){t=t.substring(o[0].length),n.push({type:"code",lang:o[1],text:o[2]});continue}if(o=e.heading.exec(t)){t=t.substring(o[0].length),n.push({type:"heading",depth:o[1].length,text:o[2]});continue}if(o=e.lheading.exec(t)){t=t.substring(o[0].length),n.push({type:"heading",depth:o[2]==="="?1:2,text:o[1]});continue}if(o=e.hr.exec(t)){t=t.substring(o[0].length),n.push({type:"hr"});continue}if(o=e.blockquote.exec(t)){t=t.substring(o[0].length),n.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),e.token(o,n,r),n.push({type:"blockquote_end"});continue}if(o=e.list.exec(t)){t=t.substring(o[0].length),n.push({type:"list_start",ordered:isFinite(o[2])}),o=o[0].match(e.item),i=!1,l=o.length,f=0;for(;f<l;f++)u=o[f],a=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(a-=u.length,u=v.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+a+"}","gm"),"")),s=i||/\n\n(?!\s*$)/.test(u),f!==l-1&&(i=u[u.length-1]==="\n",s||(s=i)),n.push({type:s?"loose_item_start":"list_item_start"}),e.token(u,n),n.push({type:"list_item_end"});n.push({type:"list_end"});continue}if(o=e.html.exec(t)){t=t.substring(o[0].length),n.push({type:"html",pre:o[1]==="pre",text:o[0]});continue}if(r&&(o=e.def.exec(t))){t=t.substring(o[0].length),n.links[o[1].toLowerCase()]={href:o[2],title:o[3]};continue}if(r&&(o=e.paragraph.exec(t))){t=t.substring(o[0].length),n.push({type:"paragraph",text:o[0]});continue}if(o=e.text.exec(t)){t=t.substring(o[0].length),n.push({type:"text",text:o[0]});continue}}return n};var t={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:p,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`]| {2,}\n|$)/};t._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,t._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/,t.link=h(t.link)("inside",t._linkInside)("href",t._linkHref)(),t.reflink=h(t.reflink)("inside",t._linkInside)(),t.normal={url:t.url,strong:t.strong,em:t.em,text:t.text},t.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/},t.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/},t.lexer=function(e){var i="",s=r.links,o,u,a,c;while(e){if(c=t.escape.exec(e)){e=e.substring(c[0].length),i+=c[1];continue}if(c=t.autolink.exec(e)){e=e.substring(c[0].length),c[2]==="@"?(u=c[1][6]===":"?l(c[1].substring(7)):l(c[1]),a=l("mailto:")+u):(u=f(c[1]),a=u),i+='<a href="'+a+'">'+u+"</a>";continue}if(c=t.url.exec(e)){e=e.substring(c[0].length),u=f(c[1]),a=u,i+='<a href="'+a+'">'+u+"</a>";continue}if(c=t.tag.exec(e)){e=e.substring(c[0].length),i+=v.sanitize?f(c[0]):c[0];continue}if(c=t.link.exec(e)){e=e.substring(c[0].length),i+=n(c,{href:c[2],title:c[3]});continue}if((c=t.reflink.exec(e))||(c=t.nolink.exec(e))){e=e.substring(c[0].length),o=(c[2]||c[1]).replace(/\s+/g," "),o=s[o.toLowerCase()];if(!o||!o.href){i+=c[0][0],e=c[0].substring(1)+e;continue}i+=n(c,o);continue}if(c=t.strong.exec(e)){e=e.substring(c[0].length),i+="<strong>"+t.lexer(c[2]||c[1])+"</strong>";continue}if(c=t.em.exec(e)){e=e.substring(c[0].length),i+="<em>"+t.lexer(c[2]||c[1])+"</em>";continue}if(c=t.code.exec(e)){e=e.substring(c[0].length),i+="<code>"+f(c[2],!0)+"</code>";continue}if(c=t.br.exec(e)){e=e.substring(c[0].length),i+="<br>";continue}if(c=t.text.exec(e)){e=e.substring(c[0].length),i+=f(c[0]);continue}}return i};var n=function(e,n){return e[0][0]!=="!"?'<a href="'+f(n.href)+'"'+(n.title?' title="'+f(n.title)+'"':"")+">"+t.lexer(e[1])+"</a>":'<img src="'+f(n.href)+'" alt="'+f(e[1])+'"'+(n.title?' title="'+f(n.title)+'"':"")+">"},r,i,s=function(){return i=r.pop()},o=function(){switch(i.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+i.depth+">"+t.lexer(i.text)+"</h"+i.depth+">\n";case"code":return v.highlight&&(i.code=v.highlight(i.text,i.lang),i.code!=null&&i.code!==i.text&&(i.escaped=!0,i.text=i.code)),i.escaped||(i.text=f(i.text,!0)),"<pre><code"+(i.lang?' class="lang-'+i.lang+'"':"")+">"+i.text+"</code></pre>\n";case"blockquote_start":var e="";while(s().type!=="blockquote_end")e+=o();return"<blockquote>\n"+e+"</blockquote>\n";case"list_start":var n=i.ordered?"ol":"ul",e="";while(s().type!=="list_end")e+=o();return"<"+n+">\n"+e+"</"+n+">\n";case"list_item_start":var e="";while(s().type!=="list_item_end")e+=i.type==="text"?u():o();return"<li>"+e+"</li>\n";case"loose_item_start":var e="";while(s().type!=="list_item_end")e+=o();return"<li>"+e+"</li>\n";case"html":return v.sanitize?t.lexer(i.text):!i.pre&&!v.pedantic?t.lexer(i.text):i.text;case"paragraph":return"<p>"+t.lexer(i.text)+"</p>\n";case"text":return"<p>"+u()+"</p>\n"}},u=function(){var e=i.text,n;while((n=r[r.length-1])&&n.type==="text")e+="\n"+s().text;return t.lexer(e)},a=function(e){r=e.reverse();var t="";while(s())t+=o();return r=null,i=null,t},f=function(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},l=function(e){var t="",n=e.length,r=0,i;for(;r<n;r++)i=e.charCodeAt(r),Math.random()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t};p.exec=p;var d=function(t,n){return g(n),a(e.lexer(t))},v,m,g=function(n){n||(n=m);if(v===n)return;v=n,v.gfm?(e.fences=e.gfm.fences,e.paragraph=e.gfm.paragraph,t.text=t.gfm.text,t.url=t.gfm.url):(e.fences=e.normal.fences,e.paragraph=e.normal.paragraph,t.text=t.normal.text,t.url=t.normal.url),v.pedantic?(t.em=t.pedantic.em,t.strong=t.pedantic.strong):(t.em=t.normal.em,t.strong=t.normal.strong)};d.options=d.setOptions=function(e){return m=e,g(e),d},d.options({gfm:!0,pedantic:!1,sanitize:!1,highlight:null}),d.parser=function(e,t){return g(t),a(e)},d.lexer=function(t,n){return g(n),e.lexer(t)},d.parse=d,typeof module!="undefined"?module.exports=d:this.marked=d}.call(function(){return this||(typeof window!="undefined"?window:global)}()),define("marked",function(){}),define("views/tickets/TicketView",["jquery","underscore","mustache","BaseView","views/tickets/TicketMetaView","text!templates/tickets/Ticket.html","text!templates/tickets/AssignedUser.html","text!templates/tickets/EditTicket.html","text!templates/tickets/ClosedNotification.html","text!templates/tickets/AssignedTag.html","moment","marked"],function(e,t,n,r,i,s,o,u,a,f){var l=r.extend({className:"ticket",attributes:function(){return{"data-id":this.model.id}},events:{"click a[data-action]":"ticketAction","click [data-action='save']":"saveTicket","click [data-action='cancel']":"renderDescription","click .md a":"openLink"},initialize:function(){this.renderAll=this.options.renderAll||!1,this.renderAll||(this.bindTo(ticketer.collections.lists,"reset",this.renderTags,this),this.bindTo(this.model,"tag:add tag:remove",this.renderTags,this)),this.bindTo(this.model,"edit",this.renderEditForm,this),this.bindTo(this.model,"change:description",this.renderDescription,this),this.bindTo(this.model,"change:status",this.renderStatusNotification,this),this.bindTo(this.model,"change:assigned_to",this.renderStatusMarker,this),this.bindTo(this.model,"change:notification",this.renderStatusMarker,this)},render:function(){var t=this,n=this.packageModel();return e(this.el).html(Mustache.to_html(s,n)),this.renderAll&&this.model.isOpen()&&this.renderMeta(),this.renderAll||this.renderTags(),this},renderMeta:function(){var e;e=this.createView(i,{model:this.model}),this.$el.append(e.render().el)},renderTags:function(){var t,n,r,i=this;e(".tags",this.el).empty(),r=ticketer.collections.lists.filter(function(e){return e.hasTicket(i.model.id)});for(t=0,n=r.length;t<n;t++)e("ul.tags",this.el).append(this.renderTag(r[t]))},renderTag:function(e){var t=e.toJSON();return t.color=ticketer.colors[t.color].name,Mustache.to_html(f,t)},packageModel:function(){var e,t={};return t.title=this.model.get("title"),t.user=this.model.get("user"),t.datetime=this.model.get("closed_at")||this.model.get("opened_at"),e=moment(new Date(t.datetime)),e.calendar().match(/(Today|Yesterday)/g)?t.cleanTime=RegExp.$1:t.cleanTime=e.format("MMM D"),t.hoverTime=this.model.responseTime()||t.cleanTime,t.isClosed=this.model.get("status")==="closed",t.showTags=!0,this.model.notification()?t.statusClass="notify":t.statusClass=this.model.get("assigned_to").length?"read":"unread",this.renderAll&&(t.description=marked(this.model.get("description")),t.fullDate=e.format("MMMM Do, YYYY h:mm A"),t.showTags=!1,t.isEditable=this.isEditable(t),t.isAdmin=ticketer.currentUser.role==="admin"?!0:!1),t},isEditable:function(e){return e.user.id===ticketer.currentUser.id?!0:ticketer.currentUser.role==="admin"?!0:!1},ticketAction:function(t){var n,r=e(t.currentTarget).data("action"),i="Delete this ticket? This cannot be undone",s="Close this ticket? This cannot be undone";switch(r){case"close":n=confirm(s),n&&this.model.close();break;case"edit":this.model.trigger("edit");break;case"delete":n=confirm(i),n&&this.model.destroy()}t.preventDefault()},renderEditForm:function(){var t=e(".ticket .ticket-form",this.$el).length;t||(e(".content",this.$el).html(Mustache.to_html(u,{description:this.model.get("description")})),e("textarea",this.$el).autoResize({minHeight:150,extraSpace:14}))},saveTicket:function(t){t.preventDefault();var n=this,r=e(".wrap > textarea",n.el).val();e("textarea",this.el).data("AutoResizer").destroy(),n.model.save({description:r},{error:n.triggerViewError})},renderDescription:function(){if(!this.renderAll)return!1;var t=marked(this.model.get("description"));e(".content",this.el).html(t)},renderStatusNotification:function(){if(!this.renderAll)return!1;e(".content",this.el).before(Mustache.to_html(a)),ticketer.currentUser.role==="admin"&&e('.edit-options li[data-role="close-ticket"]').remove()},renderStatusMarker:function(){var e=this.$el.find(".header");this.model.notification()?e.removeClass("unread read").addClass("notify"):this.model.get("assigned_to").length===0?e.removeClass("read notify").addClass("unread"):e.removeClass("unread notify").addClass("read")},openLink:function(e){e.preventDefault(),e.stopPropagation(),window.open(e.currentTarget.href)}});return l}),define("views/tickets/TicketListView",["jquery","underscore","backbone","BaseView","views/tickets/TicketView"],function(e,t,n,r,i){var s=r.extend({className:"ticket-list",events:{"click .ticket":"showDetails"},initialize:function(){function e(e){var t=this;typeof e=="function"?this.filter=function(n){return t._filter(n)&&e(n)}:this.filter=this._filter,this.render()}this.status=this.options.status?this.options.status:"open",this.filter=this.options.filter||function(){return!0},this._filter=this.filter,this.controller=this.options.controller||null,this.bindTo(this.collection,"add remove reset",this.render,this),this.bindTo(this.collection,"filter",e,this)},dispose:function(){return this.status==="closed"&&(this.collection=this.collection.destroy(),delete this.collection),r.prototype.dispose.call(this)},render:function(){var e,t=this.collection.filter(this.filter),n=t.length;if(n){this.$el.empty();for(e=0;e<n;e+=1)this.$el.append(this.renderTicket(t[e]))}else this.$el.html('<div class="view-filler"><p>No tickets to list</p></div>');return this},renderTicket:function(e){var t=this.createView(i,{model:e});return t.render().el},showDetails:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.$el.find(".active").removeClass("active"),this.$el.find('.ticket[data-id="'+n+'"]').addClass("active"),this.controller&&this.controller.showTicket(r)}});return s}),define("text!templates/comments/Comment.html",[],function(){return'<!-- Comment Avatar -->\n<div class="avatar">\n  <img src="{{user.avatar}}" alt="{{user.name}}">\n</div>\n\n<!-- Comment Body -->\n<div class="body">\n  <div class="commentHeader">\n    <h5>{{user.name}}</h5>\n    <time datetime="{{created_at}}">{{cleanTime}}</time>\n  </div>\n\n  <div class="md">\n    {{{comment}}}\n  </div>\n</div>\n\n{{#isDeletable}}\n<!-- Comment options -->\n<ul class="edit-actions">\n  {{#isEditable}}\n  <li><a href="#" data-action="edit"><i class="icon-pencil"></i></a></li>\n  {{/isEditable}}\n\n  <li><a href="#" data-action="delete"><i class="icon-trash"></i></a></li>\n</ul>\n{{/isDeletable}}'}),define("text!templates/comments/EditComment.html",[],function(){return'<div class="comment-form">\n  <form action="#">\n    <div class="wrap">\n      <textarea class="placeholder" name="ticket_comment">{{comment}}</textarea>\n    </div>\n    <div class="actions">\n      <ul class="right">\n        <li><button data-action="save">Save</button></li>\n        <li><button data-action="cancel" class="cancel">Cancel</button></li>\n      </ul>\n    </div>\n  </form>\n</div>'}),define("views/comments/CommentView",["jquery","underscore","backbone","BaseView","mustache","text!templates/comments/Comment.html","text!templates/comments/EditComment.html","moment","marked"],function(e,t,n,r,i,s,o){var u=r.extend({tagName:"li",className:"comment",attributes:function(){return{"data-id":this.model.id}},events:{"click [data-action='delete']":"removeComment","click [data-action='edit']":"editComment","click [data-action='save']":"saveComment","click [data-action='cancel']":"renderEdit","click .md a":"openLink"},initialize:function(){this.bindTo(this.model,"change",this.render,this)},dispose:function(){var e=this.$el.find("textarea");return e.length>0&&(e=e.data("AutoResizer"),e&&e.destroy()),r.prototype.dispose.call(this)},render:function(){var t;t=this.model.toJSON();var n=moment(new Date(t.created_at));return t.cleanTime=n.fromNow(),t.isDeletable=this.isDeletable(t),t.isEditable=this.isEditable(t),t.comment=marked(t.comment),e(this.el).html(Mustache.to_html(s,t)),this},renderEdit:function(e){var t=this,n=this.$el.find("textarea").data("AutoResizer");n&&n.destroy(),this.$el.fadeOut(200,function(){t.render(),t.$el.fadeIn(200)}),e instanceof jQuery.Event&&e.preventDefault()},isEditable:function(e){return e.user.id===ticketer.currentUser.id},isDeletable:function(e){return e.user.id===ticketer.currentUser.id||ticketer.currentUser.role==="admin"},editComment:function(e){this.$el.find(".body").html(Mustache.to_html(o,{comment:this.model.get("comment")})),this.$el.find("textarea").autoResize({minHeight:64,extraSpace:10}),this.$el.find(".edit-actions").hide(),e.preventDefault()},saveComment:function(e){var t=this,n=this.$el.find("textarea").val();t.model.save({comment:n},{silent:!0,success:function(){t.renderEdit()}}),e.preventDefault()},removeComment:function(e){var t,n=this;t=confirm("Are you sure you want to delete this comment? It cannot be undone"),t===!0&&(this.model.destroy(),this.$el.fadeOut(200,function(){n.dispose()})),e.preventDefault()},openLink:function(e){e.preventDefault(),e.stopPropagation(),window.open(e.currentTarget.href)}});return u}),define("text!templates/comments/CommentForm.html",[],function(){return'<div class="body full">\n  <div class="wrap">\n    <textarea class="placeholder" name="ticket_comment" placeholder="Enter your comment..."></textarea>\n  </div>\n  <div class="actions">\n    <ul class="right">\n      <li><button data-action="create">Post</button></li>\n    </ul>\n  </div>\n</div>'}),define("views/comments/CommentFormView",["jquery","underscore","backbone","BaseView","mustache","text!templates/comments/CommentForm.html"],function(e,t,n,r,i,s){var o=r.extend({className:"comment-form comment",events:{"click [data-action='create']":"create","focus textarea":"initResize"},render:function(){return e(this.el).html(Mustache.to_html(s,ticketer.currentUser)),this},initResize:function(){e("textarea",this.el).autoResize({minHeight:64,extraSpace:10})},dispose:function(){var e=this.$el.find("textarea").data("AutoResizer");return e&&e.destroy(),r.prototype.dispose.call(this)},create:function(){var e=this.$el.find("textarea");this.collection.create({comment:e.val()},{wait:!0}),e.val("").blur(),e.css({height:"64px"})}});return o}),define("text!templates/comments/CommentList.html",[],function(){return'<h3 class="title">Comments</h3>\n\n<div class="form-wrapper" role="comment-form"></div>\n<ul class="comments-list" role="comment-list"></ul>'}),define("views/comments/CommentListView",["jquery","underscore","backbone","BaseView","views/helpers/SpinnerView","views/comments/CommentView","views/comments/CommentFormView","text!templates/comments/CommentList.html"],function(e,t,n,r,i,s,o,u){var a=r.extend({className:"comments-wrapper",initialize:function(){this.bindTo(this.collection,"add",this.addComment,this),this.bindTo(this.collection,"remove",this.removeComment,this)},render:function(){var e=this,t=new i;return this.$el.html(u),this.renderCommentForm(),this.$el.append(t.render().el),this.collection.fetch(function(){e.$el.children(".comments-list").hide(),e.collection.each(e.addComment,e),t.$el.fadeOut(400,function(){t.dispose(),e.$el.children(".comments-list").fadeIn(400)})}),this},dispose:function(){return this.collection=this.collection.destroy(),delete this.collection,r.prototype.dispose.call(this)},renderCommentForm:function(){var t=this.createView(o,{collection:this.collection});e("[role=comment-form]",this.$el).html(t.render().el)},addComment:function(t){var n=this.createView(s,{model:t}),r=n.render().el;e(r).hide(),e("[role=comment-list]",this.$el).append(r),e(r).fadeIn(200)},removeComment:function(t){var n=t.get("id");e("[data-id="+n+"]",this.el).remove()}});return a}),define("views/tickets/TicketDetailsView",["jquery","underscore","backbone","BaseView","collections/Comments","views/tickets/TicketView","views/comments/CommentListView","views/comments/CommentFormView"],function(e,t,n,r,i,s,o,u){var a=r.extend({className:"ticket-details",initialize:function(){this.bindTo(this.model,"remove",this.dispose,this)},render:function(){return this.renderTicket(),this.renderComments(),this},dispose:function(){return this.model.notification()&&this.model.removeNotification(),r.prototype.dispose.call(this)},renderTicket:function(){var t=this.createView(s,{model:this.model,admin:!0,renderAll:!0});e(this.el).html(t.render().el)},renderComments:function(){var t=new i(null,{ticketId:this.model.id}),n=this.createView(o,{collection:t});e(this.el).append(n.render().el)}});return a}),define("support/PanelController",["jquery","collections/Tickets","views/helpers/FillerView","views/helpers/SpinnerView","views/toolbars/MainToolbarView","views/tickets/TicketListView","views/tickets/TicketDetailsView"],function(e,t,n,r,i,s,o){var u=function(){var n=this;this._panels={},this._setHeight(),this._setWidths(this._panelPositions()),this._setPanel("one",i),e("#main > div").css("display","block"),e(window).resize(this._setHeight),e("#panel-divider").on("mousedown",function(){e("body").addClass("unselectable"),e(window).on("mousemove",n._resizeWidths.bind(n)),e(window).one("mouseup",function(){e(window).off("mousemove"),e("body").removeClass("unselectable"),window.getSelection().empty()})})};return u.prototype.showOpenTickets=function(){this._callViewFunction("one","selectTab","tickets/open"),this._setPanel("two",s,{collection:ticketer.collections.openTickets,controller:this}),this._setPanel("three",n)},u.prototype.showMyTickets=function(){this._callViewFunction("one","selectTab","tickets/mine"),this._setPanel("two",s,{collection:ticketer.collections.openTickets,controller:this,filter:function(e){return e.participating()}}),this._setPanel("three",n)},u.prototype.showClosedTickets=function(){var e=this,i=new t(null,{comparator:function(e){var t=new Date(e.get("closed_at")),n=t.getTime();return-n}});this._callViewFunction("one","selectTab","tickets/closed"),this._setPanel("two",r),i.fetch({data:{status:"closed"},success:function(){e._setPanel("two",s,{collection:i,status:"closed",controller:e}),e._setPanel("three",n)}})},u.prototype.showTicket=function(e){var t=this;this._setPanel("three",o,{model:e}),this._callViewFunction("three","bindTo",this._panels.three.model,"remove",function(){t._setPanel("three",n)})},u.prototype._setPanel=function(t,n,r){r=r||{},this._panels.hasOwnProperty(t)&&typeof this._panels[t].dispose=="function"&&(this._panels[t].dispose(),delete this._panels[t]),this._panels[t]=new n(r),e("#panel-"+t).html(this._panels[t].render().el)},u.prototype._callViewFunction=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();if(typeof t!="string"||typeof n!="string"){console.error("Invalid call to _callViewFunction().");return}this._panels[t]&&typeof this._panels[t][n]!="undefined"?this._panels[t][n].apply(this._panels[t],e):console.error("Attempted to call nonexistent function "+n+" on panel "+t)},u.prototype._setHeight=function(){var t=e(window).height(),n=e("header").height()+1;e("#main").css("height",t-n)},u.prototype._resizeWidths=function(t){var n=e("#panel-one"),r=e("#panel-two"),i=e("#panel-three"),s=e("#panel-divider"),o={two:{},three:{},divider:{}};t.pageX>440&&t.pageX<1200&&(o.divider.left=t.pageX,o.two.width=t.pageX-n.width(),o.three.left=t.pageX,this._setWidths(o),this._panelPositions(o))},u.prototype._setWidths=function(t){if(!t)return;Object.keys(t).forEach(function(n){e("#panel-"+n).css(t[n])})},u.prototype._panelPositions=function(e){var t=window.localStorage;return typeof e!="undefined"?(t.setItem("panel-positions",JSON.stringify(e)),e):JSON.parse(t.getItem("panel-positions"))},u}),define("models/User",["underscore","backbone"],function(e,t){return t.Model.extend({})}),define("collections/Users",["underscore","backbone","models/User"],function(e,t,n){var r=t.Collection.extend({model:n,url:"/api/users",initialize:function(){this.comparator=function(e){return e.get("name")}}});return r}),define("models/Project",["underscore","backbone"],function(e,t){var n;return n=t.Model.extend({initialize:function(){this.on("error",function(e,t){ticketer.EventEmitter.trigger("error",t)})},hasTicket:function(e){return!!~this.get("tickets").indexOf(e)},addTicket:function(t,n){var r=this.get("tickets");return e.isArray(t)?e(t).each(function(e){~r.indexOf(e)||r.push(e)}):~r.indexOf(t)||r.push(t),this.save(null,{error:n}),this},removeTicket:function(t,n){function i(e){var t=r.indexOf(e);t!==-1&&r.splice(t,1)}var r=this.get("tickets");return e.isArray(t)?e(t).each(function(e){i(e)}):i(t),this.save(null,{error:n}),this},validate:function(e){if(typeof e.name!="undefined"&&!e.name.replace(/\s/g,"").length)return"You must enter a project name."}}),n}),define("collections/Projects",["underscore","backbone","models/Project"],function(e,t,n){var r;return r=t.Collection.extend({model:n,url:"/api/projects",initialize:function(){ticketer.EventEmitter.on("project:new",this.addProject),ticketer.EventEmitter.on("project:update",this.updateProject),ticketer.EventEmitter.on("project:remove",this.removeProject)},getProjectTickets:function(e){var t=this.get(e.id);return t.get("tickets")},addProject:function(e){var t=this.get(e.id);t||this.add(e)},updateProject:function(e){var t=this.get(e.id);t?(e.description&&t.set({description:e.description}),e.name&&t.set({title:e.name}),e.tickets&&t.set({tickets:e.tickets})):this.add(e)},removeProject:function(e){var t=this.get(e.id);t&&t.destroy()}}),r}),define("models/List",["underscore","backbone"],function(e,t){var n;return n=t.Model.extend({initialize:function(){this.on("error",function(e,t){ticketer.EventEmitter.trigger("error",t)})},hasTicket:function(e){return!!~this.get("tickets").indexOf(e)},addTicket:function(t,n){var r=this.get("tickets");return e.isArray(t)?e(t).each(function(e){~r.indexOf(e)||r.push(e)}):~r.indexOf(t)||r.push(t),this.save(null,{error:n}),this},removeTicket:function(t,n){function i(e){var t=r.indexOf(e);t!==-1&&r.splice(t,1)}var r=this.get("tickets");return e.isArray(t)?e(t).each(function(e){i(e)}):i(t),this.save(null,{error:n}),this},validate:function(e){if(typeof e.name!="undefined"&&!e.name.replace(/\s/g,"").length)return"You must enter a task name."}}),n}),define("collections/Lists",["underscore","backbone","models/List"],function(e,t,n){var r;return r=t.Collection.extend({model:n,url:"/api/lists",getListTickets:function(e){var t=this.get(e.id);return t.get("tickets")}}),r}),define("text!templates/widgets/TagForm.html",[],function(){return'<div class="color-picker">\n  <ul>\n    {{#colors}}\n      <li class="color-{{name}}" data-value="{{value}}"></li>\n    {{/colors}}\n  </ul>\n</div>\n\n<form action="#">\n  <input type="text" placeholder="Create a New Tag" disabled>\n</form>'}),define("views/widgets/TagFormView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/TagForm.html"],function(e,t,n,r,i,s){var o=r.extend({className:"tags-form",events:{"click .color-picker li":"setColor","keypress input[type=text]":"createOnEnter"},initialize:function(){var t=this;this.$el.on("click",function(e){e.stopPropagation()}),e("html").on("click.tag-widget.data-api",function(){t.dispose()})},dispose:function(){return e("html").off("click.tag-widget.data-api"),r.prototype.dispose.call(this)},render:function(){var e={colors:ticketer.colors};return this.$el.html(Mustache.to_html(s,e)),this},setColor:function(t){var n=e(t.currentTarget);value=n.data("value"),this.color=value,this.$el.find("li.active").removeClass("active"),n.addClass("active"),e("input[type=text]").attr("disabled",!1)},createOnEnter:function(t){var n=e("input[type=text]",this.$el);if(t.keyCode!=13)return;if(t.keyCode===13&&!t.ctrlKey){t.preventDefault();var r=this;ticketer.collections.lists.create({color:this.color,name:n.val()},{wait:!0}),this.dispose()}}});return o}),define("text!templates/tickets/MarkdownGuide.html",[],function(){return'\n<h1>Markdown Guide</h1>\n<a href="#" class="close">&times;</a>\n\n<div class="column">\n  <h2>Text formatting</h2>\n  <h3>Headers</h3>\n  <pre>\n# This is a header\n## This is a smaller header\n### An even smaller header</pre>\n  <h3>Styles</h3>\n  <pre>\n*This text will be italic*\n_This will also be italic_\n**This text will be bold**\n__This will also be bold__\n\n*You **can** combine them*</pre>\n</div>\n\n<div class="column">\n  <h2>Lists</h2>\n  <h3>Ordered</h3>\n  <pre>\n1. Item 1\n2. Item 2\n3. Item 3\n * Item 3a\n * Item 3b</pre>\n  <h3>Unordered</h3>\n  <pre>\n* Item 1\n* Item 2\n* Nested Item</pre>\n</div>\n\n<div class="column">\n  <h2>Other</h2>\n  <h3>Links</h3>\n  <pre>\n[TxState](http://txstate.edu)</pre>\n  <h3>Images</h3>\n  <pre>\n![Alt Text](URL)</pre>\n  <h3>Blockquotes</h3>\n  <pre>\n> Quote</pre>\n</div>'}),define("views/dialogs/MarkdownGuide",["jquery","underscore","backbone","BaseView","mustache","text!templates/tickets/MarkdownGuide.html"],function(e,t,n,r,i,s){var o=r.extend({className:"dialog",events:{"click .close":"destroy"},initialize:function(){this.render(),e("body").on("keyup",e.proxy(this.escape,this)),e("body").on("click",e.proxy(this.clickOutside,this))},render:function(){if(e("body").find(".dialog").length)return;this.$el.html(Mustache.to_html(s)),e("body").append(this.el),this.$el.animate({top:"18%"})},escape:function(e){var t=this;e.preventDefault(),e.which==27&&t.destroy(e)},clickOutside:function(t){if(e(t.target).parents(".dialog").length>0)return;this.destroy(t)},destroy:function(t){var n=this;t.preventDefault(),e("body").off("keyup",this.escape),e("body").off("click",this.clickOutside),this.$el.fadeOut(200,function(){n.dispose()})}});return o}),define("text!templates/tickets/TicketForm.html",[],function(){return'<div class="header">\n  <h1 class="title">Create a Ticket</h1>\n  <span data-action="cancel">&times;</span>\n</div>\n\n<!-- Ticket Form -->\n<div class="wrapper">\n  <div class="wrap">\n    <input type="text" name="title" placeholder="Ticket Name...">\n  </div>\n\n  <textarea class="wrap scrollable" role="description" placeholder="Enter a description of your ticket..."></textarea>\n</div>\n\n<div class="footer">\n  <ul class="left">\n    <li><a data-role="display-guide" class="guide" href="#">Markdown Guide</a></li>\n  </ul>\n\n  <ul class="right">\n    <li><button data-action="create">Create Ticket</button></li>\n    <li><button data-action= "cancel" class="cancel">Cancel</button></li>\n  </ul>\n</div>'}),function(e){function r(t){return this.filter(r.resizableFilterSelector).each(function(){new i(e(this),t)}),this}function i(t,n){t.data("AutoResizer")&&t.data("AutoResizer").destroy(),n=this.config=e.extend({},r.defaults,n),this.el=t,this.nodeName=t[0].nodeName.toLowerCase(),this.originalHeight=t.height(),this.previousScrollTop=null,this.value=t.val(),n.maxWidth==="original"&&(n.maxWidth=t.width()),n.minWidth==="original"&&(n.minWidth=t.width()),n.maxHeight==="original"&&(n.maxHeight=t.height()),n.minHeight==="original"&&(n.minHeight=t.height()),this.nodeName==="textarea"&&t.css({resize:"none",overflowY:"hidden"}),t.data("AutoResizer",this),n.animate.complete=function(e){return function(){return n.onAfterResize.call(t),e.apply(this,arguments)}}(n.animate.complete),this.bind()}var t="ar"+ +(new Date),n=r.defaults={onResize:function(){},onBeforeResize:function(){return 123},onAfterResize:function(){return 555},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500};r.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","paddingTop","paddingLeft","paddingBottom","paddingRight","width"],r.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden"},r.resizableFilterSelector=["textarea:not(textarea."+t+")","input:not(input[type])","input[type=text]","input[type=password]","input[type=email]","input[type=url]"].join(","),r.AutoResizer=i,e.fn.autoResize=r,i.prototype={bind:function(){var t=e.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",t).bind("change.autoResize",t).bind("paste.autoResize",function(){setTimeout(function(){t()},0)}),this.el.is(":hidden")||this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var n=this.el,i=this.nodeName==="textarea"?n.clone():e("<span/>");this.clone=i,e.each(r.cloneCSSProperties,function(e,t){i[0].style[t]=n.css(t)}),i.removeAttr("name").removeAttr("id").addClass(t).attr("tabIndex",-1).css(r.cloneCSSValues),this.nodeName==="textarea"?i.height("auto"):i.width("auto").css({whiteSpace:"nowrap"})},check:function(e,t){this.clone||(this.createClone(),this.injectClone());var n=this.config,r=this.clone,i=this.el,s=i.val();if(s===this.prevValue)return!0;this.prevValue=s;if(this.nodeName==="input"){r.text(s);var o=r.width(),u=o+n.extraSpace>=n.minWidth?o+n.extraSpace:n.minWidth,a=i.width();u=Math.min(u,n.maxWidth);if(u<a&&u>=n.minWidth||u>=n.minWidth&&u<=n.maxWidth)n.onBeforeResize.call(i),n.onResize.call(i),i.scrollLeft(0),n.animate&&!t?i.stop(1,1).animate({width:u},n.animate):(i.width(u),n.onAfterResize.call(i));return}r.width(i.width()).height(0).val(s).scrollTop(1e4);var f=r[0].scrollTop;if(this.previousScrollTop===f)return;this.previousScrollTop=f,f+n.extraSpace>=n.maxHeight?(i.css("overflowY",""),f=n.maxHeight,t=!0):f<=n.minHeight?f=n.minHeight:(i.css("overflowY","hidden"),f+=n.extraSpace),n.onBeforeResize.call(i),n.onResize.call(i),n.animate&&!t?i.stop(1,1).animate({height:f},n.animate):(i.height(f),n.onAfterResize.call(i))},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clone&&this.clone.remove(),delete this.el,delete this.clone},injectClone:function(){(r.cloneContainer||(r.cloneContainer=e("<arclones/>").appendTo("body"))).append(this.clone)}}}(jQuery),define("autoresize",function(){}),define("views/tickets/TicketFormView",["jquery","underscore","backbone","BaseView","mustache","models/Ticket","views/dialogs/MarkdownGuide","text!templates/tickets/TicketForm.html","autoresize"],function(e,t,n,r,i,s,o,u){var a=r.extend({className:"ticket-form",attributes:{role:"popup"},events:{"click [data-action='create']":"createTicket","click [data-action='cancel']":"clearPopup","click [data-role='display-guide']":"displayHelp"},initialize:function(){this.$el.attr("role","popup"),this.bindTo(this.collection,"add",this.clearPopup,this),e("body").on("keyup",e.proxy(this.escape,this))},render:function(){var t;return t=ticketer.currentUser,t.shortname=t.name.split(" ")[0],e(this.el).html(Mustache.to_html(u,ticketer.currentUser)),e("body").append(this.el),this},escape:function(e){var t=this;e.preventDefault(),e.which==27&&t.clearPopup(e)},clearPopup:function(){e("body").off("keyup",this.escape),this.dispose()},createTicket:function(t){var n=this,r=e("[name=title]",this.el).val(),i=e("[role=description]",this.el).val(),o;o=new s({title:r,description:i}),o.save({},{wait:!0}),this.bindTo(o,"sync",function(e){n.collection.add(e)}),t.preventDefault()},displayHelp:function(e){e.preventDefault(),new o}});return a}),define("text!templates/headers/MainHeader.html",[],function(){return'<h1 class="logo"><a href="/">Tickets</a></h1>\n\n<ul data-role="action-container" class="actions">\n  <li><a title="Refresh" href="#" data-action="refresh"><i class="icon-refresh"></i></a></li>\n  <li><a title="New Ticket" href="#" data-action="new-ticket"><i class="icon-edit"></i></a></li>\n  <li class="spacer"><a title="New Tag" href="#" data-action="new-tag"><i class="icon-bookmark"></i><i class="icon-sort-down"></i></a></li>\n</ul>'}),define("text!templates/headers/UserOptions.html",[],function(){return'<ul class="user-actions">\n  <li class="dropdown">\n    <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n      <img src="{{user.avatar}}" alt="{{user.name}}" />\n      <span class="name">{{user.name}}</span>\n      <i class="icon-sort-down"></i>\n    </a>\n\n    <ul class="dropdown-menu">\n      <li><a href="/logout">Logout</a></li>\n    </ul>\n  </li>\n</ul>'}),!function(e){function r(){e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var n=t.attr("data-target"),r;return n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=e(n),r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||s.toggleClass("open"),n.focus(),!1},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this),t.preventDefault(),t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n),u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider):visible a",o);if(!r.length)return;a=r.index(r.filter(":focus")),t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<r.length-1&&a++,~a||(a=0),r.eq(a).focus()}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api touchstart.dropdown.data-api",r).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("touchstart.dropdown.data-api",".dropdown-menu",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery),define("dropdowns",function(){}),define("views/headers/MainHeaderView",["jquery","underscore","mustache","BaseView","views/widgets/TagFormView","views/tickets/TicketFormView","text!templates/headers/MainHeader.html","text!templates/headers/UserOptions.html","dropdowns"],function(e,t,n,r,i,s,o,u){var a=r.extend({className:"header",events:{"click a[data-action]":"preventDefault","click a[data-route]":"navigateTo","click a[data-action='new-ticket']":"createTicket","click a[data-action='refresh']":"refresh","click a[data-action='new-tag']":"showTagWidget"},initialize:function(){this.bindTo(ticketer.EventEmitter,"popup:TicketForm",this.createTicket,this)},render:function(){return this.$el.html(Mustache.to_html(o)),this.addUserOptions(),this},addUserOptions:function(){var t={};e(".user-actions",this.el).remove(),t.user=ticketer.currentUser,this.$el.append(Mustache.to_html(u,t))},preventDefault:function(e){e.preventDefault()},navigateTo:function(t){t.preventDefault();var n=e(t.currentTarget).data("route");ticketer.routers.ticketer.navigate(n,!0)},refresh:function(){ticketer.collections.openTickets.reset(),ticketer.collections.users.reset(),ticketer.collections.openTickets.fetch({data:{status:"open"}}),ticketer.collections.users.fetch()},showTagWidget:function(t){var n=e(t.currentTarget).parent(),r;t.preventDefault(),t.stopPropagation(),n.children(".tags-form").length||(r=this.createView(i),e(n).append(r.render().el))},createTicket:function(){var t=ticketer.collections.openTickets,n;if(e("[role=popup]").length)return!1;n=new s({collection:t}),n.render()}});return a}),define("routers/Ticketer",["backbone","views/headers/MainHeaderView","support/PanelController"],function(e,t,n){var r=e.Router.extend({routes:{"":"index","tickets/open":"openTickets","tickets/closed":"closedTickets","tickets/mine":"myTickets"},initialize:function(){var e=new t;$("header").append(e.render().el),this.controller=new n},index:function(){this.navigate("tickets/mine",!0)},openTickets:function(){this.controller.showOpenTickets()},closedTickets:function(){this.controller.showClosedTickets()},myTickets:function(){this.controller.showMyTickets()}});return r}),define("views/alerts/BaseAlertView",["jquery","underscore","backbone"],function(e,t,n){var r=n.View.extend({id:"alert",events:{"click .close":"close"},close:function(t){t.type==="click"&&t.preventDefault();var n=this;e(this.el).slideUp(200,"swing",function(){e(".alert",n).remove()}),e("body").off("mousedown DOMMouseScroll mousewheel touchstart touchmove",n.close)}});return r}),define("text!templates/alerts/Error.html",[],function(){return'<div class="alert error">\n  <a class="close" href="#">x</a>\n  <p>{{msg}}</p>\n</div>'}),define("views/alerts/ErrorView",["jquery","underscore","backbone","views/alerts/BaseAlertView","mustache","text!templates/alerts/Error.html"],function(e,t,n,r,i,s){var o=r.extend({initialize:function(){ticketer.EventEmitter.on("error",this.render,this)},render:function(t){e(this.el).html(Mustache.to_html(s,{msg:t})).hide(),e("body").prepend(this.el),e(this.el).slideDown(200,function(){function n(){e(t).slideUp(200,function(){e(".alert",t).remove()})}var t=this;setTimeout(function(){n()},4e3)})}});return o}),define("text!templates/alerts/Notification.html",[],function(){return'<button id="request_permission" href="#">Enable Desktop Notifications</button>\n<div class="notification-text">\n  <p>The Ticket System works best with desktop notifications turned on.</p>\n</div>'}),define("views/alerts/NotificationView",["jquery","underscore","backbone","mustache","text!templates/alerts/Notification.html"],function(e,t,n,r,i){var s=n.View.extend({id:"notification",className:"clearfix",events:{"click button":"requestPermissions"},initialize:function(){ticketer.EventEmitter.on("comment:new",this.commentNotification,this),ticketer.EventEmitter.on("ticket:update",this.closedNotification,this)},render:function(){e(this.el).html(Mustache.to_html(i,{})).hide(),e("body").prepend(this.el),e(this.el).slideDown(200)},requestPermissions:function(){e(this.el).hide();var t=this;webkitNotifications.requestPermission(t.requestCallback)},requestCallback:function(){var e=webkitNotifications.checkPermission();e===0?ticketer.notifications=!0:ticketer.notifications=!1},commentNotification:function(e){var t=ticketer.collections.openTickets.get(e.ticket);if(t&&ticketer.notifications&&e.participating){var n=e.user.name+' made a comment on "'+t.get("title")+'":';webkitNotifications.createNotification("",n,e.comment).show()}},closedNotification:function(e){if(!ticketer.notifications)return!1;if(e.status==="closed"){var n="Ticket Closed";if(e.user.id===ticketer.currentUser.id)webkitNotifications.createNotification("",n,e.title).show();else if(e.assigned_to.length>0){var r=t.include(e.assigned_to,ticketer.currentUser.id);r&&webkitNotifications.createNotification("",n,e.title).show()}}}});return s}),function(e){function t(){this.data={}}function n(){this.listeners=new t}function r(e){setTimeout(function(){throw e},0)}function i(e){this.type=e}function s(e,t){i.call(this,e),this.data=t.data,this.lastEventId=t.lastEventId}function g(e,t){var n=Number(e);return(n<1?1:n>18e6?18e6:n)||t}function y(e,t,n){try{typeof e[t]=="function"&&e[t](n)}catch(i){r(i)}}function b(t,r){function B(){L=d,N!==null&&(N.abort(),N=null),C!==0&&(clearTimeout(C),C=0),S.readyState=d}function j(e){var t=L===p||L===h?N.responseText||"":"",n=null;if(L===h){var r=f?t!==""?N.getResponseHeader("Content-Type"):"":N.contentType;if(r&&v.test(r)){L=p,T=!0,x=u,S.readyState=p,n=new i("open"),S.dispatchEvent(n),y(S,"onopen",n);if(L===d)return}}if(L===p){t.length>k&&(H=!0,T=!0);var o=0,a=t.indexOf("\r",k),l=t.indexOf("\n",k);while(a!==-1||l!==-1){a===-1||l!==-1&&l<a?(o=l,l=t.indexOf("\n",o+1)):(o=a,a=t.indexOf("\r",o+1));var m=t.slice(k,o),B=D;D=t.slice(o,o+1)==="\r",k=o+1;if(!B||m.length!==0||D){_.push(m);var j=_.join("");_.length=0;if(j!==""){var I="",q=j.indexOf(":",0);q!==-1&&(I=j.slice(q+(j.slice(q+1,q+2)===" "?2:1)),j=j.slice(0,q)),j==="data"?A.push(I):j==="id"?O=I:j==="event"?M=I:j==="retry"?(u=g(I,u),x=u,b<u&&(b=u)):j==="retryLimit"?b=g(I,b):j==="heartbeatTimeout"&&(w=g(I,w),C!==0&&(clearTimeout(C),C=setTimeout(R,w)))}else{if(A.length!==0){E=O;var U=M||"message";n=new s(U,{data:A.join("\n"),lastEventId:O}),S.dispatchEvent(n),U==="message"&&y(S,"onmessage",n);if(L===d)return}A.length=0,M=""}}}k!==t.length&&(_.push(t.slice(k)),k=t.length)}H&&P===0&&(H=!1,P=setTimeout(F,80)),L!==p&&L!==h||!(e||k>1048576||C===0&&!T)?C===0&&(T=!1,C=setTimeout(R,w)):(L=c,N.abort(),C!==0&&(clearTimeout(C),C=0),x>b&&(x=b),C=setTimeout(R,x),x=x*2+1,S.readyState=h,n=new i("error"),S.dispatchEvent(n),y(S,"onerror",n))}function F(){P=0,j(!1)}function I(){j(!1)}function q(){j(!0)}function R(){C=0;if(L!==c){j(!1);return}if(navigator.onLine===!1){C=setTimeout(R,500);return}if(m&&e.document&&(e.document.readyState==="loading"||e.document.readyState==="interactive")){C=setTimeout(R,100);return}N.onload=N.onerror=q,N.mozAnon===undefined?N.onprogress=I:N.onreadystatechange=I,T=!1,C=setTimeout(R,w),k=0,L=h,A.length=0,M="",O=E,_.length=0,D=!1,N.open("GET",t+((t.indexOf("?",0)===-1?"?":"&")+"lastEventId="+encodeURIComponent(E)+"&r="+String(Math.random()+1).slice(2)),!0),N.withCredentials=o,N.responseType="text",f&&N.setRequestHeader("Accept","text/event-stream"),N.send(null)}t=String(t);var o=Boolean(a&&r&&r.withCredentials),u=g(r?r.retry:NaN,1e3),b=g(r?r.retryLimit:NaN,3e5),w=g(r?r.heartbeatTimeout:NaN,45e3),E=r&&r.lastEventId&&String(r.lastEventId)||"",S=this,x=u,T=!1,N=new l,C=0,k=0,L=c,A=[],O="",M="",_=[],D=!1,P=0,H=!1;r=null,n.call(this),this.close=B,this.url=t,this.readyState=h,this.withCredentials=o,R()}function w(){this.CONNECTING=h,this.OPEN=p,this.CLOSED=d}t.prototype={get:function(e){return this.data[e+"~"]},set:function(e,t){this.data[e+"~"]=t},"delete":function(e){delete this.data[e+"~"]}},n.prototype={dispatchEvent:function(e){var t=String(e.type),n=this.listeners,i=n.get(t);if(!i)return;var s=i.length,o=-1;while(++o<s){var u=i[o];try{u.call(this,e)}catch(a){r(a)}}},addEventListener:function(e,t){e=String(e);var n=this.listeners,r=n.get(e);r||n.set(e,r=[]);var i=r.length;while(--i>=0)if(r[i]===t)return;r.push(t)},removeEventListener:function(e,t){e=String(e);var n=this.listeners,r=n.get(e);if(!r)return;var i=r.length,s=[],o=-1;while(++o<i)r[o]!==t&&s.push(r[o]);s.length===0?n["delete"](e):n.set(e,s)}},s.prototype=i.prototype;var o=e.XMLHttpRequest,u=e.XDomainRequest,a=Boolean(o&&(new o).withCredentials!==undefined),f=a,l=a?o:u,c=-1,h=0,p=1,d=2,v=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,m=/AppleWebKit\/5([0-2][0-9]|3[0-4])[^\d]/.test(navigator.userAgent);w.prototype=n.prototype,b.prototype=new w,w.call(b),l&&(e.EventSource=b),typeof e.define=="function"&&e.define.amd&&e.define("EventSource",[],function(){return e.EventSource})}(this),define("EventSource",function(){}),define("ServerEvents",["underscore","backbone"],function(e,t){var n=function(){ticketer.SSE.addEventListener("ticket:new",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("ticket:new",t);var n=ticketer.collections.openTickets.get(t.id);if(n)return!1;ticketer.collections.openTickets.add(t)},!1),ticketer.SSE.addEventListener("ticket:update",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("ticket:update",t)}),ticketer.SSE.addEventListener("ticket:remove",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("ticket:remove",t)}),ticketer.SSE.addEventListener("comment:new",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("comment:new",t)}),ticketer.SSE.addEventListener("comment:update",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("comment:update",t)}),ticketer.SSE.addEventListener("comment:remove",function(e){var t=JSON.parse(e.data);ticketer.EventEmitter.trigger("comment:remove",t)})};return n}),function(){function h(e,t,n){if(e.addEventListener){e.addEventListener(t,n,!1);return}e.attachEvent("on"+t,n)}function p(n){return n.type=="keypress"?String.fromCharCode(n.which):e[n.which]?e[n.which]:t[n.which]?t[n.which]:String.fromCharCode(n.which).toLowerCase()}function d(e,t){return e.sort().join(",")===t.sort().join(",")}function v(e,t){e=e||{};var n=!1,r;for(r in u){if(e[r]&&u[r]>t){n=!0;continue}u[r]=0}n||(l=!1)}function m(e,t,n,r,i){var o,a,f=[],l=n.type;if(!s[e])return[];l=="keyup"&&E(e)&&(t=[e]);for(o=0;o<s[e].length;++o){a=s[e][o];if(a.seq&&u[a.seq]!=a.level)continue;if(l!=a.action)continue;if(l=="keypress"&&!n.metaKey&&!n.ctrlKey||d(t,a.modifiers))r&&a.combo==i&&s[e].splice(o,1),f.push(a)}return f}function g(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function y(e,t,n){if(L.stopCallback(t,t.target||t.srcElement,n))return;e(t,n)===!1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function b(e,t){var n=m(e,g(t),t),r,i={},s=0,o=!1;for(r=0;r<n.length;++r){if(n[r].seq){o=!0,s=Math.max(s,n[r].level),i[n[r].seq]=1,y(n[r].callback,t,n[r].combo);continue}!o&&!l&&y(n[r].callback,t,n[r].combo)}t.type==l&&!E(e)&&v(i,s)}function w(e){typeof e.which!="number"&&(e.which=e.keyCode);var t=p(e);if(!t)return;if(e.type=="keyup"&&f==t){f=!1;return}b(t,e)}function E(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function S(){clearTimeout(a),a=setTimeout(v,1e3)}function x(){if(!i){i={};for(var t in e){if(t>95&&t<112)continue;e.hasOwnProperty(t)&&(i[e[t]]=t)}}return i}function T(e,t,n){return n||(n=x()[e]?"keydown":"keypress"),n=="keypress"&&t.length&&(n="keydown"),n}function N(e,t,n,r){u[e]=0,r||(r=T(t[0],[]));var i=function(t){l=r,++u[e],S()},s=function(t){y(n,t,e),r!=="keyup"&&(f=p(t)),setTimeout(v,10)},o;for(o=0;o<t.length;++o)C(t[o],o<t.length-1?i:s,r,e,o)}function C(e,t,i,u,a){o[e+":"+i]=t,e=e.replace(/\s+/g," ");var f=e.split(" "),l,c,h,p=[];if(f.length>1){N(e,f,t,i);return}h=e==="+"?["+"]:e.split("+");for(l=0;l<h.length;++l)c=h[l],r[c]&&(c=r[c]),i&&i!="keypress"&&n[c]&&(c=n[c],p.push("shift")),E(c)&&p.push(c);i=T(c,p,i),s[c]||(s[c]=[]),m(c,p,{type:i},!u,e),s[c][u?"unshift":"push"]({callback:t,modifiers:p,action:i,seq:u,level:a,combo:e})}function k(e,t,n){for(var r=0;r<e.length;++r)C(e[r],t,n)}var e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},r={option:"alt",command:"meta","return":"enter",escape:"esc"},i,s={},o={},u={},a,f=!1,l=!1;for(var c=1;c<20;++c)e[111+c]="f"+c;for(c=0;c<=9;++c)e[c+96]=c;h(document,"keypress",w),h(document,"keydown",w),h(document,"keyup",w);var L={bind:function(e,t,n){return e=e instanceof Array?e:[e],k(e,t,n),this},unbind:function(e,t){return L.bind(e,function(){},t)},trigger:function(e,t){return o[e+":"+t]&&o[e+":"+t](),this},reset:function(){return s={},o={},this},stopCallback:function(e,t,n){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.tagName=="INPUT"||t.tagName=="SELECT"||t.tagName=="TEXTAREA"||t.contentEditable&&t.contentEditable=="true"}};window.Mousetrap=L,typeof define=="function"&&define.amd&&define("Mousetrap",L)}(),define("Shortcuts",["jquery","underscore","backbone","Mousetrap","mustache","views/dialogs/MarkdownGuide"],function(e,t,n,r,i,s){function o(){function e(e){new s}function t(e){ticketer.EventEmitter.trigger("popup:TicketForm")}r.bind("m",e),r.bind("c",t)}return o}),define("AppCache",[],function(){var e=function(){setInterval(function(){applicationCache.update()},6e5),window.applicationCache&&applicationCache.addEventListener("updateready",function(){confirm("An update is available. Reload now?")&&window.location.reload()})};return e}),define("Sync",["jquery","underscore","backbone"],function(e,t,n){var r=function(){n.sync_model=n.sync,n.sync=function(e,r,i){var s=t.extend({beforeSend:function(e){var t=ticketer.currentUser.access_token;t&&e.setRequestHeader("X-Auth-Token",t),e.setRequestHeader("Accept","application/json")}},i);n.sync_model(e,r,s)}};return r}),define("app",["underscore","backbone","support/PanelController","collections/Tickets","collections/Comments","collections/Users","collections/Projects","collections/Lists","routers/Ticketer","views/alerts/ErrorView","views/alerts/NotificationView","EventSource","ServerEvents","Shortcuts","AppCache","Sync"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){$(function(){new d,window.ticketer=window.ticketer||{},ticketer.colors=[{value:0,name:"lightOrange"},{value:1,name:"blue"},{value:2,name:"red"},{value:3,name:"green"},{value:4,name:"teal"},{value:5,name:"pink"},{value:6,name:"brightGreen"},{value:7,name:"tan"}],ticketer.EventEmitter={},e.extend(ticketer.EventEmitter,t.Events),ticketer.collections={openTickets:new r,users:new s,lists:new u},ticketer.routers={ticketer:new a},ticketer.views={alerts:{error:new f,notifications:new l}},new v,ticketer.SSE=new c("/events",{withCredentials:!0}),new h,ticketer.collections.lists.fetch(),ticketer.collections.users.fetch(),ticketer.collections.openTickets.fetch({data:{status:"open"}});try{t.history.start()}catch(n){}new p;if(webkitNotifications){var i=webkitNotifications.checkPermission();i===0?ticketer.notifications=!0:i===2?ticketer.notifications=!1:ticketer.views.alerts.notifications.render()}})}),require.config({baseUrl:"js",paths:{backbone:"libs/backbone-0.9.10",underscore:"libs/lodash",text:"libs/require/text",mustache:"libs/mustache",marked:"libs/marked",moment:"libs/moment",dropdowns:"libs/plugins/bootstrap.dropdowns",autoresize:"libs/plugins/jquery.autoresize",spin:"libs/spin",EventSource:"libs/eventsource",Mousetrap:"libs/mousetrap",Shortcuts:"support/Shortcuts",Sync:"support/Sync",BaseView:"support/GarbageCollector",AppView:"support/AppView",ServerEvents:"support/ServerEvents",AppCache:"support/AppCache"}}),require(["jquery","underscore","backbone","BaseView"],function(e,t,n,r){require(["app"],function(){})}),define("main",function(){});