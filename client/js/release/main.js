((function(){function A(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&w.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return!1;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&A(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(w.has(a,h)){f++;if(!(g=w.has(b,h)&&A(a[h],b[h],c)))break}if(g){for(h in b)if(w.has(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new E(a)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=w),exports._=w):(typeof define=="function"&&define.amd&&define("underscore",[],function(){return w}),a._=w),w.VERSION="1.3.1";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(w.has(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=w.collect=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=w.toArray(a).reverse();return d&&!e&&(b=w.bind(b,d)),e?w.reduce(f,b,c,d):w.reduce(f,b)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},w.filter=w.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return a==null?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return a==null?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),e)};var y=w.some=w.any=function(a,b,d){b||(b=w.identity);var e=!1;return a==null?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};w.include=w.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(c=y(a,function(a){return a===b}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(w.isFunction(b)?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a))return Math.max.apply(Math,a);if(!b&&w.isEmpty(a))return-Infinity;var d={computed:-Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a))return Math.min.apply(Math,a);if(!b&&w.isEmpty(a))return Infinity;var d={computed:Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.shuffle=function(a){var b=[],c;return x(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},w.sortBy=function(a,b,c){return w.pluck(w.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={},d=w.isFunction(b)?b:function(a){return a[b]};return x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?a.toArray?a.toArray():w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):w.values(a):[]},w.size=function(a){return w.toArray(a).length},w.first=w.head=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},w.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a,b){return w.reduce(a,function(a,c){return w.isArray(c)?a.concat(b?c:w.flatten(c)):(a[a.length]=c,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b,c){var d=c?w.map(a,c):a,e=[];return w.reduce(d,function(c,d,f){if(0==f||(b===!0?w.last(c)!=d:!w.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a){var b=w.flatten(g.call(arguments,1));return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(c in a&&a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var z=function(){};w.bind=function(b,c){var d,e;if(b.bind===v&&v)return v.apply(b,g.call(arguments,1));if(!w.isFunction(b))throw new TypeError;return e=g.call(arguments,2),d=function(){if(this instanceof d){z.prototype=b.prototype;var a=new z,f=b.apply(a,e.concat(g.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return w.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))},w.throttle=function(a,b){var c,d,e,f,g,h=w.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},w.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},w.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments,0));return b.apply(this,c)}},w.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)w.has(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},w.clone=function(a){return w.isObject(a)?w.isArray(a)?a.slice():w.extend({},a):a},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){return A(a,b,[])},w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(w.has(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)=="[object Array]"},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return i.call(a)=="[object Arguments]"},w.isArguments(arguments)||(w.isArguments=function(a){return!!a&&!!w.has(a,"callee")}),w.isFunction=function(a){return i.call(a)=="[object Function]"},w.isString=function(a){return i.call(a)=="[object String]"},w.isNumber=function(a){return i.call(a)=="[object Number]"},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},w.isDate=function(a){return i.call(a)=="[object Date]"},w.isRegExp=function(a){return i.call(a)=="[object RegExp]"},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.has=function(a,b){return j.call(a,b)},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.mixin=function(a){x(w.functions(a),function(b){G(b,w[b]=a[b])})};var B=0;w.uniqueId=function(a){var b=B++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,D=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};w.template=function(a,b){var c=w.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape||C,function(a,b){return"',_.escape("+D(b)+"),'"}).replace(c.interpolate||C,function(a,b){return"',"+D(b)+",'"}).replace(c.evaluate||C,function(a,b){return"');"+D(b).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,w):function(a){return e.call(this,a,w)}},w.chain=function(a){return w(a).chain()};var E=function(a){this._wrapped=a};w.prototype=E.prototype;var F=function(a,b){return b?w(a).chain():a},G=function(a,b){E.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),F(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];E.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],F(c,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return F(b.apply(this._wrapped,arguments),this._chain)}}),E.prototype.chain=function(){return this._chain=!0,this},E.prototype.value=function(){return this._wrapped}})).call(this),function(a,b){typeof exports!="undefined"?b(a,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)}):a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender)}(this,function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice,g=Array.prototype.splice;b.VERSION="0.9.0",b.noConflict=function(){return a.Backbone=e,b},b.emulateHTTP=!1,b.emulateJSON=!1,b.Events={on:function(a,b,c){var d;a=a.split(/\s+/);var e=this._callbacks||(this._callbacks={});while(d=a.shift()){var f=e[d]||(e[d]={}),g=f.tail||(f.tail=f.next={});g.callback=b,g.context=c,f.tail=g.next={}}return this},off:function(a,b,c){var d,e,f;if(!a)delete this._callbacks;else if(e=this._callbacks){a=a.split(/\s+/);while(d=a.shift()){f=e[d],delete e[d];if(!b||!f)continue;while((f=f.next)&&f.next)if(f.callback!==b||!!c&&f.context!==c)this.on(d,f.callback,f.context);else continue}}return this},trigger:function(a){var b,c,d,e,g,h,i;if(!(d=this._callbacks))return this;h=d.all,(a=a.split(/\s+/)).push(null);while(b=a.shift()){h&&a.push({next:h.next,tail:h.tail,event:b});if(!(c=d[b]))continue;a.push({next:c.next,tail:c.tail})}i=f.call(arguments,1);while(c=a.pop()){e=c.tail,g=c.event?[c.event].concat(i):i;while((c=c.next)!==e)c.callback.apply(c.context||this,g)}return this}},b.Events.bind=b.Events.on,b.Events.unbind=b.Events.off,b.Model=function(a,b){var d;a||(a={}),b&&b.parse&&(a=this.parse(a));if(d=u(this,"defaults"))a=c.extend({},d,a);b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=c.uniqueId("c"),this._changed={};if(!this.set(a,{silent:!0}))throw new Error("Can't create an invalid model");this._changed={},this._previousAttributes=c.clone(this.attributes),this.initialize.apply(this,arguments)},c.extend(b.Model.prototype,b.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var d=this.attributes[a];return this._escapedAttributes[a]=c.escape(d==null?"":""+d)},has:function(a){return this.attributes[a]!=null},set:function(a,d,e){var f,g,h;c.isObject(a)||a==null?(f=a,e=d):(f={},f[a]=d),e||(e={});if(!f)return this;f instanceof b.Model&&(f=f.attributes);if(e.unset)for(g in f)f[g]=void 0;if(this.validate&&!this._performValidation(f,e))return!1;this.idAttribute in f&&(this.id=f[this.idAttribute]);var i=this.attributes,j=this._escapedAttributes,k=this._previousAttributes||{},l=this._changing;this._changing=!0;for(g in f){h=f[g],c.isEqual(i[g],h)||delete j[g],e.unset?delete i[g]:i[g]=h,delete this._changed[g];if(!c.isEqual(k[g],h)||c.has(i,g)!=c.has(k,g))this._changed[g]=h}return l||(!e.silent&&this.hasChanged()&&this.change(e),this._changing=!1),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(c.clone(this.attributes),a)},fetch:function(a){a=a?c.clone(a):{};var d=this,e=a.success;return a.success=function(b,c,f){if(!d.set(d.parse(b,f),a))return!1;e&&e(d,b)},a.error=b.wrapError(a.error,d,a),(this.sync||b.sync).call(this,"read",this,a)},save:function(a,d,e){var f;c.isObject(a)||a==null?(f=a,e=d):(f={},f[a]=d),e=e?c.clone(e):{};if(f&&!this[e.wait?"_performValidation":"set"](f,e))return!1;var g=this,h=e.success;e.success=function(a,b,d){var i=g.parse(a,d);e.wait&&(i=c.extend(f||{},i));if(!g.set(i,e))return!1;h?h(g,a):g.trigger("sync",g,a,e)},e.error=b.wrapError(e.error,g,e);var i=this.isNew()?"create":"update";return(this.sync||b.sync).call(this,i,this,e)},destroy:function(a){a=a?c.clone(a):{};var d=this,e=a.success,f=function(){d.trigger("destroy",d,d.collection,a)};if(this.isNew())return f();a.success=function(b){a.wait&&f(),e?e(d,b):d.trigger("sync",d,b,a)},a.error=b.wrapError(a.error,d,a);var g=(this.sync||b.sync).call(this,"delete",this,a);return a.wait||f(),g},url:function(){var a=u(this.collection,"url")||u(this,"urlRoot")||v();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){for(var b in this._changed)this.trigger("change:"+b,this,this._changed[b],a);this.trigger("change",this,a),this._previousAttributes=c.clone(this.attributes),this._changed={}},hasChanged:function(a){return a?c.has(this._changed,a):!c.isEmpty(this._changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this._changed):!1;var b,d=!1,e=this._previousAttributes;for(var f in a){if(c.isEqual(e[f],b=a[f]))continue;(d||(d={}))[f]=b}return d},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return c.clone(this._previousAttributes)},_performValidation:function(a,b){var d=c.extend({},this.attributes,a),e=this.validate(d,b);return e?(b.error?b.error(this,e,b):this.trigger("error",this,e,b),!1):!0}}),b.Collection=function(a,b){b||(b={}),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})},c.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){var d,e,f,h,i,j,k={},l={};b||(b={}),a=c.isArray(a)?a.slice():[a];for(d=0,f=a.length;d<f;d++){if(!(h=a[d]=this._prepareModel(a[d],b)))throw new Error("Can't add an invalid model to a collection");if(k[i=h.cid]||this._byCid[i]||(j=h.id)!=null&&(l[j]||this._byId[j]))throw new Error("Can't add the same model to a collection twice");k[i]=l[j]=h}for(d=0;d<f;d++)(h=a[d]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,h.id!=null&&(this._byId[h.id]=h);this.length+=f,e=b.at!=null?b.at:this.models.length,g.apply(this.models,[e,0].concat(a)),this.comparator&&this.sort({silent:!0});if(b.silent)return this;for(d=0,f=this.models.length;d<f;d++){if(!k[(h=this.models[d]).cid])continue;b.index=d,h.trigger("add",h,this,b)}return this},remove:function(a,b){var d,e,f,g;b||(b={}),a=c.isArray(a)?a.slice():[a];for(d=0,e=a.length;d<e;d++){g=this.getByCid(a[d])||this.get(a[d]);if(!g)continue;delete this._byId[g.id],delete this._byCid[g.cid],f=this.indexOf(g),this.models.splice(f,1),this.length--,b.silent||(b.index=f,g.trigger("remove",g,this,b)),this._removeReference(g)}return this},get:function(a){return a==null?null:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=c.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return c.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);return this._reset(),this.add(a,{silent:!0,parse:b.parse}),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a=a?c.clone(a):{},a.parse===undefined&&(a.parse=!0);var d=this,e=a.success;return a.success=function(b,c,f){d[a.add?"add":"reset"](d.parse(b,f),a),e&&e(d,b)},a.error=b.wrapError(a.error,d,a),(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var d=this;b=b?c.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||d.add(a,b);var e=b.success;return b.success=function(c,f,g){b.wait&&d.add(c,b),e?e(c,f):c.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return c(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,c){if(a instanceof b.Model)a.collection||(a.collection=this);else{var d=a;c.collection=this,a=new this.model(d,c),a.validate&&!a._performValidation(a.attributes,c)&&(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(a!="add"&&a!="remove"||c==this)a=="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments);else return}});var h=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];c.each(h,function(a){b.Collection.prototype[a]=function(){return c[a].apply(c,[this.models].concat(c.toArray(arguments)))}}),b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var i=/:\w+/g,j=/\*\w+/g,k=/[-[\]{}()+?.,\\^$|#\s]/g;c.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(a,d,e){return b.history||(b.history=new b.History),c.isRegExp(a)||(a=this._routeToRegExp(a)),e||(e=this[d]),b.history.route(a,c.bind(function(c){var f=this._extractParameters(a,c);e&&e.apply(this,f),this.trigger.apply(this,["route:"+d].concat(f)),b.history.trigger("route",this,d,f)},this)),this},navigate:function(a,c){b.history.navigate(a,c)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(k,"\\$&").replace(i,"([^/]+)").replace(j,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}}),b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl")};var l=/^[#\/]/,m=/msie [\w.]+/,n=!1;c.extend(b.History.prototype,b.Events,{interval:50,getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=window.location.hash;return a=decodeURIComponent(a.replace(l,"")),a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a},start:function(a){if(n)throw new Error("Backbone.history has already been started");this.options=c.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),e=document.documentMode,f=m.exec(navigator.userAgent.toLowerCase())&&(!e||e<=7);f&&(this.iframe=d('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?d(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?d(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b,n=!0;var g=window.location,h=g.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&g.hash&&(this.fragment=g.hash.replace(l,""),window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){d(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),n=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.iframe.location.hash));if(b==this.fragment||b==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),d=c.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return d},navigate:function(a,b){if(!n)return!1;if(!b||b===!0)b={trigger:b};var c=(a||"").replace(l,"");if(this.fragment==c||this.fragment==decodeURIComponent(c))return;this._hasPushState?(c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.iframe.location.hash)&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}}),b.View=function(a){this.cid=c.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var o=/^(\S+)\s*(.*)$/,p=["model","collection","el","id","attributes","className","tagName"];c.extend(b.View.prototype,b.Events,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var e=document.createElement(a);return b&&d(e).attr(b),c&&d(e).html(c),e},setElement:function(a,b){this.$el=d(a),this.el=this.$el[0],b!==!1&&this.delegateEvents()},delegateEvents:function(a){if(!a&&!(a=u(this,"events")))return;this.undelegateEvents();for(var b in a){var d=a[b];c.isFunction(d)||(d=this[a[b]]);if(!d)throw new Error('Event "'+a[b]+'" does not exist');var e=b.match(o),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,g===""?this.$el.bind(f,d):this.$el.delegate(g,f,d)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=c.extend({},this.options,a));for(var b=0,d=p.length;b<d;b++){var e=p[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(!this.el){var a=u(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}else this.setElement(this.el,!1)}});var q=function(a,b){var c=t(this,a,b);return c.extend=this.extend,c};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=q;var r={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,e,f){var g=r[a],h={type:g,dataType:"json"};return f.url||(h.url=u(e,"url")||v()),!f.data&&e&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(e.toJSON())),b.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),b.emulateHTTP&&(g==="PUT"||g==="DELETE")&&(b.emulateJSON&&(h.data._method=g),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)}),h.type!=="GET"&&!b.emulateJSON&&(h.processData=!1),d.ajax(c.extend(h,f))},b.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(d,e,c):b.trigger("error",d,e,c)}};var s=function(){},t=function(a,b,d){var e;return b&&b.hasOwnProperty("constructor")?e=b.constructor:e=function(){a.apply(this,arguments)},c.extend(e,a),s.prototype=a.prototype,e.prototype=new s,b&&c.extend(e.prototype,b),d&&c.extend(e,d),e.prototype.constructor=e,e.__super__=a.prototype,e},u=function(a,b){return!a||!a[b]?null:c.isFunction(a[b])?a[b]():a[b]},v=function(){throw new Error('A "url" property or function must be specified')};return b}),define("BaseView",["jquery","underscore","backbone"],function(a,b,c){var d=function(a){this.bindings=[],this.views=[],this.intervals=[],c.View.apply(this,[a])};return b.extend(d.prototype,c.View.prototype,{createView:function(a,b){var c=new a(b);return this.views.push(c),c},createInterval:function(a,b){var c=setInterval(b,a);return this.intervals.push(c),c},bindTo:function(a,b,c){return this.bindings.push({item:a,ev:b,callback:c}),a.on(b,c)},unbindAll:function(){var a,b;for(a=this.bindings.length;a>0;a-=1)b=this.bindings.pop(),b.item.off(b.ev,b.callback);this.off()},clearIntervals:function(){var a,b;for(a=this.intervals.length;a>0;a-=1)b=this.intervals.pop(),clearInterval(b)},trash:function(){return this.unbindAll(),this.clearIntervals(),this.remove(),null},dispose:function(){var a,b;for(a=this.views.length;a>0;a-=1)b=this.views.pop(),b.dispose();return this.trash()}}),d.extend=c.View.extend,d}),define("models/Comment",["underscore","backbone"],function(a,b){var c=b.Model.extend({initialize:function(){this.validate=this._validate,this.on("error",function(a,b){ticketer.EventEmitter.trigger("error",b)})},_validate:function(a){if(typeof a.comment!="undefined"&&!a.comment.replace(/ /g,"").length)return"Comment must have content to post."},updateComment:function(a,b){a&&this.set({comment:a}),this.save(null,{error:b})}});return c}),define("collections/Comments",["underscore","backbone","models/Comment"],function(a,b,c){var d=b.Collection.extend({model:c,initialize:function(){var b=this;this.comparator=function(a){var b=new Date(a.get("created_at"));return b.getTime()},this.on("add",function(a){b.trigger("comments:add",a)}),ticketer.EventEmitter.on("comment:update",function(c){var d=a.clone(c),e=b.get(d.id);e&&e.set(e.parse(d))}),ticketer.EventEmitter.on("comment:remove",function(a){var c=b.get(a);c&&b.remove(c)})},removeComments:function(a){var b=this;this.each(function(b){b.destroy({error:a})})}});return d}),define("models/Ticket",["underscore","backbone","collections/Comments"],function(a,b,c){var d=b.Model.extend({defaults:{status:"Open"},urlRoot:"/api/tickets",initialize:function(){var b=this,d=ticketer.currentUser;a.bindAll(this),this.validate=this._validate,ticketer.sockets.sock.on("connect",function(){b.set({socket:ticketer.sockets.id},{silent:!0})}),this.set({socket:ticketer.sockets.id},{silent:!0}),this.comments=new c,this.comments.url="/api/tickets/"+this.id+"/comments",this.on("change",function(){b.comments.url="/api/tickets/"+this.id+"/comments"}),this.get("status")==="open"&&(this.on("assignedUser",function(){var c=a.include(b.get("assigned_to"),d.id);c&&b.set("participating",!0)}),this.on("unassignedUser",function(){var c=a.include(b.get("assigned_to"),d.id);c||b.set("participating",!1)})),this.on("sync",function(){b.get("user").id===d.id&&b.set("participating",!0)}),this.comments.on("comments:add",function(a){a.get("user").id===d.id&&b.set("participating",!0)}),this.on("error",function(a,b){ticketer.EventEmitter.trigger("error",b)}),this.on("change:status",function(a,b){b==="closed"&&(ticketer.collections.openTickets.remove(this),ticketer.collections.closedTickets.add(this))})},isOpen:function(){return this.get("status")==="open"},participating:function(){return this.get("participating")&&this.get("participating")===!0},notification:function(){return this.get("notification")&&this.get("notification")===!0},removeNotification:function(){this.unset("notification"),ticketer.EventEmitter.trigger("ticket:notification:remove",this.id)},_validate:function(a){if(typeof a.title!="undefined"&&!a.title.replace(/ /g,"").length)return"You must enter a ticket title.";if(typeof a.description!="undefined"&&!a.description.replace(/ /g,"").length)return"You must enter a ticket description."},updateTicket:function(a,b){a.title&&this.set({title:a.title}),a.description&&this.set({description:a.description}),a.status&&this.set({status:a.status}),this.save(null,{error:b})},close:function(a){var b=this;this.save({status:"closed"},{error:a,success:function(){b.unbind("assignedUser",b.collection.setMyTickets),b.unbind("unassignedUser",b.collection.setMyTickets)}})},assignUser:function(b,c){var d=a.clone(this.get("assigned_to"));d.push(b),this.set({assigned_to:a.uniq(d)},{silent:!0}),this.trigger("assignedUser",this),this.save(null,{error:c})},unassignUser:function(b,c){var d=a.clone(this.get("assigned_to")),e=a.reject(d,function(a){return a===b});this.set({assigned_to:a.uniq(e)},{silent:!0}),this.trigger("unassignedUser",this),this.save(null,{error:c})},responseTime:function(){if(this.get("closed_at")){var a,b,c,d,e=new Date(this.get("closed_at")),f=new Date(this.get("opened_at")),g=e.getTime()-f.getTime();return a=Math.floor(g/1e3/60/60/24),g-=a*1e3*60*60*24,b=Math.floor(g/1e3/60/60),g-=b*1e3*60*60,c=Math.floor(g/1e3/60),a.toString()+" days, "+b.toString()+" hours, "+c.toString()+" minutes"}return!1}});return d}),define("collections/Tickets",["underscore","backbone","models/Ticket"],function(a,b,c){var d=b.Collection.extend({model:c,url:"/api/tickets",initialize:function(){var b=this;a.bindAll(this),this.comparator=function(a){var b=new Date(a.get("opened_at"));return-b.getTime()},this.page=1,this.on("reset",this.loadAllComments),this.on("add",this.loadComment),ticketer.EventEmitter.on("ticket:update",this.updateTicket),ticketer.EventEmitter.on("ticket:remove",this.removeTicket),ticketer.EventEmitter.on("comment:new",this.addComment),ticketer.EventEmitter.on("comment:update",this.updateComment),ticketer.EventEmitter.on("comment:remove",this.removeComment),this.filters=[],ticketer.EventEmitter.on("tickets:setFilters",this.setFilters)},setFilters:function(a){this.filters=a,this.trigger("change:filters")},loadAllComments:function(){var a=this;this.each(function(b){a.loadComment(b)})},loadComment:function(a){a.comments.fetch()},filter:function(a){var c=b.Collection.prototype.filter;return typeof a!="function"?c.call(this,function(b){return b.get(a)===!0}):c.call(this,a)},updateTicket:function(b){var c=a.clone(b),d=this.get(c.id);d&&d.set(d.parse(c))},removeTicket:function(a){this.remove(a)},addComment:function(b){var c=a.clone(b),d=this.get(c.ticket);d&&(delete c.ticket,c.notification&&(d.set({notification:c.notification}),delete c.notification),d.comments.add(c))},updateComment:function(b){var c=a.clone(b),d=this.get(c.ticket);if(d){delete c.ticket,b.notification&&(d.set({notification:c.notification}),delete c.notification);var e=d.comments.get(c.id);e.set(e.parse(c))}},removeComment:function(b){var c=a.clone(b),d=this.get(c.ticket);d&&d.comments.remove(c.comment)}});return d}),define("models/User",["underscore","backbone"],function(a,b){var c=b.Model.extend({url:"/api/users",initialize:function(){}});return c}),define("collections/Users",["underscore","backbone","models/User"],function(a,b,c){var d=b.Collection.extend({model:c,url:"/api/users",initialize:function(){this.comparator=function(a){return a.get("name")}}});return d}),define("models/Project",["underscore","backbone"],function(a,b){var c;return c=b.Model.extend({initialize:function(){a.bindAll(this),this.validate=this._validate,this.set({socket:ticketer.sockets.id},{silent:!0}),this.on("error",function(a,b){ticketer.EventEmitter.trigger("error",b)})},hasTicket:function(a){return!!~this.get("tickets").indexOf(a)},addTicket:function(b,c){var d=this.get("tickets");return a.isArray(b)?a(b).each(function(a){~d.indexOf(a)||d.push(a)}):~d.indexOf(b)||d.push(b),this.save(null,{error:c}),this},removeTicket:function(b,c){function e(a){var b=d.indexOf(a);b!==-1&&d.splice(b,1)}var d=this.get("tickets");return a.isArray(b)?a(b).each(function(a){e(a)}):e(b),this.save(null,{error:c}),this},_validate:function(a){if(typeof a.name!="undefined"&&!a.name.replace(/\s/g,"").length)return"You must enter a project name."}}),c}),define("collections/Projects",["underscore","backbone","models/Project"],function(a,b,c){var d;return d=b.Collection.extend({model:c,url:"/api/projects",initialize:function(){a.bindAll(this),ticketer.EventEmitter.on("project:new",this.addProject),ticketer.EventEmitter.on("project:update",this.updateProject),ticketer.EventEmitter.on("project:remove",this.removeProject)},getProjectTickets:function(a){var b=this.get(a.id);return b.get("tickets")},addProject:function(a){var b=this.get(a.id);b||this.add(a)},updateProject:function(a){var b=this.get(a.id);b?(a.description&&b.set({description:a.description}),a.name&&b.set({title:a.name}),a.tickets&&b.set({tickets:a.tickets})):this.add(a)},removeProject:function(a){var b=this.get(a.id);b&&b.destroy()}}),d}),define("models/List",["underscore","backbone"],function(a,b){var c;return c=b.Model.extend({initialize:function(){a.bindAll(this),this.validate=this._validate,this.on("error",function(a,b){ticketer.EventEmitter.trigger("error",b)})},hasTicket:function(a){return!!~this.get("tickets").indexOf(a)},addTicket:function(b,c){var d=this.get("tickets");return a.isArray(b)?a(b).each(function(a){~d.indexOf(a)||d.push(a)}):~d.indexOf(b)||d.push(b),this.save(null,{error:c}),this},removeTicket:function(b,c){function e(a){var b=d.indexOf(a);b!==-1&&d.splice(b,1)}var d=this.get("tickets");return a.isArray(b)?a(b).each(function(a){e(a)}):e(b),this.save(null,{error:c}),this},_validate:function(a){if(typeof a.name!="undefined"&&!a.name.replace(/\s/g,"").length)return"You must enter a task name."}}),c}),define("collections/Lists",["underscore","backbone","models/List"],function(a,b,c){var d;return d=b.Collection.extend({model:c,url:"/api/lists",initialize:function(){a.bindAll(this)},getListTickets:function(a){var b=this.get(a.id);return b.get("tickets")}}),d}),define("AppView",["jquery","underscore","backbone"],function(a,b,c){function d(){this.showToolbar=function(b,c){this.currentToolbar&&this.currentToolbar.dispose(),this.currentToolbar=new b(c),this.currentToolbar.render(),a("#sidebar").html(this.currentToolbar.el)},this.showToolbarTab=function(a){this.currentToolbar.selectTab(a)},this.showView=function(b,c){var d=this;this.currentView&&this.currentView.dispose(),this.currentView=b,this.currentView.render(),a("#main").fadeOut(200,function(){a(this).html(d.currentView.el)}).fadeIn(200,c)}}return d});var Mustache=function(){var a={},b=function(){};return b.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a);return}a=this.render_pragmas(a);var e=this.render_section(a,b,c);e===!1&&(e=this.render_tags(a,b,c,d));if(d)return e;this.sendLines(e)},send:function(a){a!==""&&this.buffer.push(a)},sendLines:function(a){if(a){var b=a.split("\n");for(var c=0;c<b.length;c++)this.send(b[c])}},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this,c=this.getCachedRegex("render_pragmas",function(a,b){return new RegExp(a+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+b,"g")});return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return typeof b[a]!="object"?this.render(c[a],b,c,!0):this.render(c[a],b[a],c,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return!1;var d=this,e=this.getCachedRegex("render_section",function(a,b){return new RegExp("^([\\s\\S]*?)"+a+"(\\^|\\#)\\s*(.+)\\s*"+b+"\n*([\\s\\S]*?)"+a+"\\/\\s*\\3\\s*"+b+"\\s*([\\s\\S]*)$","g")});return a.replace(e,function(a,e,f,g,h,i){var j=e?d.render_tags(e,b,c,!0):"",k=i?d.render(i,b,c,!0):"",l,m=d.find(g,b);return f==="^"?!m||d.is_array(m)&&m.length===0?l=d.render(h,b,c,!0):l="":f==="#"&&(d.is_array(m)?l=d.map(m,function(a){return d.render(h,d.create_context(a),c,!0)}).join(""):d.is_object(m)?l=d.render(h,d.create_context(m),c,!0):typeof m=="function"?l=m.call(b,h,function(a){return d.render(a,b,c,!0)}):m?l=d.render(h,b,c,!0):l=""),j+l+k})},render_tags:function(a,b,c,d){var e=this,f=function(){return e.getCachedRegex("render_tags",function(a,b){return new RegExp(a+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+b+"+","g")})},g=f(),h=function(a,d,h){switch(d){case"!":return"";case"=":return e.set_delimiters(h),g=f(),"";case">":return e.render_partial(h,b,c);case"{":return e.find(h,b);default:return e.escape(e.find(h,b))}},i=a.split("\n");for(var j=0;j<i.length;j++)i[j]=i[j].replace(g,h,this),d||this.send(i[j]);if(d)return i.join("\n")},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]),this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function c(a){return a===!1||a===0||a}a=this.trim(a);var d;if(a.match(/([a-z_]+)\./ig)){var e=this.walk_context(a,b);c(e)&&(d=e)}else c(b[a])?d=b[a]:c(this.context[a])&&(d=this.context[a]);return typeof d=="function"?d.apply(b):d!==undefined?d:""},walk_context:function(a,b){var c=a.split("."),d=b[c[0]]!=undefined?b:this.context,e=d[c.shift()];while(e!=undefined&&c.length>0)d=e,e=e[c.shift()];return typeof e=="function"?e.apply(d):e},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return a=String(a===null?"":a),a.replace(/&(?!\w+;)|["'<>\\]/g,function(a){switch(a){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return a}})},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);var c=[],d=a.length;for(var e=0;e<d;e++)c.push(b(a[e]));return c},getCachedRegex:function(b,c){var d=a[this.otag];d||(d=a[this.otag]={});var e=d[this.ctag];e||(e=d[this.ctag]={});var f=e[b];return f||(f=e[b]=c(this.otag,this.ctag)),f}},{name:"mustache.js",version:"0.4.0-dev",to_html:function(a,c,d,e){var f=new b;e&&(f.send=e),f.render(a,c||{},d);if(!e)return f.buffer.join("\n")}}}();define("mustache",function(){}),function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d=typeof location!="undefined"&&location.href,e=d&&location.protocol&&location.protocol.replace(/\:/,""),f=d&&location.hostname,g=d&&(location.port||void 0),h=[];define("text",[],function(){var l,m,s;return typeof window!="undefined"&&window.navigator&&window.document?m=function(a,b){var c=l.createXhr();c.open("GET",a,!0),c.onreadystatechange=function(){c.readyState===4&&b(c.responseText)},c.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(s=require.nodeRequire("fs"),m=function(a,b){b(s.readFileSync(a,"utf8"))}):typeof Packages!="undefined"&&(m=function(a,b){var c=new java.io.File(a),d=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),e,f,g="";try{e=new java.lang.StringBuffer,(f=c.readLine())&&f.length()&&f.charAt(0)===65279&&(f=f.substring(1));for(e.append(f);(f=c.readLine())!==null;)e.append(d),e.append(f);g=String(e.toString())}finally{c.close()}b(g)}),l={version:"1.0.2",strip:function(a){if(a){var a=a.replace(b,""),d=a.match(c);d&&(a=d[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}if(!b)throw Error("createXhr(): XMLHttpRequest not available");return b},get:m,parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),a=a.substring(c+1,a.length),c=a.indexOf("!");return c!==-1&&(b=a.substring(c+1,a.length),b=b==="strip",a=a.substring(0,c)),{moduleName:d,ext:a,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=l.xdRegExp.exec(a),f;return e?(a=e[2],e=e[3],e=e.split(":"),f=e[1],e=e[0],(!a||a===b)&&(!e||e===c)&&(!f&&!e||f===d)):!0},finishLoad:function(a,b,c,d,e){c=b?l.strip(c):c,e.isBuild&&(h[a]=c),d(c)},load:function(a,b,c,h){if(h.isBuild&&!h.inlineText)c();else{var j=l.parseName(a),k=j.moduleName+"."+j.ext,m=b.toUrl(k),n=h&&h.text&&h.text.useXhr||l.useXhr;!d||n(m,e,f,g)?l.get(m,function(b){l.finishLoad(a,j.strip,b,c,h)}):b([k],function(a){l.finishLoad(j.moduleName+"."+j.ext,j.strip,a,c,h)})}},write:function(a,b,c){if(b in h){var d=l.jsEscape(h[b]);c.asModule(a+"!"+b,"define(function () { return '"+d+"';});\n")}},writeFile:function(a,b,c,d,e){var b=l.parseName(b),f=b.moduleName+"."+b.ext,g=c.toUrl(b.moduleName+"."+b.ext)+".js";l.load(f,c,function(){var b=function(a){return d(g,a)};b.asModule=function(a,b){return d.asModule(a,g,b)},l.write(a,f,b,e)},e)}}})}(),define("text!templates/headers/MainHeader.html",[],function(){return'<h1 class="logo"><a href="/">Ticket System</a></h1>\n\n<ul data-role="action-container" class="actions">\n  <li><a title="Refresh" href="#" data-action="refresh"><i class="icon-refresh"></i></a></li>\n  <li><a title="New Ticket" href="#" data-route="tickets/new" data-action="new-ticket"><i class="icon-edit"></i></a></li>\n  <li class="spacer"><a title="New Tag" href="#" data-action="new-tag"><i class="icon-bookmark"></i><i class="icon-sort-down"></i></a></li>\n</ul>'}),define("text!templates/headers/UserOptions.html",[],function(){return'<ul class="user-actions">\n  <li class="dropdown">\n    <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n      <img src="{{user.avatar}}" alt="{{user.name}}" />\n      <span class="name">{{user.name}}</span>\n      <i class="icon-sort-down"></i>\n    </a>\n\n    <ul class="dropdown-menu">\n      <li><a href="#">Settings</a></li>\n      <li class="divider"></li>\n      <li><a href="/logout">Logout</a></li>\n    </ul>\n  </li>\n</ul>'}),define("text!templates/widgets/TagForm.html",[],function(){return'<div class="color-picker">\n  <ul>\n    {{#colors}}\n      <li class="color-{{name}}" data-value="{{value}}"></li>\n    {{/colors}}\n  </ul>\n</div>\n\n<form action="#">\n  <input type="text" placeholder="Create a New Tag" disabled>\n</form>'}),define("views/widgets/TagFormView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/TagForm.html"],function(a,b,c,d,e,f){var g=d.extend({className:"tags-form",events:{"click .color-picker li":"setColor","keypress input[type=text]":"createOnEnter"},initialize:function(){b.bindAll(this),this.bindTo(this.$el,"click",function(a){a.stopPropagation()}),this.bindTo(a("html"),"click.tag-widget.data-api",this.dispose)},render:function(){var a={colors:ticketer.colors};return this.$el.html(Mustache.to_html(f,a)),this},setColor:function(b){var c=a(b.currentTarget);value=c.data("value"),this.color=value,this.$el.find("li.active").removeClass("active"),c.addClass("active"),a("input[type=text]").attr("disabled",!1)},createOnEnter:function(b){var c=a("input[type=text]",this.$el);if(b.keyCode!=13)return;if(b.keyCode===13&&!b.ctrlKey){b.preventDefault();var d=this;ticketer.collections.lists.create({color:this.color,name:c.val()},{wait:!0}),this.dispose()}}});return g}),!function(a){function d(){a(b).each(function(){e(a(this)).removeClass("open")})}function e(b){var c=b.attr("data-target"),d;return c||(c=b.attr("href"),c=c&&/#/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,"")),d=a(c),d.length||(d=b.parent()),d}var b="[data-toggle=dropdown]",c=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};c.prototype={constructor:c,toggle:function(b){var c=a(this),f,g;if(c.is(".disabled, :disabled"))return;return f=e(c),g=f.hasClass("open"),d(),g||f.toggleClass("open"),c.focus(),!1},keydown:function(b){var c,d,f,g,h,i;if(!/(38|40|27)/.test(b.keyCode))return;c=a(this),b.preventDefault(),b.stopPropagation();if(c.is(".disabled, :disabled"))return;g=e(c),h=g.hasClass("open");if(!h||h&&b.keyCode==27)return c.click();d=a("[role=menu] li:not(.divider):visible a",g);if(!d.length)return;i=d.index(d.filter(":focus")),b.keyCode==38&&i>0&&i--,b.keyCode==40&&i<d.length-1&&i++,~i||(i=0),d.eq(i).focus()}};var f=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var d=a(this),e=d.data("dropdown");e||d.data("dropdown",e=new c(this)),typeof b=="string"&&e[b].call(d)})},a.fn.dropdown.Constructor=c,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=f,this},a(document).on("click.dropdown.data-api touchstart.dropdown.data-api",d).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("touchstart.dropdown.data-api",".dropdown-menu",function(a){a.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",b,c.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",b+", [role=menu]",c.prototype.keydown)}(window.jQuery),define("dropdowns",function(){}),define("views/headers/MainHeaderView",["jquery","underscore","mustache","BaseView","views/widgets/TagFormView","text!templates/headers/MainHeader.html","text!templates/headers/UserOptions.html","dropdowns"],function(a,b,c,d,e,f,g){var h=d.extend({className:"header",events:{"click a[data-action]":"preventDefault","click a[data-route]":"navigateTo","click a[data-action='refresh']":"refresh","click a[data-action='new-tag']":"showTagWidget"},initialize:function(){var a=this;b.bindAll(this),ticketer.EventEmitter.on("session:set",function(){a.addUserOptions()})},render:function(){return this.$el.html(Mustache.to_html(f)),this},addUserOptions:function(){var b={};a(".user-actions",this.el).remove(),b.user=ticketer.currentUser,this.$el.append(Mustache.to_html(g,b))},preventDefault:function(a){a.preventDefault()},navigateTo:function(b){b.preventDefault();var c=a(b.currentTarget).data("route");ticketer.routers.ticketer.navigate(c,!0)},refresh:function(){ticketer.collections.openTickets.reset(),ticketer.collections.closedTickets.reset(),ticketer.collections.users.reset(),ticketer.sockets.sock.emit("tickets:fetch"),ticketer.collections.closedTickets.fetch({data:{page:1,status:"closed"}}),ticketer.collections.users.fetch()},showTagWidget:function(b){var c=a(b.currentTarget).parent(),d;b.preventDefault(),b.stopPropagation(),c.children(".tags-form").length||(d=this.createView(e),a(c).append(d.render().el))}});return h}),define("text!templates/main/Filler.html",[],function(){return'<div class="view-filler">\n  <p>{{text}}</p>\n</div>'}),define("views/main/ListPanelView",["jquery","underscore","mustache","BaseView","text!templates/main/Filler.html"],function(a,b,c,d,e){var f=d.extend({className:"panel-two",initialize:function(){b.bindAll(this),this.bindTo(this.collection,"add remove reset",this.render)},render:function(){return this.options.filter&&this.collection.filter(this.options.filter).length===0?this.renderFiller():this.collection.length?this.renderView():this.renderFiller()},renderFiller:function(){return this.$el.html(Mustache.to_html(e,{text:"No items to display"})),this},renderView:function(){var a=this.createView(this.options.view,{collection:this.collection,filter:this.options.filter});return this.$el.html(a.render().el),this}});return f}),define("views/main/DetailsPanelView",["jquery","underscore","mustache","BaseView","text!templates/main/Filler.html"],function(a,b,c,d,e){var f=d.extend({className:"panel-three",initialize:function(){b.bindAll(this)},render:function(){return this.model?this.renderDetailsView():this.renderFiller()},renderFiller:function(){return this.$el.html(Mustache.to_html(e,{text:"Select an item to view it's details."})),this},renderDetailsView:function(){var a=this.createView(this.options.view,{model:this.model});return this.bindTo(this.model,"remove",this.renderFiller),this.$el.html(a.render().el),this}});return f}),define("text!templates/main/container.html",[],function(){return'<div id="panel-wrapper">\n  <div id="panel-two" role="panel-two" class="scrollable"></div>\n  <div id="panel-three" role="panel-three" class="scrollable"></div>\n</div>'}),define("views/main/PanelView",["jquery","underscore","mustache","BaseView","views/main/ListPanelView","views/main/DetailsPanelView","text!templates/main/container.html"],function(a,b,c,d,e,f,g){var h=d.extend({className:"container",events:{"click [role=panel-two] .item":"renderDetailsPanel"},initialize:function(){b.bindAll(this),this.bindTo(a(window),"resize",this.setPanelHeight),this.bindTo(this.collection,"filter",this.renderListPanel)},render:function(){return this.$el.empty(),this.$el.html(Mustache.to_html(g)),this.setPanelHeight(),this.renderListPanel(),this},renderListPanel:function(b){function c(){var a=this;return b&&this.options.filter?function(c){return b(c)&&a.options.filter(c)}:b||a.options.filter}this.panelTwo&&this.panelTwo.dispose(),this.panelTwo=this.createView(e,{collection:this.collection,view:this.options.list,filter:c.call(this)}),this.renderDetailsPanel(),a("[role=panel-two]",this.el).html(this.panelTwo.render().el)},renderDetailsPanel:function(b){this.panelThree&&this.panelThree.dispose();if(b){var c=a(b.currentTarget).data("id"),d=this.collection.get(c);this.panelThree=this.createView(f,{view:this.options.details,model:d}),this.selectItem(c)}else this.panelThree=this.createView(f,{view:this.options.details});a("[role=panel-three]",this.el).html(this.panelThree.render().el)},setPanelHeight:function(){var b=a(window).height(),c=a("header").height(),d;d=b-c-1,a("[role=panel-two]",this.el).css("height",d),a("[role=panel-three]",this.el).css("height",d)},selectItem:function(a){return this.$el.find(".active").removeClass("active"),a&&this.$el.find('.item[data-id="'+a+'"]').addClass("active"),this}});return h}),define("timeline",["jquery","backbone"],function(a,b){var c=function(){function b(a,b,c,d,e){var f,g,h,i,j;f=this,this.collection=a,this.render=b,this.el=d,this.args=e,this.elements={wrapper:c,firstItem:c.find(this.el+":first-child"),lastItem:c.find(this.el+":last-child")},this.shouldCheckScroll=!1,this.didScroll=this.didScroll}return b.prototype.infiniteScrollThreshold=175,b.prototype.permalinkScrollThreshold=200,b.prototype.laterItemsPossible=!0,b.prototype.receivedData=function(a){var b,c,d,e,f,g;e=function(){var d,e,f;f=[];for(d=0,e=a.length;d<e;d++)g=a[d],b=this.collection.get(g.id),c=this.render(b),f.push(this.elements.wrapper.append(c));return f}.call(this),this.elements.lastItem=this.elements.wrapper.find(this.el+":last-child"),this.elements.firstItem=this.elements.wrapper.find(this.el+":first-child")},b.prototype.didScroll=function(){var b,c,d,e,f,g,h,i,j,k,l,m;b=this;if(!this.shouldCheckScroll)return;this.shouldCheckScroll=!1,i=a(document).scrollTop()+a(window).height(),f=this.elements.firstItem.offset().top,c=this.elements.lastItem.outerHeight()+this.elements.lastItem.offset().top,this.laterItemsPossible&&c-i<this.infiniteScrollThreshold&&(h=this.collection.page+1,this.collection.fetch({add:!0,data:{page:h,status:this.args.status},success:function(a,c){c.length!=0&&(b.collection.page=h),b.receivedData(c)}}))},b}();return c}),define("text!templates/widgets/UserWidget.html",[],function(){return'<a class="add" data-action="display" title="Assign a user" href="#"><i class="icon-plus"></i></a>\n<input data-action="assign" type="text" placeholder="Find a user">\n<ul data-role="results-list" class="results-list"></ul>'}),define("text!templates/widgets/User.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="user">\n  <img alt="{{name}}" src="{{avatar}}"> {{name}}\n</li>'}),define("views/widgets/UserWidgetView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/UserWidget.html","text!templates/widgets/User.html"],function(a,b,c,d,e,f,g){var h=d.extend({tagName:"li",className:"widget user-widget",events:{"click [data-action='display']":"bindEvents","blur [data-action='assign']":"unbindEvents","click [data-role='results-list'] li":"assignUser"},initialize:function(){b.bindAll(this),this.$el.attr("data-role","assign-user")},render:function(){return this.$el.html(Mustache.to_html(f)),this},renderUser:function(a){return Mustache.to_html(g,a)},renderFilteredResults:function(b){var c,d=a(b.currentTarget).val(),e=this.$el.find('[data-role="results-list"]'),f=e.children(".active");b.keyCode===13&&f.length?this.model.assignUser(f.data("id")):b.keyCode===40&&f.length?(c=(f.index()+1)%e.children().length,f.removeClass("active"),a(e.children().get(c)).addClass("active")):d.replace(/\s+/g,"").length?(e.html(this.filterUsers(d.toLowerCase())).fadeIn(400),e.children(":first").addClass("active")):e.empty()},filterUsers:function(a){var b=this,c=[];return this.collection.each(function(d){var e=d.get("name").toLowerCase();~e.indexOf(a)&&!~b.model.get("assigned_to").indexOf(d.id)&&c.push(b.renderUser(d.toJSON()))}),c.slice(0,4).join("")},bindEvents:function(a){var b=this.$el.find("input");this.bindTo(b,"keyup",this.renderFilteredResults),this.$el.find("a").hide(),this.$el.find("input").fadeIn(200).focus(),a.preventDefault()},unbindEvents:function(a){var b=this;this.$el.find("input").off("keyup"),this.$el.find(".results-list, input").fadeOut(200,function(){b.$el.find("input").val(""),b.$el.find("a").show(200)})},assignUser:function(b){var c=a(b.currentTarget).data("id");b.preventDefault(),b.stopPropagation(),this.model.assignUser(c)},unassignUser:function(b){var c=a(b.currentTarget).parent().data("id");b.preventDefault(),b.stopPropagation(),this.model.unassignUser(c)}});return h}),define("text!templates/widgets/TagWidget.html",[],function(){return'<a class="add tag-widget" data-action="display" title="Assign tag" href="#"><i class="icon-plus"></i></a>\n<ul class="tags"></ul>'}),define("text!templates/widgets/Tag.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="tag color-{{color}}">\n  <i class="icon-bookmark"></i><span data-action="edit">{{name}}</span>\n</li>'}),define("views/widgets/TagWidgetView",["jquery","underscore","backbone","BaseView","mustache","text!templates/widgets/TagWidget.html","text!templates/widgets/Tag.html"],function(a,b,c,d,e,f,g){var h=d.extend({tagName:"li",className:"widget tag-widget",events:{"click [data-action='display']":"renderTags","click li":"assignTag"},initialize:function(){b.bindAll(this),a(this.el).attr("data-role","assign-tag"),this.bindTo(this.$el,"click",function(a){a.stopPropagation()}),this.bindTo(a("html"),"click.tag-widget.data-api",this.hideTags)},render:function(){return this.$el.html(Mustache.to_html(f)),this},renderTags:function(a){var b=this,c=this.model.id,d=this.$el.find(".tags");return d.empty(),this.collection.each(function(a){a.hasTicket(c)||d.append(b.renderTag(a)).fadeIn(200)}),a.preventDefault(),this},renderTag:function(a){var b=a.toJSON();return b.color=ticketer.colors[b.color].name,Mustache.to_html(g,b)},assignTag:function(b){var c=a(b.currentTarget).data("id"),d=this.collection.get(c);d&&(d.addTicket(this.model.id),this.model.trigger("tag:add",d)),this.hideTags()},hideTags:function(){this.$el.find(".tags").fadeOut(200,function(){a(this).empty()})}});return h}),define("text!templates/tickets/Ticket.html",[],function(){return'<div class="ticket-content">\n  <div class="header {{statusClass}}">\n    <hgroup>\n      <h2 class="title">{{title}}</h2>\n      <h4>{{user.name}}</h4>\n    </hgroup>\n\n    <div class="attrs">\n\n      {{#fullDate}}\n        <time title="{{hoverTime}}" datetime="{{datetime}}">{{fullDate}}</time>\n      {{/fullDate}}\n\n      {{^fullDate}}\n        <time title="{{hoverTime}}" datetime="{{datetime}}">{{cleanTime}}</time>\n      {{/fullDate}}\n\n      {{#showTags}}\n        <ul class="tags"></ul>\n      {{/showTags}}\n\n    </div>\n\n    {{#isEditable}}\n      <ul class="edit-options">\n        {{#isAdmin}}\n          <li data-role="close-ticket"><a data-action="close" href="#"><i class="icon-ok"></i></a></li>\n        {{/isAdmin}}\n        <li><a data-action="edit" href="#"><i class="icon-edit"></i></a></li>\n        <li><a data-action="delete" href="#"><i class="icon-trash"></i></a></li>\n      </ul>\n    {{/isEditable}}\n  </div>\n\n  {{#description}}\n    <div class="content md">\n      {{{description}}}\n    </div>\n  {{/description}}\n</div>'}),define("text!templates/tickets/AssignedUser.html",[],function(){return'<li class="user" data-id="{{id}}"><img title="{{name}}" alt="{{fullname}}" src="{{avatar}}"></li>'}),define("views/tickets/TicketAssignView",["jquery","underscore","mustache","BaseView","views/widgets/UserWidgetView","text!templates/tickets/AssignedUser.html"],function(a,b,c,d,e,f){var g=d.extend({tagName:"ul",className:"assigned-users",events:{"click li.user":"unAssignUser"},initialize:function(){b.bindAll(this),this.bindTo(this.model,"change:assigned_to",this.render)},render:function(){var a,b=this,c=this.model.get("assigned_to");return this.$el.empty(),this.widget&&this.widget.dispose(),a=ticketer.collections.users.filter(function(a){return~c.indexOf(a.id)}),a.forEach(function(a){b.$el.append(Mustache.to_html(f,a.toJSON()))}),this.renderWidget(),this},renderWidget:function(){this.widget=this.createView(e,{collection:ticketer.collections.users,model:this.model}),this.$el.append(this.widget.render().el)},unAssignUser:function(b){var c=a(b.currentTarget).data("id"),d=confirm("Remove the user from the Ticket?");d&&this.model.unassignUser(c)}});return g}),define("text!templates/tickets/EditTicket.html",[],function(){return'<div class="ticket-form">\n\t<div class="wrap">\n  \t<textarea name="description">{{description}}</textarea>\n  </div>\n  <div class="actions">\n    <ul class="right">\n      <li><button data-action="save">Save</button></li>\n      <li><button data-action="cancel" class="cancel">Cancel</button></li>\n    </ul>\n  </div>\n</div>'}),define("text!templates/tickets/ClosedNotification.html",[],function(){return'<div class="notification">\n  <p>This ticket has been closed.</p>\n</div>'}),define("text!templates/tickets/AssignedTag.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="tag color-{{color}}">\n  <i class="icon-bookmark"></i>\n</li>'}),define("views/tickets/TicketTagView",["jquery","underscore","backbone","BaseView","mustache","views/widgets/TagWidgetView","text!templates/tickets/AssignedTag.html"],function(a,b,c,d,e,f,g){var h=d.extend({tagName:"ul",className:"assigned-tags",events:{"click li.tag":"unassignTag"},initialize:function(){b.bindAll(this),this.bindTo(this.model,"tag:add tag:remove",this.render)},render:function(){var a,b,c,d=this;this.$el.empty(),this.widget&&this.widget.dispose(),c=ticketer.collections.lists.filter(function(a){return a.hasTicket(d.model.id)}),this.renderWidget(),c.length===0&&this.$el.append("<li class='empty'>Add a Tag</li>");for(a=0,b=c.length;a<b;a++)this.$el.append(this.renderTag(c[a]));return this},renderTag:function(a){var b=a.toJSON();return b.color=ticketer.colors[b.color].name,Mustache.to_html(g,b)},renderWidget:function(){this.widget=this.createView(f,{collection:ticketer.collections.lists,model:this.model}),this.$el.append(this.widget.render().el)},unassignTag:function(b){var c,d=a(b.currentTarget).data("id"),e=confirm("Remove this tag from the Ticket?");e&&(c=ticketer.collections.lists.get(d),c&&(c.removeTicket(this.model.id),this.model.trigger("tag:remove",c)))}});return h}),define("views/tickets/TicketMetaView",["jquery","underscore","mustache","BaseView","views/tickets/TicketAssignView","views/tickets/TicketTagView"],function(a,b,c,d,e,f){var g=d.extend({className:"ticket-meta",initialize:function(){b.bindAll(this)},render:function(){return this.renderAssignView(),this.renderTagWidget(),this},renderAssignView:function(){var a;a=this.createView(e,{model:this.model}),this.$el.append(a.render().el)},renderTagWidget:function(){var a;a=this.createView(f,{model:this.model}),this.$el.append(a.render().el)}});return g}),function(a){function b(a,b,c,d){var e=c.lang();return e[a].call?e[a](c,d):e[a][b]}function c(a,b){return function(c){return h(a.call(this,c),b)}}function d(a){return function(b){var c=a.call(this,b);return c+this.lang().ordinal(c)}}function e(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,this._lang=c||!1}function f(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,e=a.weeks||a.w||0,f=a.days||a.d||0,h=a.hours||a.h||0,i=a.minutes||a.m||0,j=a.seconds||a.s||0,k=a.milliseconds||a.ms||0;this._milliseconds=k+j*1e3+i*6e4+h*36e5,this._days=f+e*7,this._months=d+c*12,b.milliseconds=k%1e3,j+=g(k/1e3),b.seconds=j%60,i+=g(j/60),b.minutes=i%60,h+=g(i/60),b.hours=h%24,f+=g(h/24),f+=e*7,b.days=f%30,d+=g(f/30),b.months=d%12,c+=g(d/12),b.years=c,this._lang=!1}function g(a){return a<0?Math.ceil(a):Math.floor(a)}function h(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function i(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function j(a){return Object.prototype.toString.call(a)==="[object Array]"}function k(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function l(a,b,c,d){var e,f,g=[];for(e=0;e<7;e++)g[e]=a[e]=a[e]==null?e===2?1:0:a[e];return a[7]=g[7]=b,a[8]!=null&&(g[8]=a[8]),a[3]+=c||0,a[4]+=d||0,f=new Date(0),b?(f.setUTCFullYear(a[0],a[1],a[2]),f.setUTCHours(a[3],a[4],a[5],a[6])):(f.setFullYear(a[0],a[1],a[2]),f.setHours(a[3],a[4],a[5],a[6])),f._a=g,f}function m(a,b){var c,d,e=[];!b&&H&&(b=require("./lang/"+a));for(c=0;c<I.length;c++)b[I[c]]=b[I[c]]||F.en[I[c]];for(c=0;c<12;c++)d=B([2e3,c]),e[c]=new RegExp("^"+(b.months[c]||b.months(d,""))+"|^"+(b.monthsShort[c]||b.monthsShort(d,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||e,F[a]=b,b}function n(a){var b=typeof a=="string"&&a||a&&a._lang||null;return b?F[b]||m(b):B}function o(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function p(a){var b=a.match(K),c,d;for(c=0,d=b.length;c<d;c++)bb[b[c]]?b[c]=bb[b[c]]:b[c]=o(b[c]);return function(e){var f="";for(c=0;c<d;c++)f+=typeof b[c].call=="function"?b[c].call(e,a):b[c];return f}}function q(a,b){function c(b){return a.lang().longDateFormat[b]||b}var d=5;while(d--&&L.test(b))b=b.replace(L,c);return $[b]||($[b]=p(b)),$[b](a)}function r(a){switch(a){case"DDDD":return P;case"YYYY":return Q;case"S":case"SS":case"SSS":case"DDD":return O;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return R;case"Z":case"ZZ":return S;case"T":return T;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return N;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c,d){var e,f;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(n().monthsParse[e].test(b)){c[1]=e,f=!0;break}f||(c[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":c[0]=~~b+(~~b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(X),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}b==null&&(c[8]=!1)}function t(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(K),f,g;for(f=0;f<e.length;f++)g=(r(e[f]).exec(a)||[])[0],g&&(a=a.slice(a.indexOf(g)+g.length)),bb[e[f]]&&s(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),l(c,d.isUTC,d.tzh,d.tzm)}function u(a,b){var c,d=a.match(M)||[],f,g=99,h,i,j;for(h=0;h<b.length;h++)i=t(a,b[h]),f=q(new e(i),b[h]).match(M)||[],j=k(d,f),j<g&&(g=j,c=i);return c}function v(a){var b="YYYY-MM-DDT",c;if(U.exec(a)){for(c=0;c<4;c++)if(W[c][1].exec(a)){b+=W[c][0];break}return S.exec(a)?t(a,b+" Z"):t(a,b)}return new Date(a)}function w(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function x(a,b,c){var d=D(Math.abs(a)/1e3),e=D(d/60),f=D(e/60),g=D(f/24),h=D(g/365),i=d<45&&["s",d]||e===1&&["m"]||e<45&&["mm",e]||f===1&&["h"]||f<22&&["hh",f]||g===1&&["d"]||g<=25&&["dd",g]||g<=45&&["M"]||g<345&&["MM",D(g/30)]||h===1&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,w.apply({},i)}function y(a,b){B.fn[a]=function(a){var c=this._isUTC?"UTC":"";return a!=null?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function z(a){B.duration.fn[a]=function(){return this._data[a]}}function A(a,b){B.duration.fn["as"+a]=function(){return+this/b}}var B,C="1.7.2",D=Math.round,E,F={},G="en",H=typeof module!="undefined"&&module.exports,I="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),J=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,L=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,M=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,N=/\d\d?/,O=/\d{1,3}/,P=/\d{3}/,Q=/\d{1,4}/,R=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,S=/Z|[\+\-]\d\d:?\d\d/i,T=/T/i,U=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,V="YYYY-MM-DDTHH:mm:ssZ",W=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],X=/([\+\-]|\d\d)/gi,Y="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Z={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},$={},_="DDD w M D d".split(" "),ba="M D H h m s w".split(" "),bb={M:function(){return this.month()+1},MMM:function(a){return b("monthsShort",this.month(),this,a)},MMMM:function(a){return b("months",this.month(),this,a)},D:function(){return this.date()},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~((a-b)/864e5+1.5)},d:function(){return this.day()},dd:function(a){return b("weekdaysMin",this.day(),this,a)},ddd:function(a){return b("weekdaysShort",this.day(),this,a)},dddd:function(a){return b("weekdays",this.day(),this,a)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864e5/7+1.5)},YY:function(){return h(this.year()%100,2)},YYYY:function(){return h(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return h(~~(this.milliseconds()/10),2)},SSS:function(){return h(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+h(~~(a/60),2)+":"+h(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+h(~~(10*a/6),4)}};while(_.length)E=_.pop(),bb[E+"o"]=d(bb[E]);while(ba.length)E=ba.pop(),bb[E+E]=c(bb[E],2);bb.DDDD=c(bb.DDD,3),B=function(b,c){if(b===null||b==="")return null;var d,f;return B.isMoment(b)?new e(new Date(+b._d),b._isUTC,b._lang):(c?j(c)?d=u(b,c):d=t(b,c):(f=J.exec(b),d=b===a?new Date:f?new Date(+f[1]):b instanceof Date?b:j(b)?l(b):typeof b=="string"?v(b):new Date(b)),new e(d))},B.utc=function(a,b){return j(a)?new e(l(a,!0),!0):(typeof a=="string"&&!S.exec(a)&&(a+=" +0000",b&&(b+=" Z")),B(a,b).utc())},B.unix=function(a){return B(a*1e3)},B.duration=function(a,b){var c=B.isDuration(a),d=typeof a=="number",e=c?a._data:d?{}:a,g;return d&&(b?e[b]=a:e.milliseconds=a),g=new f(e),c&&(g._lang=a._lang),g},B.humanizeDuration=function(a,b,c){return B.duration(a,b===!0?null:b).humanize(b===!0?!0:c)},B.version=C,B.defaultFormat=V,B.lang=function(a,b){var c;if(!a)return G;(b||!F[a])&&m(a,b);if(F[a]){for(c=0;c<I.length;c++)B[I[c]]=F[a][I[c]];B.monthsParse=F[a].monthsParse,G=a}},B.langData=n,B.isMoment=function(a){return a instanceof e},B.isDuration=function(a){return a instanceof f},B.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),B.fn=e.prototype={clone:function(){return B(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!k(this._a,(this._a[7]?B.utc(this._a):B(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return q(this,a?a:B.defaultFormat)},add:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return i(this,c,1),this},subtract:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return i(this,c,-1),this},diff:function(a,b,c){var d=this._isUTC?B(a).utc():B(a).local(),e=(this.zone()-d.zone())*6e4,f=this._d-d._d-e,g=this.year()-d.year(),h=this.month()-d.month(),i=this.date()-d.date(),j;return b==="months"?j=g*12+h+i/30:b==="years"?j=g+(h+i/30)/12:j=b==="seconds"?f/1e3:b==="minutes"?f/6e4:b==="hours"?f/36e5:b==="days"?f/864e5:b==="weeks"?f/6048e5:f,c?j:D(j)},from:function(a,b){return B.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(B(),a)},calendar:function(){var a=this.diff(B().sod(),"days",!0),b=this.lang().calendar,c=b.sameElse,d=a<-6?c:a<-1?b.lastWeek:a<0?b.lastDay:a<1?b.sameDay:a<2?b.nextDay:a<7?b.nextWeek:c;return this.format(typeof d=="function"?d.apply(this):d)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<B([this.year()]).zone()||this.zone()<B([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return B.utc([this.year(),this.month()+1,0]).date()},lang:function(b){return b===a?n(this):(this._lang=b,this)}};for(E=0;E<Y.length;E++)y(Y[E].toLowerCase(),Y[E]);y("year","FullYear"),B.duration.fn=f.prototype={weeks:function(){return g(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=x(b,!a,this.lang()),e=b<=0?c.past:c.future;return a&&(typeof e=="function"?d=e(d):d=e.replace(/%s/i,d)),d},lang:B.fn.lang};for(E in Z)Z.hasOwnProperty(E)&&(A(E,Z[E]),z(E.toLowerCase()));A("Weeks",6048e5),H&&(module.exports=B),typeof ender=="undefined"&&(this.moment=B),typeof define=="function"&&define.amd&&define("moment",[],function(){return B})}.call(this),function(){function l(){var a="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+";return a}function m(a,b){return a=a.source,b=b||"",function c(d,e){return d?(a=a.replace(d,e.source||e),c):new RegExp(a,b)}}function n(){}var a={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:n,hr:/^( *[\-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [^\0]+?(?:rule|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};a.bullet=/(?:[*+-]|\d+\.)/,a.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,a.item=m(a.item,"gm")(/bull/g,a.bullet)(),a.list=m(a.list)(/bull/g,a.bullet)("rule",/\n+(?=(?: *[-*_]){3,})/)(),a.html=m(a.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?!:\/|@)\b(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,l())(),a.paragraph=function(){var b=a.paragraph.source,c=[];return function d(b){return b=a[b]?a[b].source:b,c.push(b.replace(/(^|[^\[])\^/g,"$1")),d}("hr")("heading")("lheading")("blockquote")("<"+l())("def"),new RegExp(b.replace("body",c.join("|")))}(),a.normal={fences:a.fences,paragraph:a.paragraph},a.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/},a.gfm.paragraph=m(a.paragraph)("(?!","(?!"+a.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")(),a.lexer=function(b){var c=[];return c.links={},b=b.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),a.token(b,c,!0)},a.token=function(b,c,d){var b=b.replace(/^ +$/gm,""),e,f,g,h,i,j,k;while(b){if(g=a.newline.exec(b))b=b.substring(g[0].length),g[0].length>1&&c.push({type:"space"});if(g=a.code.exec(b)){b=b.substring(g[0].length),g=g[0].replace(/^ {4}/gm,""),c.push({type:"code",text:p.pedantic?g:g.replace(/\n+$/,"")});continue}if(g=a.fences.exec(b)){b=b.substring(g[0].length),c.push({type:"code",lang:g[1],text:g[2]});continue}if(g=a.heading.exec(b)){b=b.substring(g[0].length),c.push({type:"heading",depth:g[1].length,text:g[2]});continue}if(g=a.lheading.exec(b)){b=b.substring(g[0].length),c.push({type:"heading",depth:g[2]==="="?1:2,text:g[1]});continue}if(g=a.hr.exec(b)){b=b.substring(g[0].length),c.push({type:"hr"});continue}if(g=a.blockquote.exec(b)){b=b.substring(g[0].length),c.push({type:"blockquote_start"}),g=g[0].replace(/^ *> ?/gm,""),a.token(g,c,d),c.push({type:"blockquote_end"});continue}if(g=a.list.exec(b)){b=b.substring(g[0].length),c.push({type:"list_start",ordered:isFinite(g[2])}),g=g[0].match(a.item),e=!1,k=g.length,j=0;for(;j<k;j++)h=g[j],i=h.length,h=h.replace(/^ *([*+-]|\d+\.) +/,""),~h.indexOf("\n ")&&(i-=h.length,h=p.pedantic?h.replace(/^ {1,4}/gm,""):h.replace(new RegExp("^ {1,"+i+"}","gm"),"")),f=e||/\n\n(?!\s*$)/.test(h),j!==k-1&&(e=h[h.length-1]==="\n",f||(f=e)),c.push({type:f?"loose_item_start":"list_item_start"}),a.token(h,c),c.push({type:"list_item_end"});c.push({type:"list_end"});continue}if(g=a.html.exec(b)){b=b.substring(g[0].length),c.push({type:"html",pre:g[1]==="pre",text:g[0]});continue}if(d&&(g=a.def.exec(b))){b=b.substring(g[0].length),c.links[g[1].toLowerCase()]={href:g[2],title:g[3]};continue}if(d&&(g=a.paragraph.exec(b))){b=b.substring(g[0].length),c.push({type:"paragraph",text:g[0]});continue}if(g=a.text.exec(b)){b=b.substring(g[0].length),c.push({type:"text",text:g[0]});continue}}return c};var b={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:n,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`]| {2,}\n|$)/};b._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,b._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/,b.link=m(b.link)("inside",b._linkInside)("href",b._linkHref)(),b.reflink=m(b.reflink)("inside",b._linkInside)(),b.normal={url:b.url,strong:b.strong,em:b.em,text:b.text},b.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/},b.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/},b.lexer=function(a){var e="",f=d.links,g,h,i,l;while(a){if(l=b.escape.exec(a)){a=a.substring(l[0].length),e+=l[1];continue}if(l=b.autolink.exec(a)){a=a.substring(l[0].length),l[2]==="@"?(h=l[1][6]===":"?k(l[1].substring(7)):k(l[1]),i=k("mailto:")+h):(h=j(l[1]),i=h),e+='<a href="'+i+'">'+h+"</a>";continue}if(l=b.url.exec(a)){a=a.substring(l[0].length),h=j(l[1]),i=h,e+='<a href="'+i+'">'+h+"</a>";continue}if(l=b.tag.exec(a)){a=a.substring(l[0].length),e+=p.sanitize?j(l[0]):l[0];continue}if(l=b.link.exec(a)){a=a.substring(l[0].length),e+=c(l,{href:l[2],title:l[3]});continue}if((l=b.reflink.exec(a))||(l=b.nolink.exec(a))){a=a.substring(l[0].length),g=(l[2]||l[1]).replace(/\s+/g," "),g=f[g.toLowerCase()];if(!g||!g.href){e+=l[0][0],a=l[0].substring(1)+a;continue}e+=c(l,g);continue}if(l=b.strong.exec(a)){a=a.substring(l[0].length),e+="<strong>"+b.lexer(l[2]||l[1])+"</strong>";continue}if(l=b.em.exec(a)){a=a.substring(l[0].length),e+="<em>"+b.lexer(l[2]||l[1])+"</em>";continue}if(l=b.code.exec(a)){a=a.substring(l[0].length),e+="<code>"+j(l[2],!0)+"</code>";continue}if(l=b.br.exec(a)){a=a.substring(l[0].length),e+="<br>";continue}if(l=b.text.exec(a)){a=a.substring(l[0].length),e+=j(l[0]);continue}}return e};var c=function(a,c){return a[0][0]!=="!"?'<a href="'+j(c.href)+'"'+(c.title?' title="'+j(c.title)+'"':"")+">"+b.lexer(a[1])+"</a>":'<img src="'+j(c.href)+'" alt="'+j(a[1])+'"'+(c.title?' title="'+j(c.title)+'"':"")+">"},d,e,f=function(){return e=d.pop()},g=function(){switch(e.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+e.depth+">"+b.lexer(e.text)+"</h"+e.depth+">\n";case"code":return p.highlight&&(e.code=p.highlight(e.text,e.lang),e.code!=null&&e.code!==e.text&&(e.escaped=!0,e.text=e.code)),e.escaped||(e.text=j(e.text,!0)),"<pre><code"+(e.lang?' class="lang-'+e.lang+'"':"")+">"+e.text+"</code></pre>\n";case"blockquote_start":var a="";while(f().type!=="blockquote_end")a+=g();return"<blockquote>\n"+a+"</blockquote>\n";case"list_start":var c=e.ordered?"ol":"ul",a="";while(f().type!=="list_end")a+=g();return"<"+c+">\n"+a+"</"+c+">\n";case"list_item_start":var a="";while(f().type!=="list_item_end")a+=e.type==="text"?h():g();return"<li>"+a+"</li>\n";case"loose_item_start":var a="";while(f().type!=="list_item_end")a+=g();return"<li>"+a+"</li>\n";case"html":return p.sanitize?b.lexer(e.text):!e.pre&&!p.pedantic?b.lexer(e.text):e.text;case"paragraph":return"<p>"+b.lexer(e.text)+"</p>\n";case"text":return"<p>"+h()+"</p>\n"}},h=function(){var a=e.text,c;while((c=d[d.length-1])&&c.type==="text")a+="\n"+f().text;return b.lexer(a)},i=function(a){d=a.reverse();var b="";while(f())b+=g();return d=null,e=null,b},j=function(a,b){return a.replace(b?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},k=function(a){var b="",c=a.length,d=0,e;for(;d<c;d++)e=a.charCodeAt(d),Math.random()>.5&&(e="x"+e.toString(16)),b+="&#"+e+";";return b};n.exec=n;var o=function(b,c){return r(c),i(a.lexer(b))},p,q,r=function(c){c||(c=q);if(p===c)return;p=c,p.gfm?(a.fences=a.gfm.fences,a.paragraph=a.gfm.paragraph,b.text=b.gfm.text,b.url=b.gfm.url):(a.fences=a.normal.fences,a.paragraph=a.normal.paragraph,b.text=b.normal.text,b.url=b.normal.url),p.pedantic?(b.em=b.pedantic.em,b.strong=b.pedantic.strong):(b.em=b.normal.em,b.strong=b.normal.strong)};o.options=o.setOptions=function(a){return q=a,r(a),o},o.options({gfm:!0,pedantic:!1,sanitize:!1,highlight:null}),o.parser=function(a,b){return r(b),i(a)},o.lexer=function(b,c){return r(c),a.lexer(b)},o.parse=o,typeof module!="undefined"?module.exports=o:this.marked=o}.call(function(){return this||(typeof window!="undefined"?window:global)}()),define("marked",function(){}),define("views/tickets/TicketView",["jquery","underscore","mustache","BaseView","views/tickets/TicketMetaView","text!templates/tickets/Ticket.html","text!templates/tickets/AssignedUser.html","text!templates/tickets/EditTicket.html","text!templates/tickets/ClosedNotification.html","text!templates/tickets/AssignedTag.html","moment","marked"],function(a,b,c,d,e,f,g,h,i,j){var k=d.extend({className:"item ticket",events:{"click a[data-action]":"ticketAction","click [data-action='save']":"saveTicket","click [data-action='cancel']":"renderDescription","click .md a":"openLink"},initialize:function(){b.bindAll(this),this.renderAll=this.options.renderAll||!1,a(this.el).attr("data-id",this.model.id),this.renderAll||(this.bindTo(ticketer.collections.lists,"reset",this.renderTags),this.bindTo(this.model,"tag:add tag:remove",this.renderTags)),this.bindTo(this.model,"edit",this.renderEditForm),this.bindTo(this.model,"change:description",this.renderDescription),this.bindTo(this.model,"change:status",this.renderStatusNotification),this.bindTo(this.model,"change:assigned_to",this.renderStatusMarker),this.bindTo(this.model,"change:notification",this.renderStatusMarker)},render:function(){var b=this,c=this.packageModel();return a(this.el).html(Mustache.to_html(f,c)),this.renderAll&&this.model.isOpen()&&this.renderMeta(),this.renderAll||this.renderTags(),this},renderMeta:function(){var a;a=this.createView(e,{model:this.model}),this.$el.append(a.render().el)},renderTags:function(){var b,c,d,e=this;a(".tags",this.el).empty(),d=ticketer.collections.lists.filter(function(a){return a.hasTicket(e.model.id)});for(b=0,c=d.length;b<c;b++)a("ul.tags",this.el).append(this.renderTag(d[b]))},renderTag:function(a){var b=a.toJSON();return b.color=ticketer.colors[b.color].name,Mustache.to_html(j,b)},packageModel:function(){var a,b={};return b.title=this.model.get("title"),b.user=this.model.get("user"),b.datetime=this.model.get("closed_at")||this.model.get("opened_at"),a=moment(new Date(b.datetime)),a.calendar().match(/(Today|Yesterday)/g)?b.cleanTime=RegExp.$1:b.cleanTime=a.format("MMM D"),b.hoverTime=this.model.responseTime()||b.cleanTime,b.isClosed=this.model.get("status")==="closed",b.showTags=!0,this.model.notification()?b.statusClass="notify":b.statusClass=this.model.get("assigned_to").length?"read":"unread",this.renderAll&&(b.description=marked(this.model.get("description")),b.fullDate=a.format("MMMM Do, YYYY h:mm A"),b.showTags=!1,b.isEditable=this.isEditable(b),b.isAdmin=ticketer.currentUser.role==="admin"?!0:!1),b},isEditable:function(a){return a.user.id===ticketer.currentUser.id?!0:ticketer.currentUser.role==="admin"?!0:!1},ticketAction:function(b){var c,d=a(b.currentTarget).data("action"),e="Delete this ticket? This cannot be undone",f="Close this ticket? This cannot be undone";switch(d){case"close":c=confirm(f),c&&this.model.close();break;case"edit":this.model.trigger("edit");break;case"delete":c=confirm(e),c&&this.model.destroy()}b.preventDefault()},renderEditForm:function(){var b=a(".ticket .ticket-form",this.$el).length;b||(a(".content",this.$el).html(Mustache.to_html(h,{description:this.model.get("description")})),a("textarea",this.$el).autoResize({minHeight:150,extraSpace:14}))},saveTicket:function(b){b.preventDefault();var c=this,d=a(".wrap > textarea",c.el).val();a("textarea",this.el).data("AutoResizer").destroy(),c.model.save({description:d},{error:c.triggerViewError})},renderDescription:function(){if(!this.renderAll)return!1;var b=marked(this.model.get("description"));a(".content",this.el).html(b)},renderStatusNotification:function(){if(!this.renderAll)return!1;a(".content",this.el).before(Mustache.to_html(i)),ticketer.currentUser.role==="admin"&&a('.edit-options li[data-role="close-ticket"]').remove()},renderStatusMarker:function(){var a=this.$el.find(".header");this.model.notification()?a.removeClass("unread read").addClass("notify"):this.model.get("assigned_to").length===0?a.removeClass("read notify").addClass("unread"):a.removeClass("unread notify").addClass("read")},openLink:function(a){a.preventDefault(),a.stopPropagation(),window.open(a.currentTarget.href)}});return k}),define("views/tickets/TicketListView",["jquery","underscore","backbone","BaseView","timeline","views/tickets/TicketView"],function(a,b,c,d,e,f){var g=d.extend({className:"ticket-list",initialize:function(){var c=this;b.bindAll(this),this.status=this.options.status?this.options.status:"open",this.filter=this.options.filter||function(){return!0},this.bindTo(this.collection,"add",function(b){if(!c.filter){var d=c.renderTicket(b);a(c.el).append(d)}}),this.bindTo(this.collection,"remove",function(b){a('[data-id="'+b.id+'"]',c.el).remove()}),this.bindTo(this.collection,"reset",this.render)},render:function(){var b,c=this;return this.$el.empty(),this.collection.each(function(d){if(!c.filter(d))return;b=c.renderTicket(d),a(c.el).append(b)}),this.status==="closed"&&this.initTimeline(),this},renderTicket:function(a){var b=this.createView(f,{model:a});return b.render().el},initTimeline:function(){var b=this;if(this.collection.length===0)return;this.timeline=new e(this.collection,this.renderTicket,a(this.el),".ticket",{status:this.status}),this.bindTo(a(window),"scroll",function(){b.timeline.shouldCheckScroll=!0}),this.createInterval(250,function(){b.timeline.didScroll()})},showDetails:function(b){var c=a(b.currentTarget).data("id");ticketer.routers.ticketer.navigate("tickets/"+c,!0)}});return g}),define("text!templates/comments/Comment.html",[],function(){return'<!-- Comment Avatar -->\n<div class="avatar">\n  <img src="{{user.avatar}}" alt="{{user.name}}">\n</div>\n\n<!-- Comment Body -->\n<div class="body">\n  <div class="commentHeader">\n    <h5>{{user.name}}</h5>\n    <time datetime="{{created_at}}">{{cleanTime}}</time>\n  </div>\n\n  <div class="md">\n    {{{comment}}}\n  </div>\n</div>\n\n{{#isDeletable}}\n<!-- Comment options -->\n<ul class="edit-actions">\n  {{#isEditable}}\n  <li><a href="#" data-action="edit"><i class="icon-pencil"></i></a></li>\n  <li><a href="#" data-action="delete"><i class="icon-trash"></i></a></li>\n  {{/isEditable}}\n</ul>\n{{/isDeletable}}'}),define("text!templates/comments/EditComment.html",[],function(){return'<div class="comment-form">\n  <form action="#">\n    <div class="wrap">\n      <textarea class="placeholder" name="ticket_comment">{{comment}}</textarea>\n    </div>\n    <div class="actions">\n      <ul class="right">\n        <li><button data-action="save">Save</button></li>\n        <li><button data-action="cancel" class="cancel">Cancel</button></li>\n      </ul>\n    </div>\n  </form>\n</div>'}),define("views/comments/CommentView",["jquery","underscore","backbone","BaseView","mustache","text!templates/comments/Comment.html","text!templates/comments/EditComment.html","moment","marked"],function(a,b,c,d,e,f,g){var h=d.extend({className:"comment",tagName:"li",events:{"click [data-action='delete']":"removeComment","click [data-action='edit']":"editComment","click [data-action='save']":"saveComment","click [data-action='cancel']":"renderEdit","click .md a":"openLink"},initialize:function(){b.bindAll(this),this.bindTo(this.model,"change",this.render),this.$el.attr("data-id",this.model.id)},dispose:function(){var a=this.$el.find("textarea");return a.length>0&&(a=a.data("AutoResizer"),a&&a.destroy()),d.prototype.dispose.call(this)},render:function(){var b;b=this.model.toJSON();var c=moment(new Date(b.created_at));return b.cleanTime=c.fromNow(),b.isDeletable=this.isDeletable(b),b.isEditable=this.isEditable(b),b.comment=marked(b.comment),a(this.el).html(Mustache.to_html(f,b)),this},renderEdit:function(a){var b=this,c=this.$el.find("textarea").data("AutoResizer");c&&c.destroy(),this.$el.fadeOut(200,function(){b.render(),b.$el.fadeIn(200)}),a instanceof jQuery.Event&&a.preventDefault()},isEditable:function(a){return a.user.id===ticketer.currentUser.id},isDeletable:function(a){return a.user.id===ticketer.currentUser.id||ticketer.currentUser==="admin"},editComment:function(a){this.$el.find(".body").html(Mustache.to_html(g,{comment:this.model.get("comment")})),this.$el.find("textarea").autoResize({minHeight:64,extraSpace:10}),this.$el.find(".edit-actions").hide(),a.preventDefault()},saveComment:function(a){var b=this,c=this.$el.find("textarea").val();b.model.save({comment:c},{silent:!0,success:b.renderEdit}),a.preventDefault()},removeComment:function(b){var c,d=this;c=confirm("Are you sure you want to delete this comment? It cannot be undone"),c===!0&&(this.model.destroy(),a(this.el).fadeOut(200,function(){d.remove()})),b.preventDefault()},openLink:function(a){a.preventDefault(),a.stopPropagation(),window.open(a.currentTarget.href)}});return h}),define("text!templates/comments/CommentList.html",[],function(){return'<h3 class="title">Comments</h3>\n\n<div class="form-wrapper" role="comment-form"></div>\n<ul class="comments-list" role="comment-list"></ul>'}),define("text!templates/comments/CommentForm.html",[],function(){return'<div class="avatar">\n  <img src="{{avatar}}" alt="{{name}}">\n</div>\n<div class="body">\n  <div class="wrap">\n    <textarea class="placeholder" name="ticket_comment" placeholder="Enter your comment..."></textarea>\n  </div>\n  <div class="actions">\n    <ul class="right">\n      <li><button data-action="create">Post</button></li>\n    </ul>\n  </div>\n</div>'}),define("views/comments/CommentFormView",["jquery","underscore","backbone","BaseView","mustache","text!templates/comments/CommentForm.html"],function(a,b,c,d,e,f){var g=d.extend({className:"comment-form comment",events:{"click [data-action='create']":"create","focus textarea":"initResize"},initialize:function(){b.bindAll(this)},render:function(){return a(this.el).html(Mustache.to_html(f,ticketer.currentUser)),this},initResize:function(){a("textarea",this.el).autoResize({minHeight:64,extraSpace:10})},dispose:function(){var a=this.$el.find("textarea").data("AutoResizer");return a&&a.destroy(),d.prototype.dispose.call(this)},create:function(){var a=this.$el.find("textarea");this.collection.create({comment:a.val(),socket:ticketer.sockets.id},{wait:!0}),a.val("").blur(),a.css({height:"64px"})}});return g}),define("views/comments/CommentListView",["jquery","underscore","backbone","BaseView","views/comments/CommentView","views/comments/CommentFormView","text!templates/comments/CommentList.html"],function(a,b,c,d,e,f,g){var h=d.extend({className:"comments-wrapper",initialize:function(){b.bindAll(this),this.bindTo(this.collection,"add",this.addComment),this.bindTo(this.collection,"remove",this.removeComment),this.bindTo(this.collection,"reset",this.addAll)},render:function(){return this.$el.empty(),a(this.el).html(g),this.renderCommentForm(),this.collection.each(this.addComment),this},renderCommentForm:function(){var b=this.createView(f,{collection:this.collection});a("[role=comment-form]",this.$el).html(b.render().el)},addComment:function(b){var c=this.createView(e,{model:b}),d=c.render().el;a(d).hide(),a("[role=comment-list]",this.$el).prepend(d),a(d).fadeIn(200)},removeComment:function(b){var c=b.id;a("#"+c,this.el).remove()}});return h}),define("views/tickets/TicketDetailsView",["jquery","underscore","backbone","BaseView","views/tickets/TicketView","views/comments/CommentListView","views/comments/CommentFormView"],function(a,b,c,d,e,f,g){var h=d.extend({className:"ticket-details",initialize:function(){b.bindAll(this)},render:function(){return this.renderTicket(),this.renderComments(),this},dispose:function(){return this.model.notification()&&this.model.removeNotification(),d.prototype.dispose.call(this)},renderTicket:function(){var b=this.createView(e,{model:this.model,admin:!0,renderAll:!0});a(this.el).html(b.render().el)},renderComments:function(){var b=this.createView(f,{collection:this.model.comments});a(this.el).append(b.render().el)}});return h}),define("text!templates/tickets/TicketForm.html",[],function(){return'<div class="view-header">\n  <h1 class="title">Create a Ticket</h1>\n</div>\n\n<!-- Ticket Form -->\n<div class="wrapper">\n  <div class="wrap">\n    <input type="text" name="title" placeholder="Ticket Name...">\n  </div>\n\n  <div class="wrap">\n    <textarea name="description" placeholder="Enter a description of your ticket..."></textarea>\n  </div>\n\n  <div class="actions">\n    <ul class="left">\n      <li><a data-role="display-guide" class="guide" href="#">Markdown Guide</a></li>\n    </ul>\n    <ul class="right">\n      <li><button data-action="create">Create Ticket</button></li>\n      <li><button data-action= "cancel" class="cancel">Cancel</button></li>\n    </ul>\n  </div>\n</div>'}),define("text!templates/tickets/MarkdownGuide.html",[],function(){return'<div class="dialog">\n  <h1>Markdown Guide</h1>\n  <a href="#" class="close">&times;</a>\n  <div class="column">\n    <h2>Text formatting</h2>\n    <h3>Headers</h3>\n    <pre>\n# This is a header\n## This is a smaller header\n### An even smaller header</pre>\n    <h3>Styles</h3>\n    <pre>\n*Italic*\n_Italic_\n**Bold**\n__Bold__\n***Bold and Italic***</pre>\n  </div>\n  <div class="column">\n    <h2>Lists</h2>\n    <h3>Ordered</h3>\n    <pre>\n1. Item 1\n2. Item 2\n3. Item 3\n   * Item 3a\n   * Item 3b</pre>\n    <h3>Unordered</h3>\n    <pre>\n* Item 1\n* Item 2\n  * Nested Item</pre>\n  </div>\n  <div class="column">\n    <h2>Other</h2>\n    <h3>Links</h3>\n    <pre>\n[TxSSC](http://txssc.txstate.edu)</pre>\n    <h3>Images</h3>\n    <pre>\n![Alt Text](URL)</pre>\n    <h3>Blockquotes</h3>\n    <pre>\n> Quote</pre>\n  </div>\n</div>'}),function(a){function d(b){return this.filter(d.resizableFilterSelector).each(function(){new e(a(this),b)}),this}function e(b,c){b.data("AutoResizer")&&b.data("AutoResizer").destroy(),c=this.config=a.extend({},d.defaults,c),this.el=b,this.nodeName=b[0].nodeName.toLowerCase(),this.originalHeight=b.height(),this.previousScrollTop=null,this.value=b.val(),c.maxWidth==="original"&&(c.maxWidth=b.width()),c.minWidth==="original"&&(c.minWidth=b.width()),c.maxHeight==="original"&&(c.maxHeight=b.height()),c.minHeight==="original"&&(c.minHeight=b.height()),this.nodeName==="textarea"&&b.css({resize:"none",overflowY:"hidden"}),b.data("AutoResizer",this),c.animate.complete=function(a){return function(){return c.onAfterResize.call(b),a.apply(this,arguments)}}(c.animate.complete),this.bind()}var b="ar"+ +(new Date),c=d.defaults={onResize:function(){},onBeforeResize:function(){return 123},onAfterResize:function(){return 555},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500};d.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","paddingTop","paddingLeft","paddingBottom","paddingRight","width"],d.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden"},d.resizableFilterSelector=["textarea:not(textarea."+b+")","input:not(input[type])","input[type=text]","input[type=password]","input[type=email]","input[type=url]"].join(","),d.AutoResizer=e,a.fn.autoResize=d,e.prototype={bind:function(){var b=a.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",b).bind("change.autoResize",b).bind("paste.autoResize",function(){setTimeout(function(){b()},0)}),this.el.is(":hidden")||this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var c=this.el,e=this.nodeName==="textarea"?c.clone():a("<span/>");this.clone=e,a.each(d.cloneCSSProperties,function(a,b){e[0].style[b]=c.css(b)}),e.removeAttr("name").removeAttr("id").addClass(b).attr("tabIndex",-1).css(d.cloneCSSValues),this.nodeName==="textarea"?e.height("auto"):e.width("auto").css({whiteSpace:"nowrap"})},check:function(a,b){this.clone||(this.createClone(),this.injectClone());var c=this.config,d=this.clone,e=this.el,f=e.val();if(f===this.prevValue)return!0;this.prevValue=f;if(this.nodeName==="input"){d.text(f);var g=d.width(),h=g+c.extraSpace>=c.minWidth?g+c.extraSpace:c.minWidth,i=e.width();h=Math.min(h,c.maxWidth);if(h<i&&h>=c.minWidth||h>=c.minWidth&&h<=c.maxWidth)c.onBeforeResize.call(e),c.onResize.call(e),e.scrollLeft(0),c.animate&&!b?e.stop(1,1).animate({width:h},c.animate):(e.width(h),c.onAfterResize.call(e));return}d.width(e.width()).height(0).val(f).scrollTop(1e4);var j=d[0].scrollTop;if(this.previousScrollTop===j)return;this.previousScrollTop=j,j+c.extraSpace>=c.maxHeight?(e.css("overflowY",""),j=c.maxHeight,b=!0):j<=c.minHeight?j=c.minHeight:(e.css("overflowY","hidden"),j+=c.extraSpace),c.onBeforeResize.call(e),c.onResize.call(e),c.animate&&!b?e.stop(1,1).animate({height:j},c.animate):(e.height(j),c.onAfterResize.call(e))},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clone&&this.clone.remove(),delete this.el,delete this.clone},injectClone:function(){(d.cloneContainer||(d.cloneContainer=a("<arclones/>").appendTo("body"))).append(this.clone)}}}(jQuery),define("autoresize",function(){}),define("views/tickets/TicketFormView",["jquery","underscore","backbone","BaseView","mustache","text!templates/tickets/TicketForm.html","text!templates/tickets/MarkdownGuide.html","autoresize"],function(a,b,c,d,e,f,g){var h=d.extend({className:"ticket-form scrollable",events:{"click [data-action='create']":"createTicket","click [data-action='cancel']":"redirect","click [data-role='display-guide']":"displayHelp","click .dialog .close":"removeHelp","focus textarea":"initResize"},initialize:function(){b.bindAll(this),this.bindTo(a(window),"resize",this.setHeight),this.bindTo(this.collection,"sync",this.redirect)},render:function(){var b;return b=ticketer.currentUser,b.shortname=b.name.split(" ")[0],a(this.el).html(Mustache.to_html(f,ticketer.currentUser)),this.setHeight(),this},initResize:function(){this.$el.find("textarea").autoResize({minHeight:168,extraSpace:14})},createTicket:function(b){var c=this,d=a("[name=title]",this.el).val(),e=a("[name=description]",this.el).val();this.collection.create({title:d,description:e,socket:ticketer.sockets.id},{wait:!0}),b.preventDefault()},dispose:function(){var a=this.$el.find("textarea").data("AutoResizer");return a&&a.destroy(),d.prototype.dispose.call(this)},redirect:function(){ticketer.routers.ticketer.navigate("tickets/mine",!0)},displayHelp:function(b){b.preventDefault();if(this.$el.find(".dialog").length)return;this.$el.append(Mustache.to_html(g)),a(".dialog").animate({top:"18%"})},removeHelp:function(b){b.preventDefault(),this.$el.find(".dialog").fadeOut(200,function(){a(this).remove()})},setHeight:function(){var b=a("header").height(),c=a(window).height(),d=c-b;this.$el.css({height:d})}});return h}),define("text!templates/widgets/TagListWidget.html",[],function(){return'<h4 class="title">Tags</h4>\n<ul class="group tags"></ul>'}),define("text!templates/widgets/TagEdit.html",[],function(){return'<li data-id="{{id}}" title="{{name}}" class="editable color-{{color}}">\n  <i class="icon-bookmark"></i><input type="text" value="{{name}}"><span data-action="delete" class="close">&times;</span>\n</li>'}),define("views/widgets/TagListWidgetView",["jquery","underscore","backbone","BaseView","text!templates/widgets/TagListWidget.html","text!templates/widgets/Tag.html","text!templates/widgets/TagEdit.html"],function(a,b,c,d,e,f,g){var h=d.extend({className:"option-set tag-list-widget",events:{"click .tag[data-id]":"filterListView","dblclick [data-action='edit']":"editTag","mousedown [data-action='delete']":"deleteTag","blur .editable input":"saveTag"},initialize:function(){b.bindAll(this),this.bindTo(this.collection,"add remove reset",this.renderTags)},render:function(){return this.$el.html(Mustache.to_html(e)),this.renderTags(),this},renderTags:function(){var a=this,b=[];this.collection.length?this.collection.each(function(c){b.push(a.renderTag(c))}):b.push("<li>You have no tags</li>"),this.$el.find(".group").html(b.join(""))},renderTag:function(a){var b=a.toJSON();return b.color=ticketer.colors[b.color].name,Mustache.to_html(f,b)},filterListView:function(b){var c=a(b.currentTarget),d=ticketer.collections.lists.get(c.data("id")),e=d.get("tickets");c.hasClass("active")?(c.removeClass("active"),ticketer.collections.openTickets.trigger("filter")):(c.siblings().removeClass("active"),c.addClass("active"),ticketer.collections.openTickets.trigger("filter",function(a){return~e.indexOf(a.id)}))},editTag:function(b){var c=a(b.currentTarget).parent(),d=this.collection.get(c.data("id")).toJSON();d.color=ticketer.colors[d.color].name,c.replaceWith(Mustache.to_html(g,d)),this.$el.find("input").focus()},saveTag:function(a){var b,c=this,d=this.$el.find(".editable"),e=d.find("input").val(),f=this.collection.get(d.data("id"));f&&(f.save({name:e}),d.replaceWith(c.renderTag(f)))},deleteTag:function(b){var c=a(b.currentTarget).parent(),d=this.collection.get(c.data("id"));d?d.destroy():console.error("Attempted to get tag: #"+id+", but failed."),b.stopPropagation(),b.stopImmediatePropagation()}});return h}),define("text!templates/toolbars/Toolbar.html",[],function(){return'<div class="option-set">\n  <h4 class="title">Tickets</h4>\n  <ul class="group">\n    <li><a href="#" data-route="tickets/mine"><i class="icon-home"></i> My Tickets<span data-role="my-count" class="count"></span></a></li>\n    <li><a href="#" data-route="tickets/open"><i class="icon-inbox"></i> Open Tickets<span data-role="open-count" class="count"></span></a></li>\n    <li><a href="#" data-route="tickets/closed"><i class="icon-ban-circle"></i> Closed Tickets</a></li>\n  </ul>\n</div>'}),define("views/toolbars/MainToolbarView",["jquery","underscore","backbone","BaseView","mustache","views/widgets/TagListWidgetView","text!templates/toolbars/Toolbar.html"],function(a,b,c,d,e,f,g){var h=d.extend({className:"sidebar",events:{"click a[data-route]":"navigateTo"},initialize:function(){b.bindAll(this),this.bindTo(ticketer.collections.openTickets,"add remove reset change",this.renderCounts)},render:function(){return this.$el.html(Mustache.to_html(g)),this.renderCounts(),this.renderTagWidget(),this},renderCounts:function(){var b=ticketer.collections.openTickets.filter(function(a){return a.participating()&&a.notification()}).length,c=ticketer.collections.openTickets.filter(function(a){return!a.get("assigned_to").length}).length;b===0?a('[data-role="my-count"]',this.el).hide():a('[data-role="my-count"]',this.el).text(b).show(),c===0?a('[data-role="open-count"]',this.el).hide():a('[data-role="open-count"]',this.el).text(c).show()},renderTagWidget:function(){var a=this.createView(f,{collection:ticketer.collections.lists});this.$el.append(a.render().el)},navigateTo:function(b){b.preventDefault();var c=a(b.target).data("route");this.selectTab(c),ticketer.routers.ticketer.navigate(c,!0)},selectTab:function(a){return this.$el.find(".group > .active").removeClass("active"),a&&this.$el.find('a[data-route="'+a+'"]').parent().addClass("active"),this}});return h}),define("routers/Ticketer",["backbone","AppView","views/headers/MainHeaderView","views/main/PanelView","views/tickets/TicketListView","views/tickets/TicketDetailsView","views/tickets/TicketFormView","views/toolbars/MainToolbarView"],function(a,b,c,d,e,f,g,h){var i=a.Router.extend({routes:{"":"index","tickets/open":"openTickets","tickets/closed":"closedTickets","tickets/closed?*params":"closedTickets","tickets/mine":"myTickets","tickets/new":"createTicket"},initialize:function(){this.appView=new b,this.appView.showToolbar(h);var a=new c;$("header").append(a.render().el)},index:function(){this.navigate("tickets/mine",!0)},openTickets:function(){var a,b=this;collection=ticketer.collections.openTickets,a=new d({collection:collection,list:e,details:f}),this.appView.showView(a),this.appView.showToolbarTab("tickets/open")},closedTickets:function(){var a,b=ticketer.collections.closedTickets;a=new d({collection:b,list:e,details:f}),this.appView.showView(a),this.appView.showToolbarTab("tickets/closed")},myTickets:function(){var a,b=ticketer.collections.openTickets;a=new d({collection:b,list:e,details:f,filter:function(a){return a.participating()}}),this.appView.showView(a),this.appView.showToolbarTab("tickets/mine")},createTicket:function(){var a,b=ticketer.collections.openTickets;a=new g({collection:b}),this.appView.showView(a,function(){a.trigger("viewRendered")}),this.appView.showToolbarTab()}});return i}),define("views/alerts/BaseAlertView",["jquery","underscore","backbone"],function(a,b,c){var d=c.View.extend({id:"alert",events:{"click .close":"close"},initialize:function(){b.bindAll(this)},close:function(b){b.type==="click"&&b.preventDefault();var c=this;a(this.el).slideUp(200,"swing",function(){a(".alert",c).remove()}),a("body").off("mousedown DOMMouseScroll mousewheel touchstart touchmove",c.close)}});return d}),define("text!templates/alerts/Error.html",[],function(){return'<div class="alert error">\n  <a class="close" href="#">x</a>\n  <p>{{msg}}</p>\n</div>'}),define("views/alerts/ErrorView",["jquery","underscore","backbone","views/alerts/BaseAlertView","mustache","text!templates/alerts/Error.html"],function(a,b,c,d,e,f){var g=d.extend({initialize:function(){b.bindAll(this),ticketer.EventEmitter.on("error",this.render)},render:function(b){a(this.el).html(Mustache.to_html(f,{msg:b})).hide(),a("body").prepend(this.el),a(this.el).slideDown(200,function(){function c(){a(b).slideUp(200,function(){a(".alert",b).remove()})}var b=this;setTimeout(function(){c()},4e3)})}});return g}),define("text!templates/alerts/Notification.html",[],function(){return'<button id="request_permission" href="#">Enable Desktop Notifications</button>\n<div class="notification-text">\n  <p>The Ticket System works best with desktop notifications turned on.</p>\n</div>'}),define("views/alerts/NotificationView",["jquery","underscore","backbone","mustache","text!templates/alerts/Notification.html"],function(a,b,c,d,e){var f=c.View.extend({id:"notification",className:"clearfix",events:{"click button":"requestPermissions"},initialize:function(){b.bindAll(this),ticketer.EventEmitter.on("comment:new",this.commentNotification),ticketer.EventEmitter.on("ticket:update",this.closedNotification)},render:function(){a(this.el).html(Mustache.to_html(e,{})).hide(),a("body").prepend(this.el),a(this.el).slideDown(200)},requestPermissions:function(){a(this.el).hide();var b=this;webkitNotifications.requestPermission(b.requestCallback)},requestCallback:function(){var a=webkitNotifications.checkPermission();a===0?ticketer.notifications=!0:ticketer.notifications=!1},commentNotification:function(a){var b=ticketer.collections.openTickets.get(a.ticket)||ticketer.collections.closedTickets.get(a.ticket);if(b&&ticketer.notifications&&a.participating){var c=a.user.name+' made a comment on "'+b.get("title")+'":';webkitNotifications.createNotification("",c,a.comment).show()}},closedNotification:function(a){if(!ticketer.notifications)return!1;if(a.status==="closed"){var c="Ticket Closed";if(a.user.id===ticketer.currentUser.id)webkitNotifications.createNotification("",c,a.title).show();else if(a.assigned_to.length>0){var d=b.include(a.assigned_to,ticketer.currentUser.id);d&&webkitNotifications.createNotification("",c,a.title).show()}}}});return f}),define("SocketEvents",["underscore","backbone"],function(a,b){var c=function(){ticketer.sockets.sock.on("ticket:new",function(a){ticketer.EventEmitter.trigger("ticket:new",a),ticketer.collections.openTickets.add(a)}),ticketer.sockets.sock.on("ticket:update",function(a){ticketer.EventEmitter.trigger("ticket:update",a)}),ticketer.sockets.sock.on("ticket:remove",function(a){ticketer.EventEmitter.trigger("ticket:remove",a)}),ticketer.sockets.sock.on("tickets:fetch",function(a,b){a?ticketer.EventEmitter.trigger("error",a):ticketer.collections.openTickets.reset(b)}),ticketer.sockets.sock.on("comment:new",function(a){ticketer.EventEmitter.trigger("comment:new",a)}),ticketer.sockets.sock.on("comment:update",function(a){ticketer.EventEmitter.trigger("comment:update",a)}),ticketer.sockets.sock.on("comment:remove",function(a){ticketer.EventEmitter.trigger("comment:remove",a)}),ticketer.EventEmitter.on("ticket:notification:remove",function(a){ticketer.sockets.sock.emit("ticket:notification:remove",a)}),ticketer.sockets.sock.on("projects:fetch",function(a){ticketer.collections.projects.reset(a)}),ticketer.sockets.sock.on("project:new",function(a){ticketer.EventEmitter.trigger("project:new",a)}),ticketer.sockets.sock.on("project:update",function(a){ticketer.EventEmitter.trigger("project:update",a)}),ticketer.sockets.sock.on("project:remove",function(a){ticketer.EventEmitter.trigger("project:remove",a)})};return c}),define("AppCache",[],function(){var a=function(){setInterval(function(){applicationCache.update()},6e5),window.applicationCache&&applicationCache.addEventListener("updateready",function(){confirm("An update is available. Reload now?")&&window.location.reload()})};return a}),define("Sync",["jquery","underscore","backbone"],function(a,b,c){var d=function(){c.sync_model=c.sync,c.sync=function(a,d,e){var f=b.extend({beforeSend:function(a){var b=ticketer.currentUser.token;b&&a.setRequestHeader("X-Auth-Token",b),a.setRequestHeader("Accept","application/json")}},e);c.sync_model(a,d,f)}};return d}),define("app",["underscore","backbone","collections/Tickets","collections/Comments","collections/Users","collections/Projects","collections/Lists","routers/Ticketer","views/alerts/ErrorView","views/alerts/NotificationView","SocketEvents","AppCache","Sync","socket.io"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){$(function(){new l,window.ticketer=window.ticketer||{},ticketer.colors=[{value:0,name:"lightOrange"},{value:1,name:"blue"},{value:2,name:"red"},{value:3,name:"green"},{value:4,name:"teal"},{value:5,name:"pink"},{value:6,name:"brightGreen"},{value:7,name:"tan"}],ticketer.EventEmitter={},a.extend(ticketer.EventEmitter,b.Events),ticketer.collections={openTickets:new c,closedTickets:new c,users:new e,projects:new f,lists:new g},ticketer.routers={ticketer:new h},ticketer.sockets={sock:io.connect()},ticketer.views={alerts:{error:new i,notifications:new j}},new k,new m,ticketer.collections.closedTickets.comparator=function(a){var b=new Date(a.get("closed_at")),c=b.getTime();return-c},ticketer.sockets.sock.on("session:info",function(a){a.user||(self.location.href="/login"),ticketer.currentUser=a.user,ticketer.sockets.id=ticketer.sockets.id||this.socket.sessionid,ticketer.EventEmitter.trigger("session:set"),ticketer.collections.users.reset(a.users),ticketer.sockets.sock.emit("projects:fetch"),ticketer.collections.lists.fetch(),ticketer.sockets.sock.emit("tickets:fetch"),ticketer.currentUser.avatar||(ticketer.currentUser.avatar="/img/avatars/65x65.gif");try{b.history.start()}catch(c){}ticketer.collections.closedTickets.fetch({data:{page:1,status:"closed"}})}),ticketer.sockets.sock.on("error",function(){self.location.href="/login"}),$("body").keyup(function(a){a.keyCode===27&&$("body .dialog").remove()});if(webkitNotifications){var d=webkitNotifications.checkPermission();d===0?ticketer.notifications=!0:d===2?ticketer.notifications=!1:ticketer.views.alerts.notifications.render()}})}),require.config({baseUrl:"js",paths:{backbone:"libs/AMDbackbone-0.9.0",underscore:"libs/underscore",text:"libs/require/text",mustache:"libs/mustache",marked:"libs/marked",moment:"libs/moment",dropdowns:"libs/plugins/bootstrap.dropdowns",truncate:"libs/plugins/jquery.truncator",outsideEvents:"libs/plugins/jquery.ba-outside-events.min",autoresize:"libs/plugins/jquery.autoresize",jqueryui:"libs/jqueryui-1.8.16",timeline:"libs/timeline",Sync:"support/Sync",BaseView:"support/GarbageCollector",AppView:"support/AppView",SocketEvents:"support/SocketEvents",AppCache:"support/AppCache","socket.io":"/socket.io/socket.io"}}),require(["jquery","underscore","backbone","BaseView"],function(a,b,c,d){require(["app"],function(){(function(){function b(){var b=a(window).height(),c=a("header").height(),d;d=b-c,a("[role=sidebar]").css("height",d)}a(window).resize(function(){b()}),b()})()})}),define("main",function(){})